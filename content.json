[{"title":"三国无双4PC及PS2版","date":"2020-09-25T12:59:32.000Z","path":"2020/09/25/三国无双 4/","text":"加入QQ群328916234，有免费资源，群公告和群文件 三国无双 4(windows)电脑版 下载地址：群文件 真三国无双4.rar 遇到打不开的问题 win10打不开游戏 01 关掉360或其他杀毒软件（只需一次） 02 下载群文件win10补丁 03 解压后里面有两个文件： ​ secdrv.sys 复制粘贴到 C:\\Windows\\System32\\drivers ​ secdrv.reg 双击该文件，自动导入注册表 04 重启电脑 win7打不开游戏01 win + R (或者鼠标右键点击开始田菜单，单击运行（R)**） ，在打开框里输入cmd** 02 输入 1sc config secdrv start&#x3D; auto 三国无双4猛将传和帝国（ps2)01 下载解压游戏iso文件(群文件)，三国无双4猛将传iso压缩包/三国无双4帝国ps2压缩包 02 下载解压模拟器，PS2模拟器压缩包 03 双击pcsx2-r5875.exe（在加压的模拟器包中），打开模拟器，单击左上角CDVD(v)-&gt;Iso选择器-&gt;浏览-&gt;选择解压的iso文件 04 单击 系统(s) -&gt;启动CDVD(完整模式) 注意： 游戏中按Esc键会退出游戏 按Tab键会加快/恢复正常，游戏速度 空格键，Enter键，J键确认作用 M键返回 游戏是日文的，但不影响游玩，一点不会日文都毫无影响","link":"","tags":[{"name":"游戏","slug":"游戏","permalink":"http://example.com/tags/%E6%B8%B8%E6%88%8F/"}]},{"title":"SSM电商项目08","date":"2020-09-23T04:07:13.000Z","path":"2020/09/23/电商网站的SSM项目08/","text":"7.3.1 购买流程01 购买的业务流程 登录 访问产品页 立即购买 进入结算页面 加入购物车 查看购物车 选中购物车中的商品 又到了第4步的结算页面 在结算页面生成订单 付款 确认收货 评价 02 购物流程环节与表关系接着再把购物流程各个环节与表关系搞清楚，这个开发人员必须明白的部分，这个部分稀里糊涂，后面做出来的功能就会越来越乱。 围绕购物流程最重要的两个表是OrderItem 和 Order表 关于OrderItem的业务行为 立即购买 —— 新增 OrderItem 加入购物车 —— 新增 OrderItem 查看购物车 —— 显示未和Order关联的OrderItem 选中购物车中的商品 —— 选中OrderItem 结算页面 —— 显示选中的OrderItem 生成订单 —— 新增Order 付款 —— 修改Order状态 我的订单 —— 显示Order 确认收货 —— 修改Order状态 7.3.2 立即购买那么点击购买都做了什么事情呢？ 会在OrderItem表里插入一条数据，这条数据会表示: pid =844 购买的商品id oid = null, 这个订单项还没有生成对应的订单，即还在购物车中 uid= 3，用户的id是3 number=3, 购买了3件产品 01 OrderItemService为OrderItemService新增方法listByUser 123456789101112131415161718192021222324package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem; public interface OrderItemService &#123; void add(OrderItem c); void delete(int id); void update(OrderItem c); OrderItem get(int id); List list(); void fill(List&lt;Order&gt; os); void fill(Order o); int getSaleCount(int pid); List&lt;OrderItem&gt; listByUser(int uid);&#125; 02 OrderItemServiceImpl为OrderItemServiceImpl新增加方法listByUser的实现 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.OrderItemMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.OrderItemExample;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.ProductService; @Servicepublic class OrderItemServiceImpl implements OrderItemService &#123; @Autowired OrderItemMapper orderItemMapper; @Autowired ProductService productService; @Override public void add(OrderItem c) &#123; orderItemMapper.insert(c); &#125; @Override public void delete(int id) &#123; orderItemMapper.deleteByPrimaryKey(id); &#125; @Override public void update(OrderItem c) &#123; orderItemMapper.updateByPrimaryKeySelective(c); &#125; @Override public OrderItem get(int id) &#123; OrderItem result = orderItemMapper.selectByPrimaryKey(id); setProduct(result); return result; &#125; public List&lt;OrderItem&gt; list()&#123; OrderItemExample example =new OrderItemExample(); example.setOrderByClause(&quot;id desc&quot;); return orderItemMapper.selectByExample(example); &#125; @Override public void fill(List&lt;Order&gt; os) &#123; for (Order o : os) &#123; fill(o); &#125; &#125; @Override public int getSaleCount(int pid) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andPidEqualTo(pid); List&lt;OrderItem&gt; ois =orderItemMapper.selectByExample(example); int result =0; for (OrderItem oi : ois) &#123; result+=oi.getNumber(); &#125; return result; &#125; @Override public List&lt;OrderItem&gt; listByUser(int uid) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andUidEqualTo(uid).andOidIsNull(); List&lt;OrderItem&gt; result =orderItemMapper.selectByExample(example); setProduct(result); return result; &#125; public void fill(Order o) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andOidEqualTo(o.getId()); example.setOrderByClause(&quot;id desc&quot;); List&lt;OrderItem&gt; ois =orderItemMapper.selectByExample(example); setProduct(ois); float total = 0; int totalNumber = 0; for (OrderItem oi : ois) &#123; total+=oi.getNumber()*oi.getProduct().getPromotePrice(); totalNumber+=oi.getNumber(); &#125; o.setTotal(total); o.setTotalNumber(totalNumber); o.setOrderItems(ois); &#125; public void setProduct(List&lt;OrderItem&gt; ois)&#123; for (OrderItem oi: ois) &#123; setProduct(oi); &#125; &#125; private void setProduct(OrderItem oi) &#123; Product p = productService.get(oi.getPid()); oi.setProduct(p); &#125;&#125; 03 ForeController.buyone()通过上个步骤访问的地址 /forebuyone 导致ForeController.buyone()方法被调用 获取参数pid 获取参数num 根据pid获取产品对象p 从session中获取用户对象user 123456789101112131415161718192021222324252627282930@RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; &#125; 接下来就是新增订单项OrderItem， 新增订单项要考虑两个情况a. 如果已经存在这个产品对应的OrderItem，并且还没有生成订单，即还在购物车中。 那么就应该在对应的OrderItem基础上，调整数量a.1 基于用户对象user，查询没有生成订单的订单项集合a.2 遍历这个集合a.3 如果产品是一样的话，就进行数量追加a.4 获取这个订单项的 id b. 如果不存在对应的OrderItem,那么就新增一个订单项OrderItemb.1 生成新的订单项b.2 设置数量，用户和产品b.3 插入到数据库b.4 获取这个订单项的 id 最后， 基于这个订单项id客户端跳转到结算页面/forebuy 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; &#125; 7.3.3 结算页面 01 ForeController.buy()立即购买最后，客户端跳转到结算路径： “@forebuy?oiid=”+oiid; http://127.0.0.1:8080/tmall_ssm/forebuy?oiid=1 导致ForeController.buy()方法被调用 123456789101112131415161718@RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; &#125; 通过字符串数组获取参数oiid为什么这里要用字符串数组试图获取多个oiid，而不是int类型仅仅获取一个oiid? 因为根据购物流程环节与表关系，结算页面还需要显示在购物车中选中的多条OrderItem数据，所以为了兼容从购物车页面跳转过来的需求，要用字符串数组获取多个oiid 准备一个泛型是OrderItem的集合ois 根据前面步骤获取的oiids，从数据库中取出OrderItem对象，并放入ois集合中 累计这些ois的价格总数，赋值在total上 把订单项集合放在session的属性 “ois” 上 把总价格放在 model的属性 “total” 上 服务端跳转到buy.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; &#125; 02 buy.jsp与 register.jsp 相仿，buy.jsp也包含了header.jsp, top.jsp, footer.jsp 等公共页面。 中间是结算业务页面 buyPage.jsp 1234567&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/buyPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 03 buyPage.jsp 从63行到101行 遍历出订单项集合 ois 中的订单项数据从立即购买跳转到结算页面来只会有一件产品 显示总金额 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;&lt;div class=&quot;buyPageDiv&quot;&gt; &lt;form action=&quot;forecreateOrder&quot; method=&quot;post&quot;&gt; &lt;div class=&quot;buyFlow&quot;&gt; &lt;img class=&quot;pull-left&quot; src=&quot;img/site/simpleLogo.png&quot;&gt; &lt;img class=&quot;pull-right&quot; src=&quot;img/site/buyflow.png&quot;&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;address&quot;&gt; &lt;div class=&quot;addressTip&quot;&gt;输入收货地址&lt;/div&gt; &lt;div&gt; &lt;table class=&quot;addressTable&quot;&gt; &lt;tr&gt; &lt;td class=&quot;firstColumn&quot;&gt;详细地址&lt;span class=&quot;redStar&quot;&gt;*&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;textarea name=&quot;address&quot; placeholder=&quot;建议您如实填写详细收货地址，例如接到名称，门牌好吗，楼层和房间号等信息&quot;&gt;&lt;/textarea&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;邮政编码&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;post&quot; placeholder=&quot;如果您不清楚邮递区号，请填写000000&quot; type=&quot;text&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;收货人姓名&lt;span class=&quot;redStar&quot;&gt;*&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;receiver&quot; placeholder=&quot;长度不超过25个字符&quot; type=&quot;text&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;手机号码 &lt;span class=&quot;redStar&quot;&gt;*&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;mobile&quot; placeholder=&quot;请输入11位手机号码&quot; type=&quot;text&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productList&quot;&gt; &lt;div class=&quot;productListTip&quot;&gt;确认订单信息&lt;/div&gt; &lt;table class=&quot;productListTable&quot;&gt; &lt;thead&gt; &lt;tr&gt; &lt;th colspan=&quot;2&quot; class=&quot;productListTableFirstColumn&quot;&gt; &lt;img class=&quot;tmallbuy&quot; src=&quot;img/site/tmallbuy.png&quot;&gt; &lt;a class=&quot;marketLink&quot; href=&quot;#nowhere&quot;&gt;店铺：天猫店铺&lt;/a&gt; &lt;a class=&quot;wangwanglink&quot; href=&quot;#nowhere&quot;&gt; &lt;span class=&quot;wangwangGif&quot;&gt;&lt;/span&gt; &lt;/a&gt; &lt;/th&gt; &lt;th&gt;单价&lt;/th&gt; &lt;th&gt;数量&lt;/th&gt; &lt;th&gt;小计&lt;/th&gt; &lt;th&gt;配送方式&lt;/th&gt; &lt;/tr&gt; &lt;tr class=&quot;rowborder&quot;&gt; &lt;td colspan=&quot;2&quot; &gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody class=&quot;productListTableTbody&quot;&gt; &lt;c:forEach items=&quot;$&#123;ois&#125;&quot; var=&quot;oi&quot; varStatus=&quot;st&quot; &gt; &lt;tr class=&quot;orderItemTR&quot;&gt; &lt;td class=&quot;orderItemFirstTD&quot;&gt;&lt;img class=&quot;orderItemImg&quot; src=&quot;img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td class=&quot;orderItemProductInfo&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;oi.product.id&#125;&quot; class=&quot;orderItemProductLink&quot;&gt; $&#123;oi.product.name&#125; &lt;/a&gt; &lt;img src=&quot;img/site/creditcard.png&quot; title=&quot;支持信用卡支付&quot;&gt; &lt;img src=&quot;img/site/7day.png&quot; title=&quot;消费者保障服务,承诺7天退货&quot;&gt; &lt;img src=&quot;img/site/promise.png&quot; title=&quot;消费者保障服务,承诺如实描述&quot;&gt; &lt;/td&gt; &lt;td&gt; &lt;span class=&quot;orderItemProductPrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;/td&gt; &lt;td&gt; &lt;span class=&quot;orderItemProductNumber&quot;&gt;$&#123;oi.number&#125;&lt;/span&gt; &lt;/td&gt; &lt;td&gt;&lt;span class=&quot;orderItemUnitSum&quot;&gt; ￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.number*oi.product.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt;&lt;/td&gt; &lt;c:if test=&quot;$&#123;st.count==1&#125;&quot;&gt; &lt;td rowspan=&quot;5&quot; class=&quot;orderItemLastTD&quot;&gt; &lt;label class=&quot;orderItemDeliveryLabel&quot;&gt; &lt;input type=&quot;radio&quot; value=&quot;&quot; checked=&quot;checked&quot;&gt; 普通配送 &lt;/label&gt; &lt;select class=&quot;orderItemDeliverySelect&quot; class=&quot;form-control&quot;&gt; &lt;option&gt;快递 免邮费&lt;/option&gt; &lt;/select&gt; &lt;/td&gt; &lt;/c:if&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;div class=&quot;orderItemSumDiv&quot;&gt; &lt;div class=&quot;pull-left&quot;&gt; &lt;span class=&quot;leaveMessageText&quot;&gt;给卖家留言:&lt;/span&gt; &lt;span&gt; &lt;img class=&quot;leaveMessageImg&quot; src=&quot;img/site/leaveMessage.png&quot;&gt; &lt;/span&gt; &lt;span class=&quot;leaveMessageTextareaSpan&quot;&gt; &lt;textarea name=&quot;userMessage&quot; class=&quot;leaveMessageTextarea&quot;&gt;&lt;/textarea&gt; &lt;div&gt; &lt;span&gt;还可以输入200个字符&lt;/span&gt; &lt;/div&gt; &lt;/span&gt; &lt;/div&gt; &lt;span class=&quot;pull-right&quot;&gt;店铺合计(含运费): ￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;orderItemTotalSumDiv&quot;&gt; &lt;div class=&quot;pull-right&quot;&gt; &lt;span&gt;实付款：&lt;/span&gt; &lt;span class=&quot;orderItemTotalSumSpan&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;submitOrderDiv&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;submitOrderButton&quot;&gt;提交订单&lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; 7.3.4 加入购物车 在产品页面点击加入购物车的，除了得到像立即购买运行效果中在OrderItem表里插入一条数据外，把界面上的加入购物车按钮变成灰色并且不可点击 01 ForeController.addCart上一步访问地址/foreaddCart导致ForeController.addCart()方法被调用addCart()方法和立即购买中的 ForeController.buyone()步骤做的事情是一样的，区别在于返回不一样 获取参数pid 获取参数num 根据pid获取产品对象p 从session中获取用户对象user 12345678910111213141516171819202122232425262728@RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; &#125; 接下来就是新增订单项OrderItem， 新增订单项要考虑两个情况a. 如果已经存在这个产品对应的OrderItem，并且还没有生成订单，即还在购物车中。 那么就应该在对应的OrderItem基础上，调整数量a.1 基于用户对象user，查询没有生成订单的订单项集合a.2 遍历这个集合a.3 如果产品是一样的话，就进行数量追加a.4 获取这个订单项的 id b. 如果不存在对应的OrderItem,那么就新增一个订单项OrderItemb.1 生成新的订单项b.2 设置数量，用户和产品b.3 插入到数据库b.4 获取这个订单项的 id 与ForeController.buyone() 客户端跳转到结算页面不同的是， 最后返回字符串”success”，表示添加成功 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; &#125; 7.3.4 查看购物车页面01 ForeController.cart()访问地址/forecart导致ForeController.cart()方法被调用 通过session获取当前用户所以一定要登录才访问，否则拿不到用户对象,会报错 获取为这个用户关联的订单项集合 ois 把ois放在model中 服务端跳转到cart.jsp 123456789@RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; &#125; 02 cart.jsp与 register.jsp 相仿，cart.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是产品业务页面 cartPage.jsp 123456789&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt; &lt;%@include file=&quot;../include/fore/cart/cartPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 03 cartPage.jsp从238行到282行，遍历订单项集合ois 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;var deleteOrderItem = false;var deleteOrderItemid = 0;$(function()&#123; $(&quot;a.deleteOrderItem&quot;).click(function()&#123; deleteOrderItem = false; var oiid = $(this).attr(&quot;oiid&quot;) deleteOrderItemid = oiid; $(&quot;#deleteConfirmModal&quot;).modal(&#x27;show&#x27;); &#125;); $(&quot;button.deleteConfirmButton&quot;).click(function()&#123; deleteOrderItem = true; $(&quot;#deleteConfirmModal&quot;).modal(&#x27;hide&#x27;); &#125;); $(&#x27;#deleteConfirmModal&#x27;).on(&#x27;hidden.bs.modal&#x27;, function (e) &#123; if(deleteOrderItem)&#123; var page=&quot;foredeleteOrderItem&quot;; $.post( page, &#123;&quot;oiid&quot;:deleteOrderItemid&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; $(&quot;tr.cartProductItemTR[oiid=&quot;+deleteOrderItemid+&quot;]&quot;).hide(); &#125; else&#123; location.href=&quot;loginPage&quot;; &#125; &#125; ); &#125; &#125;) $(&quot;img.cartProductItemIfSelected&quot;).click(function()&#123; var selectit = $(this).attr(&quot;selectit&quot;) if(&quot;selectit&quot;==selectit)&#123; $(this).attr(&quot;src&quot;,&quot;img/site/cartNotSelected.png&quot;); $(this).attr(&quot;selectit&quot;,&quot;false&quot;) $(this).parents(&quot;tr.cartProductItemTR&quot;).css(&quot;background-color&quot;,&quot;#fff&quot;); &#125; else&#123; $(this).attr(&quot;src&quot;,&quot;img/site/cartSelected.png&quot;); $(this).attr(&quot;selectit&quot;,&quot;selectit&quot;) $(this).parents(&quot;tr.cartProductItemTR&quot;).css(&quot;background-color&quot;,&quot;#FFF8E1&quot;); &#125; syncSelect(); syncCreateOrderButton(); calcCartSumPriceAndNumber(); &#125;); $(&quot;img.selectAllItem&quot;).click(function()&#123; var selectit = $(this).attr(&quot;selectit&quot;) if(&quot;selectit&quot;==selectit)&#123; $(&quot;img.selectAllItem&quot;).attr(&quot;src&quot;,&quot;img/site/cartNotSelected.png&quot;); $(&quot;img.selectAllItem&quot;).attr(&quot;selectit&quot;,&quot;false&quot;) $(&quot;.cartProductItemIfSelected&quot;).each(function()&#123; $(this).attr(&quot;src&quot;,&quot;img/site/cartNotSelected.png&quot;); $(this).attr(&quot;selectit&quot;,&quot;false&quot;); $(this).parents(&quot;tr.cartProductItemTR&quot;).css(&quot;background-color&quot;,&quot;#fff&quot;); &#125;); &#125; else&#123; $(&quot;img.selectAllItem&quot;).attr(&quot;src&quot;,&quot;img/site/cartSelected.png&quot;); $(&quot;img.selectAllItem&quot;).attr(&quot;selectit&quot;,&quot;selectit&quot;) $(&quot;.cartProductItemIfSelected&quot;).each(function()&#123; $(this).attr(&quot;src&quot;,&quot;img/site/cartSelected.png&quot;); $(this).attr(&quot;selectit&quot;,&quot;selectit&quot;); $(this).parents(&quot;tr.cartProductItemTR&quot;).css(&quot;background-color&quot;,&quot;#FFF8E1&quot;); &#125;); &#125; syncCreateOrderButton(); calcCartSumPriceAndNumber(); &#125;); $(&quot;.orderItemNumberSetting&quot;).keyup(function()&#123; var pid=$(this).attr(&quot;pid&quot;); var stock= $(&quot;span.orderItemStock[pid=&quot;+pid+&quot;]&quot;).text(); var price= $(&quot;span.orderItemPromotePrice[pid=&quot;+pid+&quot;]&quot;).text(); var num= $(&quot;.orderItemNumberSetting[pid=&quot;+pid+&quot;]&quot;).val(); num = parseInt(num); if(isNaN(num)) num= 1; if(num&lt;=0) num = 1; if(num&gt;stock) num = stock; syncPrice(pid,num,price); &#125;); $(&quot;.numberPlus&quot;).click(function()&#123; var pid=$(this).attr(&quot;pid&quot;); var stock= $(&quot;span.orderItemStock[pid=&quot;+pid+&quot;]&quot;).text(); var price= $(&quot;span.orderItemPromotePrice[pid=&quot;+pid+&quot;]&quot;).text(); var num= $(&quot;.orderItemNumberSetting[pid=&quot;+pid+&quot;]&quot;).val(); num++; if(num&gt;stock) num = stock; syncPrice(pid,num,price); &#125;); $(&quot;.numberMinus&quot;).click(function()&#123; var pid=$(this).attr(&quot;pid&quot;); var stock= $(&quot;span.orderItemStock[pid=&quot;+pid+&quot;]&quot;).text(); var price= $(&quot;span.orderItemPromotePrice[pid=&quot;+pid+&quot;]&quot;).text(); var num= $(&quot;.orderItemNumberSetting[pid=&quot;+pid+&quot;]&quot;).val(); --num; if(num&lt;=0) num=1; syncPrice(pid,num,price); &#125;); $(&quot;button.createOrderButton&quot;).click(function()&#123; var params = &quot;&quot;; $(&quot;.cartProductItemIfSelected&quot;).each(function()&#123; if(&quot;selectit&quot;==$(this).attr(&quot;selectit&quot;))&#123; var oiid = $(this).attr(&quot;oiid&quot;); params += &quot;&amp;oiid=&quot;+oiid; &#125; &#125;); params = params.substring(1); location.href=&quot;forebuy?&quot;+params; &#125;); &#125;) function syncCreateOrderButton()&#123; var selectAny = false; $(&quot;.cartProductItemIfSelected&quot;).each(function()&#123; if(&quot;selectit&quot;==$(this).attr(&quot;selectit&quot;))&#123; selectAny = true; &#125; &#125;); if(selectAny)&#123; $(&quot;button.createOrderButton&quot;).css(&quot;background-color&quot;,&quot;#C40000&quot;); $(&quot;button.createOrderButton&quot;).removeAttr(&quot;disabled&quot;); &#125; else&#123; $(&quot;button.createOrderButton&quot;).css(&quot;background-color&quot;,&quot;#AAAAAA&quot;); $(&quot;button.createOrderButton&quot;).attr(&quot;disabled&quot;,&quot;disabled&quot;); &#125; &#125;function syncSelect()&#123; var selectAll = true; $(&quot;.cartProductItemIfSelected&quot;).each(function()&#123; if(&quot;false&quot;==$(this).attr(&quot;selectit&quot;))&#123; selectAll = false; &#125; &#125;); if(selectAll) $(&quot;img.selectAllItem&quot;).attr(&quot;src&quot;,&quot;img/site/cartSelected.png&quot;); else $(&quot;img.selectAllItem&quot;).attr(&quot;src&quot;,&quot;img/site/cartNotSelected.png&quot;); &#125;function calcCartSumPriceAndNumber()&#123; var sum = 0; var totalNumber = 0; $(&quot;img.cartProductItemIfSelected[selectit=&#x27;selectit&#x27;]&quot;).each(function()&#123; var oiid = $(this).attr(&quot;oiid&quot;); var price =$(&quot;.cartProductItemSmallSumPrice[oiid=&quot;+oiid+&quot;]&quot;).text(); price = price.replace(/,/g, &quot;&quot;); price = price.replace(/￥/g, &quot;&quot;); sum += new Number(price); var num =$(&quot;.orderItemNumberSetting[oiid=&quot;+oiid+&quot;]&quot;).val(); totalNumber += new Number(num); &#125;); $(&quot;span.cartSumPrice&quot;).html(&quot;￥&quot;+formatMoney(sum)); $(&quot;span.cartTitlePrice&quot;).html(&quot;￥&quot;+formatMoney(sum)); $(&quot;span.cartSumNumber&quot;).html(totalNumber);&#125;function syncPrice(pid,num,price)&#123; $(&quot;.orderItemNumberSetting[pid=&quot;+pid+&quot;]&quot;).val(num); var cartProductItemSmallSumPrice = formatMoney(num*price); $(&quot;.cartProductItemSmallSumPrice[pid=&quot;+pid+&quot;]&quot;).html(&quot;￥&quot;+cartProductItemSmallSumPrice); calcCartSumPriceAndNumber(); var page = &quot;forechangeOrderItem&quot;; $.post( page, &#123;&quot;pid&quot;:pid,&quot;number&quot;:num&#125;, function(result)&#123; if(&quot;success&quot;!=result)&#123; location.href=&quot;login.jsp&quot;; &#125; &#125; ); &#125;&lt;/script&gt; &lt;title&gt;购物车&lt;/title&gt;&lt;div class=&quot;cartDiv&quot;&gt; &lt;div class=&quot;cartTitle pull-right&quot;&gt; &lt;span&gt;已选商品 (不含运费)&lt;/span&gt; &lt;span class=&quot;cartTitlePrice&quot;&gt;￥0.00&lt;/span&gt; &lt;button class=&quot;createOrderButton&quot; disabled=&quot;disabled&quot;&gt;结 算&lt;/button&gt; &lt;/div&gt; &lt;div class=&quot;cartProductList&quot;&gt; &lt;table class=&quot;cartProductTable&quot;&gt; &lt;thead&gt; &lt;tr&gt; &lt;th class=&quot;selectAndImage&quot;&gt; &lt;img selectit=&quot;false&quot; class=&quot;selectAllItem&quot; src=&quot;img/site/cartNotSelected.png&quot;&gt; 全选 &lt;/th&gt; &lt;th&gt;商品信息&lt;/th&gt; &lt;th&gt;单价&lt;/th&gt; &lt;th&gt;数量&lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;金额&lt;/th&gt; &lt;th class=&quot;operation&quot;&gt;操作&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;ois &#125;&quot; var=&quot;oi&quot;&gt; &lt;tr oiid=&quot;$&#123;oi.id&#125;&quot; class=&quot;cartProductItemTR&quot;&gt; &lt;td&gt; &lt;img selectit=&quot;false&quot; oiid=&quot;$&#123;oi.id&#125;&quot; class=&quot;cartProductItemIfSelected&quot; src=&quot;img/site/cartNotSelected.png&quot;&gt; &lt;a style=&quot;display:none&quot; href=&quot;#nowhere&quot;&gt;&lt;img src=&quot;img/site/cartSelected.png&quot;&gt;&lt;/a&gt; &lt;img class=&quot;cartProductImg&quot; src=&quot;img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg&quot;&gt; &lt;/td&gt; &lt;td&gt; &lt;div class=&quot;cartProductLinkOutDiv&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;oi.product.id&#125;&quot; class=&quot;cartProductLink&quot;&gt;$&#123;oi.product.name&#125;&lt;/a&gt; &lt;div class=&quot;cartProductLinkInnerDiv&quot;&gt; &lt;img src=&quot;img/site/creditcard.png&quot; title=&quot;支持信用卡支付&quot;&gt; &lt;img src=&quot;img/site/7day.png&quot; title=&quot;消费者保障服务,承诺7天退货&quot;&gt; &lt;img src=&quot;img/site/promise.png&quot; title=&quot;消费者保障服务,承诺如实描述&quot;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/td&gt; &lt;td&gt; &lt;span class=&quot;cartProductItemOringalPrice&quot;&gt;￥$&#123;oi.product.originalPrice&#125;&lt;/span&gt; &lt;span class=&quot;cartProductItemPromotionPrice&quot;&gt;￥$&#123;oi.product.promotePrice&#125;&lt;/span&gt; &lt;/td&gt; &lt;td&gt; &lt;div class=&quot;cartProductChangeNumberDiv&quot;&gt; &lt;span class=&quot;hidden orderItemStock &quot; pid=&quot;$&#123;oi.product.id&#125;&quot;&gt;$&#123;oi.product.stock&#125;&lt;/span&gt; &lt;span class=&quot;hidden orderItemPromotePrice &quot; pid=&quot;$&#123;oi.product.id&#125;&quot;&gt;$&#123;oi.product.promotePrice&#125;&lt;/span&gt; &lt;a pid=&quot;$&#123;oi.product.id&#125;&quot; class=&quot;numberMinus&quot; href=&quot;#nowhere&quot;&gt;-&lt;/a&gt; &lt;input pid=&quot;$&#123;oi.product.id&#125;&quot; oiid=&quot;$&#123;oi.id&#125;&quot; class=&quot;orderItemNumberSetting&quot; autocomplete=&quot;off&quot; value=&quot;$&#123;oi.number&#125;&quot;&gt; &lt;a stock=&quot;$&#123;oi.product.stock&#125;&quot; pid=&quot;$&#123;oi.product.id&#125;&quot; class=&quot;numberPlus&quot; href=&quot;#nowhere&quot;&gt;+&lt;/a&gt; &lt;/div&gt; &lt;/td&gt; &lt;td &gt; &lt;span class=&quot;cartProductItemSmallSumPrice&quot; oiid=&quot;$&#123;oi.id&#125;&quot; pid=&quot;$&#123;oi.product.id&#125;&quot; &gt; ￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.promotePrice*oi.number&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/td&gt; &lt;td&gt; &lt;a class=&quot;deleteOrderItem&quot; oiid=&quot;$&#123;oi.id&#125;&quot; href=&quot;#nowhere&quot;&gt;删除&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;cartFoot&quot;&gt; &lt;img selectit=&quot;false&quot; class=&quot;selectAllItem&quot; src=&quot;img/site/cartNotSelected.png&quot;&gt; &lt;span&gt;全选&lt;/span&gt;&lt;!-- &lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt; --&gt; &lt;div class=&quot;pull-right&quot;&gt; &lt;span&gt;已选商品 &lt;span class=&quot;cartSumNumber&quot; &gt;0&lt;/span&gt; 件&lt;/span&gt; &lt;span&gt;合计 (不含运费): &lt;/span&gt; &lt;span class=&quot;cartSumPrice&quot; &gt;￥0.00&lt;/span&gt; &lt;button class=&quot;createOrderButton&quot; disabled=&quot;disabled&quot; &gt;结 算&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; 7.3.5 登录拦截器01 查看购物车页面的问题查看购物车页面有个问题，必须建立在已经登录的状态之上。 如果没有登录，而访问地址： http://127.0.0.1:8080/tmall_ssm/forecart 会导致异常产生。 所以在查看购物车之前，应该进行登录操作，但是又不能确保用户一定会记得登录，那么怎么办呢？准备一个过滤器，当访问那些需要登录才能做的页面的时候，进行是否登录的判断，如果不通过，那么就跳转到login.jsp页面去，提示用户登录。 02 LoginInterceptor新建一个过滤器LoginInterceptor ，根据解决思路中哪些页面需要登录？哪些页面不需要呢？a. 不需要登录也可以访问的如：注册，登录，产品，首页，分类，查询等等b. 需要登录才能够访问的如：购买行为，加入购物车行为，查看购物车，查看我的订单等等不需要登录也可以访问的已经确定了，但是需要登录才能够访问，截止目前为止还不能确定，所以这个过滤器就判断如果不是注册，登录，产品这些，就进行登录校验 准备字符串数组 noNeedAuthPage，存放哪些不需要登录也能访问的路径 获取uri 去掉前缀/tmall_ssm 如果访问的地址是/fore开头4.1 取出fore后面的字符串，比如是forecart,那么就取出cart4.2 判断cart是否是在noNeedAuthPage4.2 如果不在，那么就需要进行是否登录验证4.3 从session中取出”user”对象4.4 如果对象不存在，就客户端跳转到login.jsp4.5 否则就正常执行 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package com.how2java.tmall.interceptor;import java.util.Arrays;import java.util.List; import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession; import org.apache.commons.lang.StringUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.servlet.ModelAndView;import org.springframework.web.servlet.handler.HandlerInterceptorAdapter; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.OrderItemService; public class LoginInterceptor extends HandlerInterceptorAdapter &#123; @Autowired CategoryService categoryService; @Autowired OrderItemService orderItemService; /** * 在业务处理器处理请求之前被调用 * 如果返回false * 从当前的拦截器往回执行所有拦截器的afterCompletion(),再退出拦截器链 * 如果返回true * 执行下一个拦截器,直到所有的拦截器都执行完毕 * 再执行被拦截的Controller * 然后进入拦截器链, * 从最后一个拦截器往回执行所有的postHandle() * 接着再从最后一个拦截器往回执行所有的afterCompletion() */ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; HttpSession session = request.getSession(); String contextPath=session.getServletContext().getContextPath(); String[] noNeedAuthPage = new String[]&#123; &quot;home&quot;, &quot;checkLogin&quot;, &quot;register&quot;, &quot;loginAjax&quot;, &quot;login&quot;, &quot;product&quot;, &quot;category&quot;, &quot;search&quot;&#125;; String uri = request.getRequestURI(); uri = StringUtils.remove(uri, contextPath);// System.out.println(uri); if(uri.startsWith(&quot;/fore&quot;))&#123; String method = StringUtils.substringAfterLast(uri,&quot;/fore&quot; ); if(!Arrays.asList(noNeedAuthPage).contains(method))&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user)&#123; response.sendRedirect(&quot;loginPage&quot;); return false; &#125; &#125; &#125; return true; &#125; /** * 在业务处理器处理请求执行完成后,生成视图之前执行的动作 * 可在modelAndView中加入数据，比如当前时间 */ public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; &#125; /** * 在DispatcherServlet完全处理完请求后被调用,可用于清理资源等 * * 当有拦截器抛出异常时,会从当前拦截器往回执行所有的拦截器的afterCompletion() */ public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; &#125; &#125; 03 springMVC.xml在springMVC.xml中新增对登陆状态拦截器的配置 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&quot;&gt; &lt;!--启动注解识别--&gt; &lt;context:annotation-config/&gt; &lt;context:component-scan base-package=&quot;com.how2java.tmall.controller&quot;&gt; &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt; &lt;/context:component-scan&gt; &lt;mvc:annotation-driven /&gt; &lt;!--开通静态资源的访问--&gt; &lt;mvc:default-servlet-handler /&gt; &lt;!-- 视图定位 --&gt; &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot; /&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt; &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt; &lt;/bean&gt; &lt;!-- 对上传文件的解析--&gt; &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;/&gt; &lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=&quot;/fore*&quot;/&gt; &lt;bean class=&quot;com.how2java.tmall.interceptor.LoginInterceptor&quot;/&gt; &lt;/mvc:interceptor&gt; &lt;/mvc:interceptors&gt;&lt;/beans&gt; 7.3.6 其他拦截器01 OtherInterceptor1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package com.how2java.tmall.interceptor;import java.util.Arrays;import java.util.List; import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession; import org.apache.commons.lang.StringUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.servlet.ModelAndView;import org.springframework.web.servlet.handler.HandlerInterceptorAdapter; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.OrderItemService; public class OtherInterceptor extends HandlerInterceptorAdapter &#123; @Autowired CategoryService categoryService; @Autowired OrderItemService orderItemService; /** * 在业务处理器处理请求之前被调用 * 如果返回false * 从当前的拦截器往回执行所有拦截器的afterCompletion(),再退出拦截器链 * 如果返回true * 执行下一个拦截器,直到所有的拦截器都执行完毕 * 再执行被拦截的Controller * 然后进入拦截器链, * 从最后一个拦截器往回执行所有的postHandle() * 接着再从最后一个拦截器往回执行所有的afterCompletion() */ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; return true; &#125; /** * 在业务处理器处理请求执行完成后,生成视图之前执行的动作 * 可在modelAndView中加入数据，比如当前时间 */ public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; /*这里是获取分类集合信息，用于放在搜索栏下面*/ List&lt;Category&gt; cs = categoryService.list(); request.getSession().setAttribute(&quot;cs&quot;, cs); /*这里是获取当前的contextPath:tmall_ssm,用与放在左上角那个变形金刚，点击之后才能够跳转到首页，否则点击之后也仅仅停留在当前页面*/ HttpSession session = request.getSession(); String contextPath=session.getServletContext().getContextPath(); request.getSession().setAttribute(&quot;contextPath&quot;, contextPath); /*这里是获取购物车中一共有多少数量*/ User user =(User) session.getAttribute(&quot;user&quot;); int cartTotalItemNumber = 0; if(null!=user) &#123; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; cartTotalItemNumber+=oi.getNumber(); &#125; &#125; request.getSession().setAttribute(&quot;cartTotalItemNumber&quot;, cartTotalItemNumber); &#125; /** * 在DispatcherServlet完全处理完请求后被调用,可用于清理资源等 * * 当有拦截器抛出异常时,会从当前拦截器往回执行所有的拦截器的afterCompletion() */ public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; // System.out.println(&quot;afterCompletion(), 在访问视图之后被调用&quot;); &#125; &#125; 02 springMVC.xml新增OtherInterceptor拦截器的配置 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&quot;&gt; &lt;!--启动注解识别--&gt; &lt;context:annotation-config/&gt; &lt;context:component-scan base-package=&quot;com.how2java.tmall.controller&quot;&gt; &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt; &lt;/context:component-scan&gt; &lt;mvc:annotation-driven /&gt; &lt;!--开通静态资源的访问--&gt; &lt;mvc:default-servlet-handler /&gt; &lt;!-- 视图定位 --&gt; &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot; /&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt; &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt; &lt;/bean&gt; &lt;!-- 对上传文件的解析--&gt; &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;/&gt; &lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=&quot;/fore*&quot;/&gt; &lt;bean class=&quot;com.how2java.tmall.interceptor.LoginInterceptor&quot;/&gt; &lt;/mvc:interceptor&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=&quot;/fore*&quot;/&gt; &lt;bean class=&quot;com.how2java.tmall.interceptor.OtherInterceptor&quot;/&gt; &lt;/mvc:interceptor&gt; &lt;/mvc:interceptors&gt;&lt;/beans&gt; 7.3.6 购物车页面操作购物车页面和服务端的交互主要是三个 增加、减少某种产品的数量 删除某种产品 选中产品后，提交到结算页面 01 调整订单数量点击增加或者减少按钮后，根据 cartPage.jsp 中的js代码，会通过Ajax访问/forechangeOrderItem路径，导致ForeController.changeOrderItem()方法被调用 判断用户是否登录 获取pid和number 遍历出用户当前所有的未生成订单的OrderItem 根据pid找到匹配的OrderItem，并修改数量后更新到数据库 返回字符串”success” 12345678910var page = &quot;forechangeOrderItem&quot;; $.post( page, &#123;&quot;pid&quot;:pid,&quot;number&quot;:num&#125;, function(result)&#123; if(&quot;success&quot;!=result)&#123; location.href=&quot;loginPage&quot;; &#125; &#125; ); 1234567891011121314151617181920@RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; &#125; ForeController 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; &#125; 02 删除订单项点击删除按钮后，根据 cartPage.jsp 中的js代码，会通过Ajax访问/foredeleteOrderItem路径，导致ForeController.deleteOrderItem方法被调用 判断用户是否登录 获取oiid 删除oiid对应的OrderItem数据 返回字符串”success” 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125;&#125; 在选中了购物车中的任意商品之后，结算按钮呈现可点击状态。点击之后，提交到结算页面，并带上(多个)被选中的OrderItem对象的id http://127.0.0.1:8080/tmall_ssm/forebuy?oiid=2&amp;oiid=1 之后的流程就进入了结算页面 7.3.7 订单状态图 在开始实现订单相关功能之前，我们把订单的状态捋一捋，这样有助于代码思路更加清晰 首先是创建订单，刚创建好之后，订单处于waitPay 待付款状态 接着是付款，付款后，订单处于waitDelivery 待发货状态 前两步都是前台用户操作导致的，接下来需要到后台做发货操作，发货后，订单处于waitConfirm 待确认收货状态 接着又是前台用户进行确认收货操作，操作之后，订单处于waitReview 待评价状态 最后进行评价，评价之后，订单处于finish 完成状态 以上状态都是一个接一个的，不能跳状态进行。比较特殊的是，无论当前订单处于哪个状态，都可以进行删除操作。 像订单这样极其重要的业务数据，实际上是不允许真正从数据库中删除掉的，而是把状态标记为删除，以表示其被删掉了，所以在删除之后，订单处于 delete 已删除状态 7.3.8 生成订单首先通过立即购买或者购物车的提交到结算页面 进入结算页面，然后点击提交订单 提交订单后，在数据库中生成一条Order记录。不仅如此，订单项的oid字段也会被设置为这条Order记录的id 01 applicationContext.xml因为增加订单行为需要同时修改两个表 为Order表新增数据 修改OrderItem表所以需要进行事务管理，否则当新增了Order表的数据，还没有来得及修改OrderItem的时候出问题，比如突然断电，那么OrderItem的数据就会是脏数据了（没有指向正确的Order表数据）。 在最后增加事务管理配置： 12345&lt;!--事务管理--&gt;&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;&lt;/bean&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot; http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;&gt; &lt;context:annotation-config /&gt; &lt;context:component-scan base-package=&quot;com.how2java.tmall.service&quot; /&gt; &lt;!-- 导入数据库配置文件 --&gt; &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt; &lt;!-- 配置数据库连接池 --&gt; &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt; &lt;!-- 基本属性 url、user、password --&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt; &lt;!-- 配置初始化大小、最小、最大 --&gt; &lt;property name=&quot;initialSize&quot; value=&quot;1&quot; /&gt; &lt;property name=&quot;minIdle&quot; value=&quot;1&quot; /&gt; &lt;property name=&quot;maxActive&quot; value=&quot;20&quot; /&gt; &lt;!-- 配置获取连接等待超时的时间 --&gt; &lt;property name=&quot;maxWait&quot; value=&quot;60000&quot; /&gt; &lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt; &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;60000&quot; /&gt; &lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt; &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot; /&gt; &lt;property name=&quot;validationQuery&quot; value=&quot;SELECT 1&quot; /&gt; &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot; /&gt; &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot; /&gt; &lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt; &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;maxPoolPreparedStatementPerConnectionSize&quot; value=&quot;20&quot; /&gt; &lt;/bean&gt; &lt;!--Mybatis的SessionFactory配置--&gt; &lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;typeAliasesPackage&quot; value=&quot;com.how2java.tmall.pojo&quot; /&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt; &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mapper/*.xml&quot;/&gt; &lt;property name=&quot;plugins&quot;&gt; &lt;array&gt; &lt;bean class=&quot;com.github.pagehelper.PageInterceptor&quot;&gt; &lt;property name=&quot;properties&quot;&gt; &lt;value&gt; &lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/array&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!--Mybatis的Mapper文件识别--&gt; &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt; &lt;property name=&quot;basePackage&quot; value=&quot;com.how2java.tmall.mapper&quot;/&gt; &lt;/bean&gt; &lt;!--事务管理--&gt; &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt; &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt; &lt;/bean&gt; &lt;/beans&gt; 02 OrderService新增方法 add(Order c,List ois); 123456789101112131415161718192021222324package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem; public interface OrderService &#123; String waitPay = &quot;waitPay&quot;; String waitDelivery = &quot;waitDelivery&quot;; String waitConfirm = &quot;waitConfirm&quot;; String waitReview = &quot;waitReview&quot;; String finish = &quot;finish&quot;; String delete = &quot;delete&quot;; void add(Order c); float add(Order c,List&lt;OrderItem&gt; ois); void delete(int id); void update(Order c); Order get(int id); List list();&#125; 03 OrderServiceImpl实现add(Order o, List ois)方法，该方法通过注解进行事务管理 1@Transactional(propagation= Propagation.REQUIRED,rollbackForClassName=&quot;Exception&quot;) 41-42行代码用来模拟当增加订单后出现异常，观察事务管理是否预期发生。（需要把false修改为true才能观察到） 12if(false) throw new RuntimeException(); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package com.how2java.tmall.service.impl; import java.util.List; import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.service.OrderItemService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.OrderMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderExample;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.OrderService;import com.how2java.tmall.service.UserService;import org.springframework.transaction.annotation.Propagation;import org.springframework.transaction.annotation.Transactional; @Servicepublic class OrderServiceImpl implements OrderService &#123; @Autowired OrderMapper orderMapper; @Autowired UserService userService; @Autowired OrderItemService orderItemService; @Override public void add(Order c) &#123; orderMapper.insert(c); &#125; @Override @Transactional(propagation= Propagation.REQUIRED,rollbackForClassName=&quot;Exception&quot;) public float add(Order o, List&lt;OrderItem&gt; ois) &#123; float total = 0; add(o); if(false) throw new RuntimeException(); for (OrderItem oi: ois) &#123; oi.setOid(o.getId()); orderItemService.update(oi); total+=oi.getProduct().getPromotePrice()*oi.getNumber(); &#125; return total; &#125; @Override public void delete(int id) &#123; orderMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Order c) &#123; orderMapper.updateByPrimaryKeySelective(c); &#125; @Override public Order get(int id) &#123; return orderMapper.selectByPrimaryKey(id); &#125; public List&lt;Order&gt; list()&#123; OrderExample example =new OrderExample(); example.setOrderByClause(&quot;id desc&quot;); return orderMapper.selectByExample(example); &#125; &#125; 04 ForeController.createOrder提交订单访问路径 /forecreateOrder, 导致ForeController.createOrder 方法被调用 1234567891011121314@RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=java&quot;+total;&#125; 从session中获取user对象 通过参数Order接受地址，邮编，收货人，用户留言等信息 根据当前时间加上一个4位随机数生成订单号 根据上述参数，创建订单对象 把订单状态设置为等待支付 从session中获取订单项集合 ( 在结算功能的ForeController.buy() 13行，订单项集合被放到了session中 ) 把订单加入到数据库，并且遍历订单项集合，设置每个订单项的order，更新到数据库 统计本次订单的总金额 客户端跳转到确认支付页forealipay，并带上订单id和总金额 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs&#x3D; categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore&#x2F;home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name &#x3D; user.getName(); name &#x3D; HtmlUtils.htmlEscape(name); user.setName(name); boolean exist &#x3D; userService.isExist(name); if(exist)&#123; String m &#x3D;&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore&#x2F;register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name &#x3D; HtmlUtils.htmlEscape(name); User user &#x3D; userService.get(name,password); if(null&#x3D;&#x3D;user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore&#x2F;login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p &#x3D; productService.get(pid); List&lt;ProductImage&gt; productSingleImages &#x3D; productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages &#x3D; productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs &#x3D; propertyValueService.list(p.getId()); List&lt;Review&gt; reviews &#x3D; reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore&#x2F;product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); if(null!&#x3D;user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name &#x3D; HtmlUtils.htmlEscape(name); User user &#x3D; userService.get(name,password); if(null&#x3D;&#x3D;user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c &#x3D; categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!&#x3D;sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore&#x2F;category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps&#x3D; productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore&#x2F;searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p &#x3D; productService.get(pid); int oiid &#x3D; 0; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); boolean found &#x3D; false; List&lt;OrderItem&gt; ois &#x3D; orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()&#x3D;&#x3D;p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found &#x3D; true; oiid &#x3D; oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi &#x3D; new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid &#x3D; oi.getId(); &#125; return &quot;redirect:forebuy?oiid&#x3D;&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois &#x3D; new ArrayList&lt;&gt;(); float total &#x3D; 0; for (String strid : oiid) &#123; int id &#x3D; Integer.parseInt(strid); OrderItem oi&#x3D; orderItemService.get(id); total +&#x3D;oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore&#x2F;buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p &#x3D; productService.get(pid); User user &#x3D;(User) session.getAttribute(&quot;user&quot;); boolean found &#x3D; false; List&lt;OrderItem&gt; ois &#x3D; orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()&#x3D;&#x3D;p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found &#x3D; true; break; &#125; &#125; if(!found)&#123; OrderItem oi &#x3D; new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois &#x3D; orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore&#x2F;cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); if(null&#x3D;&#x3D;user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois &#x3D; orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()&#x3D;&#x3D;pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); if(null&#x3D;&#x3D;user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;) public String createOrder( Model model,Order order,HttpSession session)&#123; User user &#x3D;(User) session.getAttribute(&quot;user&quot;); String orderCode &#x3D; new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois&#x3D; (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total &#x3D;orderService.add(order,ois); return &quot;redirect:forealipay?oid&#x3D;&quot;+order.getId() +&quot;&amp;total&#x3D;&quot;+total; &#125; &#125; 05 确认支付页 在上一步客户端跳转到路径/forealipay方法，导致PageController.alipay()方法被调用。 alipay()没做什么事情，就是服务端跳转到了alipay.jsp页面。 alipay.jsp :与 register.jsp 相仿，alipay.jsp也包含了header.jsp, top.jsp， footer.jsp 等公共页面。中间是确认支付业务页面 alipayPage.jsp 1234567&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/alipayPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; alipayPage.jsp:显示总金额，并且让确认支付按钮跳转到页面 /forepayed页面，并带上oid和金额 123456789101112131415161718192021222324&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;aliPayPageDiv&quot;&gt; &lt;div class=&quot;aliPayPageLogo&quot;&gt; &lt;img class=&quot;pull-left&quot; src=&quot;img/site/simpleLogo.png&quot;&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div&gt; &lt;span class=&quot;confirmMoneyText&quot;&gt;扫一扫付款（元）&lt;/span&gt; &lt;span class=&quot;confirmMoney&quot;&gt; ￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;param.total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;/div&gt; &lt;div&gt; &lt;img class=&quot;aliPayImg&quot; src=&quot;img/site/alipay2wei.png&quot;&gt; &lt;/div&gt; &lt;div&gt; &lt;a href=&quot;forepayed?oid=$&#123;param.oid&#125;&amp;total=$&#123;param.total&#125;&quot;&gt;&lt;button class=&quot;confirmPay&quot;&gt;确认支付&lt;/button&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; 06 支付成功页 在上一步确认访问按钮提交数据到/forepayed,导致ForeController.payed方法被调用1.1 获取参数oid1.2 根据oid获取到订单对象order1.3 修改订单对象的状态和支付时间1.4 更新这个订单对象到数据库1.5 把这个订单对象放在model的属性”o”上1.6 服务端跳转到payed.jsp payed.jsp与 register.jsp 相仿，payed.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是支付成功业务页面 payedPage.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/payedPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; payedPage.jsp显示订单中的地址，邮编，收货人，手机号码等等 1234567891011121314151617181920212223242526272829303132333435&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;payedDiv&quot;&gt; &lt;div class=&quot;payedTextDiv&quot;&gt; &lt;img src=&quot;img/site/paySuccess.png&quot;&gt; &lt;span&gt;您已成功付款&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;payedAddressInfo&quot;&gt; &lt;ul&gt; &lt;li&gt;收货地址：$&#123;o.address&#125; $&#123;o.receiver&#125; $&#123;o.mobile &#125;&lt;/li&gt; &lt;li&gt;实付款：&lt;span class=&quot;payedInfoPrice&quot;&gt; ￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;param.total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/li&gt; &lt;li&gt;预计08月08日送达 &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;paedCheckLinkDiv&quot;&gt; 您可以 &lt;a class=&quot;payedCheckLink&quot; href=&quot;forebought&quot;&gt;查看已买到的宝贝&lt;/a&gt; &lt;a class=&quot;payedCheckLink&quot; href=&quot;forebought&quot;&gt;查看交易详情 &lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;payedSeperateLine&quot;&gt; &lt;/div&gt; &lt;div class=&quot;warningDiv&quot;&gt; &lt;img src=&quot;img/site/warning.png&quot;&gt; &lt;b&gt;安全提醒：&lt;/b&gt;下单后，&lt;span class=&quot;redColor boldWord&quot;&gt;用QQ给您发送链接办理退款的都是骗子！&lt;/span&gt;天猫不存在系统升级，订单异常等问题，谨防假冒客服电话诈骗！ &lt;/div&gt; &lt;/div&gt; ForeController 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;) public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total; &#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; &#125; 7.3.9 我的订单页01 OrderService修改OrderService，新增方法 1List list(int uid, String excludedStatus); 123456789101112131415161718192021222324package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem; public interface OrderService &#123; String waitPay = &quot;waitPay&quot;; String waitDelivery = &quot;waitDelivery&quot;; String waitConfirm = &quot;waitConfirm&quot;; String waitReview = &quot;waitReview&quot;; String finish = &quot;finish&quot;; String delete = &quot;delete&quot;; void add(Order c); float add(Order c,List&lt;OrderItem&gt; ois); void delete(int id); void update(Order c); Order get(int id); List list(); List list(int uid, String excludedStatus);&#125; 02 OrderServiceImpl123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.OrderMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderExample;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.OrderService;import com.how2java.tmall.service.UserService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Propagation;import org.springframework.transaction.annotation.Transactional; import java.util.List; @Servicepublic class OrderServiceImpl implements OrderService &#123; @Autowired OrderMapper orderMapper; @Autowired UserService userService; @Autowired OrderItemService orderItemService; @Override public void add(Order c) &#123; orderMapper.insert(c); &#125; @Override public void delete(int id) &#123; orderMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Order c) &#123; orderMapper.updateByPrimaryKeySelective(c); &#125; @Override public Order get(int id) &#123; return orderMapper.selectByPrimaryKey(id); &#125; public List&lt;Order&gt; list()&#123; OrderExample example =new OrderExample(); example.setOrderByClause(&quot;id desc&quot;); return orderMapper.selectByExample(example); &#125; @Override public List list(int uid, String excludedStatus) &#123; OrderExample example =new OrderExample(); example.createCriteria().andUidEqualTo(uid).andStatusNotEqualTo(excludedStatus); example.setOrderByClause(&quot;id desc&quot;); return orderMapper.selectByExample(example); &#125; ; public void setUser(List&lt;Order&gt; os)&#123; for (Order o : os) setUser(o); &#125; public void setUser(Order o)&#123; int uid = o.getUid(); User u = userService.get(uid); o.setUser(u); &#125; @Override @Transactional(propagation= Propagation.REQUIRED,rollbackForClassName=&quot;Exception&quot;) public float add(Order o, List&lt;OrderItem&gt; ois) &#123; float total = 0; add(o); if(false) throw new RuntimeException(); for (OrderItem oi: ois) &#123; oi.setOid(o.getId()); orderItemService.update(oi); total+=oi.getProduct().getPromotePrice()*oi.getNumber(); &#125; return total; &#125; &#125; 03 ForeController.bought()/forebought导致ForeController.bought()方法被调用 通过session获取用户user 查询user所有的状态不是”delete” 的订单集合os 为这些订单填充订单项 把os放在model的属性”os”上 服务端跳转到bought.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;) public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total; &#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; &#125; 04 bought.jsp与 register.jsp 相仿，bought.jsp 也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是我的订单页面 boughtPage.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/boughtPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 05 boughtPage.jsp在boughtPage.jsp中，从93行开始到172行，做二次遍历 遍历订单集合os取出每个订单，显示其创建日期，订单号，总数量和总金额等 遍历每个订单下的订单项集合o.orderItemsd显示每个订单项对应的产品的图片，标题，原始价格，优惠价格等 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;var deleteOrder = false;var deleteOrderid = 0; $(function()&#123; $(&quot;a[orderStatus]&quot;).click(function()&#123; var orderStatus = $(this).attr(&quot;orderStatus&quot;); if(&#x27;all&#x27;==orderStatus)&#123; $(&quot;table[orderStatus]&quot;).show(); &#125; else&#123; $(&quot;table[orderStatus]&quot;).hide(); $(&quot;table[orderStatus=&quot;+orderStatus+&quot;]&quot;).show(); &#125; $(&quot;div.orderType div&quot;).removeClass(&quot;selectedOrderType&quot;); $(this).parent(&quot;div&quot;).addClass(&quot;selectedOrderType&quot;); &#125;); $(&quot;a.deleteOrderLink&quot;).click(function()&#123; deleteOrderid = $(this).attr(&quot;oid&quot;); deleteOrder = false; $(&quot;#deleteConfirmModal&quot;).modal(&quot;show&quot;); &#125;); $(&quot;button.deleteConfirmButton&quot;).click(function()&#123; deleteOrder = true; $(&quot;#deleteConfirmModal&quot;).modal(&#x27;hide&#x27;); &#125;); $(&#x27;#deleteConfirmModal&#x27;).on(&#x27;hidden.bs.modal&#x27;, function (e) &#123; if(deleteOrder)&#123; var page=&quot;foredeleteOrder&quot;; $.post( page, &#123;&quot;oid&quot;:deleteOrderid&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; $(&quot;table.orderListItemTable[oid=&quot;+deleteOrderid+&quot;]&quot;).hide(); &#125; else&#123; location.href=&quot;login.jsp&quot;; &#125; &#125; ); &#125; &#125;) $(&quot;.ask2delivery&quot;).click(function()&#123; var link = $(this).attr(&quot;link&quot;); $(this).hide(); page = link; $.ajax(&#123; url: page, success: function(result)&#123; alert(&quot;卖家已秒发，刷新当前页面，即可进行确认收货&quot;) &#125; &#125;); &#125;);&#125;); &lt;/script&gt; &lt;div class=&quot;boughtDiv&quot;&gt; &lt;div class=&quot;orderType&quot;&gt; &lt;div class=&quot;selectedOrderType&quot;&gt;&lt;a orderStatus=&quot;all&quot; href=&quot;#nowhere&quot;&gt;所有订单&lt;/a&gt;&lt;/div&gt; &lt;div&gt;&lt;a orderStatus=&quot;waitPay&quot; href=&quot;#nowhere&quot;&gt;待付款&lt;/a&gt;&lt;/div&gt; &lt;div&gt;&lt;a orderStatus=&quot;waitDelivery&quot; href=&quot;#nowhere&quot;&gt;待发货&lt;/a&gt;&lt;/div&gt; &lt;div&gt;&lt;a orderStatus=&quot;waitConfirm&quot; href=&quot;#nowhere&quot;&gt;待收货&lt;/a&gt;&lt;/div&gt; &lt;div&gt;&lt;a orderStatus=&quot;waitReview&quot; href=&quot;#nowhere&quot; class=&quot;noRightborder&quot;&gt;待评价&lt;/a&gt;&lt;/div&gt; &lt;div class=&quot;orderTypeLastOne&quot;&gt;&lt;a class=&quot;noRightborder&quot;&gt;&lt;/a&gt;&lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;div class=&quot;orderListTitle&quot;&gt; &lt;table class=&quot;orderListTitleTable&quot;&gt; &lt;tr&gt; &lt;td&gt;宝贝&lt;/td&gt; &lt;td width=&quot;100px&quot;&gt;单价&lt;/td&gt; &lt;td width=&quot;100px&quot;&gt;数量&lt;/td&gt; &lt;td width=&quot;120px&quot;&gt;实付款&lt;/td&gt; &lt;td width=&quot;100px&quot;&gt;交易操作&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;orderListItem&quot;&gt; &lt;c:forEach items=&quot;$&#123;os&#125;&quot; var=&quot;o&quot;&gt; &lt;table class=&quot;orderListItemTable&quot; orderStatus=&quot;$&#123;o.status&#125;&quot; oid=&quot;$&#123;o.id&#125;&quot;&gt; &lt;tr class=&quot;orderListItemFirstTR&quot;&gt; &lt;td colspan=&quot;2&quot;&gt; &lt;b&gt;&lt;fmt:formatDate value=&quot;$&#123;o.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/b&gt; &lt;span&gt;订单号: $&#123;o.orderCode&#125; &lt;/span&gt; &lt;/td&gt; &lt;td colspan=&quot;2&quot;&gt;&lt;img width=&quot;13px&quot; src=&quot;img/site/orderItemTmall.png&quot;&gt;天猫商场&lt;/td&gt; &lt;td colspan=&quot;1&quot;&gt; &lt;a class=&quot;wangwanglink&quot; href=&quot;#nowhere&quot;&gt; &lt;div class=&quot;orderItemWangWangGif&quot;&gt;&lt;/div&gt; &lt;/a&gt; &lt;/td&gt; &lt;td class=&quot;orderItemDeleteTD&quot;&gt; &lt;a class=&quot;deleteOrderLink&quot; oid=&quot;$&#123;o.id&#125;&quot; href=&quot;#nowhere&quot;&gt; &lt;span class=&quot;orderListItemDelete glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt; &lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;c:forEach items=&quot;$&#123;o.orderItems&#125;&quot; var=&quot;oi&quot; varStatus=&quot;st&quot;&gt; &lt;tr class=&quot;orderItemProductInfoPartTR&quot; &gt; &lt;td class=&quot;orderItemProductInfoPartTD&quot;&gt;&lt;img width=&quot;80&quot; height=&quot;80&quot; src=&quot;img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td class=&quot;orderItemProductInfoPartTD&quot;&gt; &lt;div class=&quot;orderListItemProductLinkOutDiv&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;oi.product.id&#125;&quot;&gt;$&#123;oi.product.name&#125;&lt;/a&gt; &lt;div class=&quot;orderListItemProductLinkInnerDiv&quot;&gt; &lt;img src=&quot;img/site/creditcard.png&quot; title=&quot;支持信用卡支付&quot;&gt; &lt;img src=&quot;img/site/7day.png&quot; title=&quot;消费者保障服务,承诺7天退货&quot;&gt; &lt;img src=&quot;img/site/promise.png&quot; title=&quot;消费者保障服务,承诺如实描述&quot;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/td&gt; &lt;td class=&quot;orderItemProductInfoPartTD&quot; width=&quot;100px&quot;&gt; &lt;div class=&quot;orderListItemProductOriginalPrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/div&gt; &lt;div class=&quot;orderListItemProductPrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/div&gt; &lt;/td&gt; &lt;c:if test=&quot;$&#123;st.count==1&#125;&quot;&gt; &lt;td valign=&quot;top&quot; rowspan=&quot;$&#123;fn:length(o.orderItems)&#125;&quot; class=&quot;orderListItemNumberTD orderItemOrderInfoPartTD&quot; width=&quot;100px&quot;&gt; &lt;span class=&quot;orderListItemNumber&quot;&gt;$&#123;o.totalNumber&#125;&lt;/span&gt; &lt;/td&gt; &lt;td valign=&quot;top&quot; rowspan=&quot;$&#123;fn:length(o.orderItems)&#125;&quot; width=&quot;120px&quot; class=&quot;orderListItemProductRealPriceTD orderItemOrderInfoPartTD&quot;&gt; &lt;div class=&quot;orderListItemProductRealPrice&quot;&gt;￥&lt;fmt:formatNumber minFractionDigits=&quot;2&quot; maxFractionDigits=&quot;2&quot; type=&quot;number&quot; value=&quot;$&#123;o.total&#125;&quot;/&gt;&lt;/div&gt; &lt;div class=&quot;orderListItemPriceWithTransport&quot;&gt;(含运费：￥0.00)&lt;/div&gt; &lt;/td&gt; &lt;td valign=&quot;top&quot; rowspan=&quot;$&#123;fn:length(o.orderItems)&#125;&quot; class=&quot;orderListItemButtonTD orderItemOrderInfoPartTD&quot; width=&quot;100px&quot;&gt; &lt;c:if test=&quot;$&#123;o.status==&#x27;waitConfirm&#x27; &#125;&quot;&gt; &lt;a href=&quot;foreconfirmPay?oid=$&#123;o.id&#125;&quot;&gt; &lt;button class=&quot;orderListItemConfirm&quot;&gt;确认收货&lt;/button&gt; &lt;/a&gt; &lt;/c:if&gt; &lt;c:if test=&quot;$&#123;o.status==&#x27;waitPay&#x27; &#125;&quot;&gt; &lt;a href=&quot;forealipay?oid=$&#123;o.id&#125;&amp;total=$&#123;o.total&#125;&quot;&gt; &lt;button class=&quot;orderListItemConfirm&quot;&gt;付款&lt;/button&gt; &lt;/a&gt; &lt;/c:if&gt; &lt;c:if test=&quot;$&#123;o.status==&#x27;waitDelivery&#x27; &#125;&quot;&gt; &lt;span&gt;待发货&lt;/span&gt;&lt;%-- &lt;button class=&quot;btn btn-info btn-sm ask2delivery&quot; link=&quot;admin_order_delivery?id=$&#123;o.id&#125;&quot;&gt;催卖家发货&lt;/button&gt; --%&gt; &lt;/c:if&gt; &lt;c:if test=&quot;$&#123;o.status==&#x27;waitReview&#x27; &#125;&quot;&gt; &lt;a href=&quot;forereview?oid=$&#123;o.id&#125;&quot;&gt; &lt;button class=&quot;orderListItemReview&quot;&gt;评价&lt;/button&gt; &lt;/a&gt; &lt;/c:if&gt; &lt;/td&gt; &lt;/c:if&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/table&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; 7.3.10 我的订单页操作在我的订单页面，根据订单的不同状态，可以做出如下不同的操作： 付款 —— 已经生成，但是未付款 点击付款按钮直接跳转到在生成订单中的确认支付页环节，属于已经开发的功能，在此不作赘述。 确认收货 —— 通过后台发货后 评价 —— 确认收货后, 讲在评价产品知识点讲解，这里只是提到 删除 —— 任意状态下 01 确认收货 点击确认收货后，访问地址/foreconfirmPay ForeController.confirmPay()方法被调用2.1 获取参数oid2.2 通过oid获取订单对象o2.3 为订单对象填充订单项2.4 把订单对象放在request的属性”o”上2.5 服务端跳转到 confirmPay.jsp confirmPay.jsp与 register.jsp 相仿，confirmPay.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是订单确认业务页面 confirmPayPage.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/confirmPayPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; confirmPayPage.jsp显示订单的创建时间，付款时间和发货时间，以及订单号，收款人信息等遍历订单项集合，显示其中的产品图片，产品标题，价格，数量，小计，总结信息最后提供确认支付按钮，提交到/foreorderconfirmed路径 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;confirmPayPageDiv&quot;&gt; &lt;div class=&quot;confirmPayImageDiv&quot;&gt; &lt;img src=&quot;img/site/comformPayFlow.png&quot;&gt; &lt;div class=&quot;confirmPayTime1&quot;&gt; &lt;fmt:formatDate value=&quot;$&#123;o.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayTime2&quot;&gt; &lt;fmt:formatDate value=&quot;$&#123;o.payDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayTime3&quot;&gt; yyyy-MM-dd HH:mm:ss &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayOrderInfoDiv&quot;&gt; &lt;div class=&quot;confirmPayOrderInfoText&quot;&gt;我已收到货，同意支付宝付款&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayOrderItemDiv&quot;&gt; &lt;div class=&quot;confirmPayOrderItemText&quot;&gt;订单信息&lt;/div&gt; &lt;table class=&quot;confirmPayOrderItemTable&quot;&gt; &lt;thead&gt; &lt;th colspan=&quot;2&quot;&gt;宝贝&lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;单价&lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;数量&lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;商品总价 &lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;运费&lt;/th&gt; &lt;/thead&gt; &lt;c:forEach items=&quot;$&#123;o.orderItems&#125;&quot; var=&quot;oi&quot;&gt; &lt;tr&gt; &lt;td&gt;&lt;img width=&quot;50px&quot; src=&quot;img/productSingle_middle/$&#123;oi.product.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td class=&quot;confirmPayOrderItemProductLink&quot;&gt; &lt;a href=&quot;#nowhere&quot;&gt;$&#123;oi.product.name&#125;&lt;/a&gt; &lt;/td&gt; &lt;td&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/td&gt; &lt;td&gt;1&lt;/td&gt; &lt;td&gt;&lt;span class=&quot;conformPayProductPrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;oi.product.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt;&lt;/td&gt; &lt;td&gt;&lt;span&gt;快递 ： 0.00 &lt;/span&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/table&gt; &lt;div class=&quot;confirmPayOrderItemText pull-right&quot;&gt; 实付款： &lt;span class=&quot;confirmPayOrderItemSumPrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;o.total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayOrderDetailDiv&quot;&gt; &lt;table class=&quot;confirmPayOrderDetailTable&quot;&gt; &lt;tr&gt; &lt;td&gt;订单编号：&lt;/td&gt; &lt;td&gt;$&#123;o.orderCode&#125; &lt;img width=&quot;23px&quot; src=&quot;img/site/confirmOrderTmall.png&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;卖家昵称：&lt;/td&gt; &lt;td&gt;天猫商铺 &lt;span class=&quot;confirmPayOrderDetailWangWangGif&quot;&gt;&lt;/span&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;收货信息： &lt;/td&gt; &lt;td&gt;$&#123;o.address&#125;，$&#123;o.receiver&#125;， $&#123;o.mobile&#125;，$&#123;o.post&#125; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;成交时间：&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;o.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;confirmPayButtonDiv&quot;&gt; &lt;div class=&quot;confirmPayWarning&quot;&gt;请收到货后，再确认收货！否则您可能钱货两空！&lt;/div&gt; &lt;a href=&quot;foreorderConfirmed?oid=$&#123;o.id&#125;&quot;&gt;&lt;button class=&quot;confirmPayButton&quot;&gt;确认支付&lt;/button&gt;&lt;/a&gt; &lt;/div&gt;&lt;/div&gt; ForeController 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total;&#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; @RequestMapping(&quot;foreconfirmPay&quot;) public String confirmPay( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); model.addAttribute(&quot;o&quot;, o); return &quot;fore/confirmPay&quot;; &#125;&#125; 02 确认收货成功通过上一步最后的确认支付按钮，提交到路径/foreorderConfirmed，导致ForeController.orderConfirmed()方法被调用 ForeController.orderConfirmed() 方法1.1 获取参数oid1.2 根据参数oid获取Order对象o1.3 修改对象o的状态为等待评价，修改其确认支付时间1.4 更新到数据库1.5 服务端跳转到orderConfirmed.jsp页面 orderConfirmed.jsp与 register.jsp 相仿，orderConfirmed.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是确认收货成功业务页面 orderConfirmedPage.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/orderConfirmedPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; orderConfirmedPage.jsp显示”交易已经成功，卖家将收到您的货款。” 123456789&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;orderFinishDiv&quot;&gt; &lt;div class=&quot;orderFinishTextDiv&quot;&gt; &lt;img src=&quot;img/site/orderFinish.png&quot;&gt; &lt;span&gt;交易已经成功，卖家将收到您的货款。&lt;/span&gt; &lt;/div&gt;&lt;/div&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total;&#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; @RequestMapping(&quot;foreconfirmPay&quot;) public String confirmPay( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); model.addAttribute(&quot;o&quot;, o); return &quot;fore/confirmPay&quot;; &#125; @RequestMapping(&quot;foreorderConfirmed&quot;) public String orderConfirmed( Model model,int oid) &#123; Order o = orderService.get(oid); o.setStatus(OrderService.waitReview); o.setConfirmDate(new Date()); orderService.update(o); return &quot;fore/orderConfirmed&quot;; &#125;&#125; 03 评价点击评价按钮，跳转到路径/forereview 04 删除在我的订单页 上点击删除按钮，根据 boughtPage.jsp 中的ajax操作，会访问路径/foredeleteOrder，导致ForeController.deleteOrder方法被调用 ForeController.deleteOrder()1.1 获取参数oid1.2 根据oid获取订单对象o1.3 修改状态1.4 更新到数据库1.5 返回字符串”success” boughtPage.jsp 中的javascript代码获取返回字符串是success的时候，隐藏掉当前这行订单数据。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total;&#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; @RequestMapping(&quot;foreconfirmPay&quot;) public String confirmPay( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); model.addAttribute(&quot;o&quot;, o); return &quot;fore/confirmPay&quot;; &#125; @RequestMapping(&quot;foreorderConfirmed&quot;) public String orderConfirmed( Model model,int oid) &#123; Order o = orderService.get(oid); o.setStatus(OrderService.waitReview); o.setConfirmDate(new Date()); orderService.update(o); return &quot;fore/orderConfirmed&quot;; &#125; @RequestMapping(&quot;foredeleteOrder&quot;) @ResponseBody public String deleteOrder( Model model,int oid)&#123; Order o = orderService.get(oid); o.setStatus(OrderService.delete); orderService.update(o); return &quot;success&quot;; &#125;&#125; 7.3.11 评价产品01 评价产品页面通过点击评价按钮，来到路径/forereview，导致ForeController.review()方法被调用 ForeController.review()1.1 获取参数oid1.2 根据oid获取订单对象o1.3 为订单对象填充订单项1.4 获取第一个订单项对应的产品,因为在评价页面需要显示一个产品图片，那么就使用这第一个产品的图片了1.5 获取这个产品的评价集合1.6 为产品设置评价数量和销量1.7 把产品，订单和评价集合放在request上1.8 服务端跳转到 review.jsp review.jsp与 register.jsp 相仿，review.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp，footer.jsp 等公共页面。中间是产品业务页面 reviewPage.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/cart/reviewPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; reviewPage.jsp在reviewPage.jsp中显示产品图片，产品标题，价格，产品销量，产品评价数量，以及订单信息等。同时还显示出了该产品所有的评价，但是默认是隐藏的 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;reviewDiv&quot;&gt; &lt;div class=&quot;reviewProductInfoDiv&quot;&gt; &lt;div class=&quot;reviewProductInfoImg&quot;&gt;&lt;img width=&quot;400px&quot; height=&quot;400px&quot; src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/div&gt; &lt;div class=&quot;reviewProductInfoRightDiv&quot;&gt; &lt;div class=&quot;reviewProductInfoRightText&quot;&gt; $&#123;p.name&#125; &lt;/div&gt; &lt;table class=&quot;reviewProductInfoTable&quot;&gt; &lt;tr&gt; &lt;td width=&quot;75px&quot;&gt;价格:&lt;/td&gt; &lt;td&gt;&lt;span class=&quot;reviewProductInfoTablePrice&quot;&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; 元 &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;配送&lt;/td&gt; &lt;td&gt;快递: 0.00&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;月销量:&lt;/td&gt; &lt;td&gt;&lt;span class=&quot;reviewProductInfoTableSellNumber&quot;&gt;$&#123;p.saleCount&#125;&lt;/span&gt; 件&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;div class=&quot;reviewProductInfoRightBelowDiv&quot;&gt; &lt;span class=&quot;reviewProductInfoRightBelowImg&quot;&gt;&lt;img1 src=&quot;img/site/reviewLight.png&quot;&gt;&lt;/span&gt; &lt;span class=&quot;reviewProductInfoRightBelowText&quot; &gt;现在查看的是 您所购买商品的信息于&lt;fmt:formatDate value=&quot;$&#123;o.createDate&#125;&quot; pattern=&quot;yyyy年MM月dd&quot;/&gt;下单购买了此商品 &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;reviewStasticsDiv&quot;&gt; &lt;div class=&quot;reviewStasticsLeft&quot;&gt; &lt;div class=&quot;reviewStasticsLeftTop&quot;&gt;&lt;/div&gt; &lt;div class=&quot;reviewStasticsLeftContent&quot;&gt;累计评价 &lt;span class=&quot;reviewStasticsNumber&quot;&gt; $&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; &lt;div class=&quot;reviewStasticsLeftFoot&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;reviewStasticsRight&quot;&gt; &lt;div class=&quot;reviewStasticsRightEmpty&quot;&gt;&lt;/div&gt; &lt;div class=&quot;reviewStasticsFoot&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;c:if test=&quot;$&#123;param.showonly==true&#125;&quot;&gt; &lt;div class=&quot;reviewDivlistReviews&quot;&gt; &lt;c:forEach items=&quot;$&#123;reviews&#125;&quot; var=&quot;r&quot;&gt; &lt;div class=&quot;reviewDivlistReviewsEach&quot;&gt; &lt;div class=&quot;reviewDate&quot;&gt;&lt;fmt:formatDate value=&quot;$&#123;r.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd&quot;/&gt;&lt;/div&gt; &lt;div class=&quot;reviewContent&quot;&gt;$&#123;r.content&#125;&lt;/div&gt; &lt;div class=&quot;reviewUserInfo pull-right&quot;&gt;$&#123;r.user.anonymousName&#125;&lt;span class=&quot;reviewUserInfoAnonymous&quot;&gt;(匿名)&lt;/span&gt;&lt;/div&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/c:if&gt; &lt;c:if test=&quot;$&#123;param.showonly!=true&#125;&quot;&gt; &lt;div class=&quot;makeReviewDiv&quot;&gt; &lt;form method=&quot;post&quot; action=&quot;foredoreview&quot;&gt; &lt;div class=&quot;makeReviewText&quot;&gt;其他买家，需要你的建议哦！&lt;/div&gt; &lt;table class=&quot;makeReviewTable&quot;&gt; &lt;tr&gt; &lt;td class=&quot;makeReviewTableFirstTD&quot;&gt;评价商品&lt;/td&gt; &lt;td&gt;&lt;textarea name=&quot;content&quot;&gt;&lt;/textarea&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;div class=&quot;makeReviewButtonDiv&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;oid&quot; value=&quot;$&#123;o.id&#125;&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;$&#123;p.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot;&gt;提交评价&lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;/c:if&gt; &lt;/div&gt; ForeController 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total;&#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; @RequestMapping(&quot;foreconfirmPay&quot;) public String confirmPay( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); model.addAttribute(&quot;o&quot;, o); return &quot;fore/confirmPay&quot;; &#125; @RequestMapping(&quot;foreorderConfirmed&quot;) public String orderConfirmed( Model model,int oid) &#123; Order o = orderService.get(oid); o.setStatus(OrderService.waitReview); o.setConfirmDate(new Date()); orderService.update(o); return &quot;fore/orderConfirmed&quot;; &#125; @RequestMapping(&quot;foredeleteOrder&quot;) @ResponseBody public String deleteOrder( Model model,int oid)&#123; Order o = orderService.get(oid); o.setStatus(OrderService.delete); orderService.update(o); return &quot;success&quot;; &#125; @RequestMapping(&quot;forereview&quot;) public String review( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); Product p = o.getOrderItems().get(0).getProduct(); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;o&quot;, o); model.addAttribute(&quot;reviews&quot;, reviews); return &quot;fore/review&quot;; &#125; &#125; 02 提交评价在评价产品页面点击提交评价，就把数据提交到了/foredoreview路径，导致ForeController.doreview方法被调用 ForeController.doreview()1.1 获取参数oid1.2 根据oid获取订单对象o1.3 修改订单对象状态1.4 更新订单对象到数据库1.5 获取参数pid1.6 根据pid获取产品对象1.7 获取参数content (评价信息)1.8 对评价信息进行转义，道理同注册ForeController.register()1.9 从session中获取当前用户1.10 创建评价对象review1.11 为评价对象review设置 评价信息，产品，时间，用户1.12 增加到数据库1.13.客户端跳转到/forereview： 评价产品页面，并带上参数showonly=true reviewPage.jsp在reviewPage.jsp中，当参数showonly==true，那么就显示当前产品的所有评价信息 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.apache.commons.lang.math.RandomUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collections;import java.util.Date;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125; @RequestMapping(&quot;forebuyone&quot;) public String buyone(int pid, int num, HttpSession session) &#123; Product p = productService.get(pid); int oiid = 0; User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; oiid = oi.getId(); break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); oiid = oi.getId(); &#125; return &quot;redirect:forebuy?oiid=&quot;+oiid; &#125; @RequestMapping(&quot;forebuy&quot;) public String buy( Model model,String[] oiid,HttpSession session)&#123; List&lt;OrderItem&gt; ois = new ArrayList&lt;&gt;(); float total = 0; for (String strid : oiid) &#123; int id = Integer.parseInt(strid); OrderItem oi= orderItemService.get(id); total +=oi.getProduct().getPromotePrice()*oi.getNumber(); ois.add(oi); &#125; session.setAttribute(&quot;ois&quot;, ois); model.addAttribute(&quot;total&quot;, total); return &quot;fore/buy&quot;; &#125; @RequestMapping(&quot;foreaddCart&quot;) @ResponseBody public String addCart(int pid, int num, Model model,HttpSession session) &#123; Product p = productService.get(pid); User user =(User) session.getAttribute(&quot;user&quot;); boolean found = false; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==p.getId().intValue())&#123; oi.setNumber(oi.getNumber()+num); orderItemService.update(oi); found = true; break; &#125; &#125; if(!found)&#123; OrderItem oi = new OrderItem(); oi.setUid(user.getId()); oi.setNumber(num); oi.setPid(pid); orderItemService.add(oi); &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;forecart&quot;) public String cart( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); model.addAttribute(&quot;ois&quot;, ois); return &quot;fore/cart&quot;; &#125; @RequestMapping(&quot;forechangeOrderItem&quot;) @ResponseBody public String changeOrderItem( Model model,HttpSession session, int pid, int number) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; List&lt;OrderItem&gt; ois = orderItemService.listByUser(user.getId()); for (OrderItem oi : ois) &#123; if(oi.getProduct().getId().intValue()==pid)&#123; oi.setNumber(number); orderItemService.update(oi); break; &#125; &#125; return &quot;success&quot;; &#125; @RequestMapping(&quot;foredeleteOrderItem&quot;) @ResponseBody public String deleteOrderItem( Model model,HttpSession session,int oiid)&#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null==user) return &quot;fail&quot;; orderItemService.delete(oiid); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecreateOrder&quot;)public String createOrder( Model model,Order order,HttpSession session)&#123; User user =(User) session.getAttribute(&quot;user&quot;); String orderCode = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date()) + RandomUtils.nextInt(10000); order.setOrderCode(orderCode); order.setCreateDate(new Date()); order.setUid(user.getId()); order.setStatus(OrderService.waitPay); List&lt;OrderItem&gt; ois= (List&lt;OrderItem&gt;) session.getAttribute(&quot;ois&quot;); float total =orderService.add(order,ois); return &quot;redirect:forealipay?oid=&quot;+order.getId() +&quot;&amp;total=&quot;+total;&#125; @RequestMapping(&quot;forepayed&quot;) public String payed(int oid, float total, Model model) &#123; Order order = orderService.get(oid); order.setStatus(OrderService.waitDelivery); order.setPayDate(new Date()); orderService.update(order); model.addAttribute(&quot;o&quot;, order); return &quot;fore/payed&quot;; &#125; @RequestMapping(&quot;forebought&quot;) public String bought( Model model,HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); List&lt;Order&gt; os= orderService.list(user.getId(),OrderService.delete); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); return &quot;fore/bought&quot;; &#125; @RequestMapping(&quot;foreconfirmPay&quot;) public String confirmPay( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); model.addAttribute(&quot;o&quot;, o); return &quot;fore/confirmPay&quot;; &#125; @RequestMapping(&quot;foreorderConfirmed&quot;) public String orderConfirmed( Model model,int oid) &#123; Order o = orderService.get(oid); o.setStatus(OrderService.waitReview); o.setConfirmDate(new Date()); orderService.update(o); return &quot;fore/orderConfirmed&quot;; &#125; @RequestMapping(&quot;foredeleteOrder&quot;) @ResponseBody public String deleteOrder( Model model,int oid)&#123; Order o = orderService.get(oid); o.setStatus(OrderService.delete); orderService.update(o); return &quot;success&quot;; &#125; @RequestMapping(&quot;forereview&quot;) public String review( Model model,int oid) &#123; Order o = orderService.get(oid); orderItemService.fill(o); Product p = o.getOrderItems().get(0).getProduct(); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;o&quot;, o); model.addAttribute(&quot;reviews&quot;, reviews); return &quot;fore/review&quot;; &#125; @RequestMapping(&quot;foredoreview&quot;) public String doreview( Model model,HttpSession session,@RequestParam(&quot;oid&quot;) int oid,@RequestParam(&quot;pid&quot;) int pid,String content) &#123; Order o = orderService.get(oid); o.setStatus(OrderService.finish); orderService.update(o); Product p = productService.get(pid); content = HtmlUtils.htmlEscape(content); User user =(User) session.getAttribute(&quot;user&quot;); Review review = new Review(); review.setContent(content); review.setPid(pid); review.setCreateDate(new Date()); review.setUid(user.getId()); reviewService.add(review); return &quot;redirect:forereview?oid=&quot;+oid+&quot;&amp;showonly=true&quot;; &#125; &#125; 7.4 index.jsptmall_ssm\\src\\main\\webapp\\index.jsp 123&lt;% response.sendRedirect(&quot;forehome&quot;);%&gt; 8 项目总结8.1 项目结构 项目名称 tmall_ssm java源代码包结构pojo 实体类mapper Mapper类interceptor 拦截器controller 控制层service Service层test 测试类util 工具类comparator 比较类 web目录css css文件img 图片资源js js文件admin 后台管理用到的jsp文件fore 前台展示用到的jsp文件include 被包含的jsp文件 8.2 典型场景经过这个项目，我们都完成了如下的一系列典型场景功能 购物车立即购买 加入购物车 查看购物车页面 购物车页面操作 订单状态流转生成订单 确认支付 后台发货 确认收货 评价 CRUD后台各种功能 分页后台各种功能 一类产品多属性配置属性管理 一款产品多图片维护产品图片管理 产品展示前台首页 前台产品页 搜索查询搜索 登录、注册注册 登录 退出 登录验证登录状态拦截器 事务管理ForeController.对createOrder进行事务管理等等 。。。 8.3 设计模式 MVCMVC设计模式贯穿于整个后台与前台功能开发始末 重构通过发现问题，分析问题，解决问题的三部曲，进行了各种角度的重构。经历这样一个重构过程提高开发效率，降低维护成本分页方式 ，分类逆向工程 ，所有逆向工程 统一的分页查询简化开发所有的后台都使用同一个分页机制，仅仅需要一份简化的adminPage.jsp即满足了各种分页功能的需求，简化了开发，提升了开发速度。 模块化JSP设计从大的JSP文件中，通过JSP包含关系抽象出多个公共文件，并把业务JSP按照功能，设计为多个小的JSP文件，便于维护和理解","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目07","date":"2020-09-19T06:27:25.000Z","path":"2020/09/19/电商网站的SSM项目07/","text":"7.2 前台无需登录通过前台-首页的学习，就把前台的思路都理顺了，包括jsp页面的包含关系等。在此基础上，学习其他前台页面就更加容易理解了。根据模仿天猫的前台功能特点，我们把前台功能分为两部分 无需登录有一些功能，无需登录也可以使用的，比如登录，注册本身，分类页面，查询，产品页面等 需要登录有一些功能，必须建立在已经登录的基础之上，比如购买，加入购物车，查看购物车，结算页面，订单页面等等。 接下来先讲解无需登录的功能，然后再是需要登录的前台功能。 7.2.1 注册01 register.jsp与首页的home.jsp相仿，register.jsp也包含了header.jsp,top.jsp,footer.jsp等公共页面。不同的是，没有使用首页的search.jsp,而是用的简单一点的 simpleSearch.jsp 中间是注册业务页面registerPage.jsp tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\register.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;&lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/registerPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 02 PageControllerregister.jsp 是放在WEB-INF目录下的，是无法通过浏览器直接访问的。 为了访问这些放在WEB-INF下的jsp，准备一个专门的PageController类，专门做服务端跳转。 比如访问registerPage，就会服务端跳转到WEB-INF/jsp/fore/register.jsp 去，这样就解决了无法被访问的问题。 这个类很简单，就是单纯用来做服务端跳转用的。 12345678910111213141516171819202122232425package com.how2java.tmall.controller; import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping; @Controller@RequestMapping(&quot;&quot;)public class PageController &#123; @RequestMapping(&quot;registerPage&quot;) public String registerPage() &#123; return &quot;fore/register&quot;; &#125; @RequestMapping(&quot;registerSuccessPage&quot;) public String registerSuccessPage() &#123; return &quot;fore/registerSuccess&quot;; &#125; @RequestMapping(&quot;loginPage&quot;) public String loginPage() &#123; return &quot;fore/login&quot;; &#125; @RequestMapping(&quot;forealipay&quot;) public String alipay()&#123; return &quot;fore/alipay&quot;; &#125;&#125; 03 simpleSearch.jsp与首页的search.jsp不太一样的是，这个搜索栏要更简单一些，并且左右分开。 123456789101112131415161718192021222324252627282930&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div &gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;img id=&quot;simpleLogo&quot; class=&quot;simpleLogo&quot; src=&quot;img/site/simpleLogo.png&quot;&gt; &lt;/a&gt; &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt; &lt;div class=&quot;simpleSearchDiv pull-right&quot;&gt; &lt;input type=&quot;text&quot; placeholder=&quot;平衡车 原汁机&quot; name=&quot;keyword&quot;&gt; &lt;button class=&quot;searchButton&quot; type=&quot;submit&quot;&gt;搜天猫&lt;/button&gt; &lt;div class=&quot;searchBelow&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&gt;=8 and st.count&lt;=11&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;c:if test=&quot;$&#123;st.count!=11&#125;&quot;&gt; &lt;span&gt;|&lt;/span&gt; &lt;/c:if&gt; &lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&lt;/div&gt; 04 registerPage.jsp注册页面的主体功能，用于提交账号密码。 在提交之前会进行为空验证，以及密码是否一致验证。 这段代码用于当账号提交到服务端，服务端判断当前账号已经存在的情况下，显示返回的错误提示 “用户名已经被使用,不能使用” 1234&lt;c:if test=&quot;$&#123;!empty msg&#125;&quot;&gt;$(&quot;span.errorMessage&quot;).html(&quot;$&#123;msg&#125;&quot;);$(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); &lt;/c:if&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;$(function()&#123; &lt;c:if test=&quot;$&#123;!empty msg&#125;&quot;&gt; $(&quot;span.errorMessage&quot;).html(&quot;$&#123;msg&#125;&quot;); $(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); &lt;/c:if&gt; $(&quot;.registerForm&quot;).submit(function()&#123; if(0==$(&quot;#name&quot;).val().length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入用户名&quot;); $(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); return false; &#125; if(0==$(&quot;#password&quot;).val().length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入密码&quot;); $(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); return false; &#125; if(0==$(&quot;#repeatpassword&quot;).val().length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入重复密码&quot;); $(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); return false; &#125; if($(&quot;#password&quot;).val() !=$(&quot;#repeatpassword&quot;).val())&#123; $(&quot;span.errorMessage&quot;).html(&quot;重复密码不一致&quot;); $(&quot;div.registerErrorMessageDiv&quot;).css(&quot;visibility&quot;,&quot;visible&quot;); return false; &#125; return true; &#125;);&#125;)&lt;/script&gt; &lt;form method=&quot;post&quot; action=&quot;foreregister&quot; class=&quot;registerForm&quot;&gt; &lt;div class=&quot;registerDiv&quot;&gt; &lt;div class=&quot;registerErrorMessageDiv&quot;&gt; &lt;div class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt; &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt; &lt;span class=&quot;errorMessage&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;table class=&quot;registerTable&quot; align=&quot;center&quot;&gt; &lt;tr&gt; &lt;td class=&quot;registerTip registerTableLeftTD&quot;&gt;设置会员名&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class=&quot;registerTableLeftTD&quot;&gt;登陆名&lt;/td&gt; &lt;td class=&quot;registerTableRightTD&quot;&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;会员名一旦设置成功，无法修改&quot; &gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class=&quot;registerTip registerTableLeftTD&quot;&gt;设置登陆密码&lt;/td&gt; &lt;td class=&quot;registerTableRightTD&quot;&gt;登陆时验证，保护账号信息&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class=&quot;registerTableLeftTD&quot;&gt;登陆密码&lt;/td&gt; &lt;td class=&quot;registerTableRightTD&quot;&gt;&lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;设置你的登陆密码&quot; &gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class=&quot;registerTableLeftTD&quot;&gt;密码确认&lt;/td&gt; &lt;td class=&quot;registerTableRightTD&quot;&gt;&lt;input id=&quot;repeatpassword&quot; type=&quot;password&quot; placeholder=&quot;请再次输入你的密码&quot; &gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td colspan=&quot;2&quot; class=&quot;registerButtonTD&quot;&gt; &lt;a href=&quot;registerSuccess.jsp&quot;&gt;&lt;button&gt;提 交&lt;/button&gt;&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt;&lt;/div&gt;&lt;/form&gt; 05 UserServiceUserService新增加isExist(String name)方法 1234567891011121314package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.User; public interface UserService &#123; void add(User c); void delete(int id); void update(User c); User get(int id); List list(); boolean isExist(String name);&#125; 06 UserServiceImplUserServiceImpl 新增isExist(String name)的实现，判断某个名称是否已经被使用过了。 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.UserMapper;import com.how2java.tmall.pojo.User;import com.how2java.tmall.pojo.UserExample;import com.how2java.tmall.service.UserService; @Servicepublic class UserServiceImpl implements UserService &#123; @Autowired UserMapper userMapper; @Override public void add(User u) &#123; userMapper.insert(u); &#125; @Override public void delete(int id) &#123; userMapper.deleteByPrimaryKey(id); &#125; @Override public void update(User u) &#123; userMapper.updateByPrimaryKeySelective(u); &#125; @Override public User get(int id) &#123; return userMapper.selectByPrimaryKey(id); &#125; public List&lt;User&gt; list()&#123; UserExample example =new UserExample(); example.setOrderByClause(&quot;id desc&quot;); return userMapper.selectByExample(example); &#125; @Override public boolean isExist(String name) &#123; UserExample example =new UserExample(); example.createCriteria().andNameEqualTo(name); List&lt;User&gt; result= userMapper.selectByExample(example); if(!result.isEmpty()) return true; return false; &#125; &#125; 07 ForeController.register()registerPage.jsp 的form提交数据到路径 foreregister,导致ForeController.register()方法被调用 通过参数User获取浏览器提交的账号密码 通过HtmlUtils.htmlEscape(name);把账号里的特殊符号进行转义 判断用户名是否存在3.1 如果已经存在，就服务端跳转到reigster.jsp，并且带上错误提示信息3.2 如果不存在，则加入到数据库中，并服务端跳转到registerSuccess.jsp页面 注为什么要用 HtmlUtils.htmlEscape？ 因为在恶意注册的时候，会使用诸如 alert('papapa') 这样的名称，会导致网页打开就弹出一个对话框。 那么在转义之后，就没有这个问题了。注 model.addAttribute(“user”, null); 这句话的用处是当用户存在，服务端跳转到register.jsp的时候不带上参数user, 否则当注册失败的时候，会在原本是“请登录”的超链位置显示刚才注册的名称。 ForeController.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.util.HtmlUtils; import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); model.addAttribute(&quot;user&quot;, null); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; &#125; 08 registerSuccess.jsptmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\registerSuccess.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/registerSuccessPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 09 registerSuccessPage.jsp12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;registerSuccessDiv&quot;&gt; &lt;img src=&quot;img/site/registerSuccess.png&quot;&gt; 恭喜注册成功&lt;/div&gt; http://localhost:8080/tmall_ssm/foreregister 7.2.2 登录01 login.jsp与register.jsp相仿，login.jsp也包含了header.jsp,footer.jsp等公共页面。中间是登录业务页面loginPage.jsp tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\login.jsp 123456&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/loginPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 02 UserService增加get(String name, String password)方法 1234567891011121314package com.how2java.tmall.service; import java.util.List;import com.how2java.tmall.pojo.User;public interface UserService &#123; void add(User c); void delete(int id); void update(User c); User get(int id); List list(); boolean isExist(String name); User get(String name, String password);&#125; 03 UserServiceImpl增加User get(String name, String password) 方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.UserMapper;import com.how2java.tmall.pojo.User;import com.how2java.tmall.pojo.UserExample;import com.how2java.tmall.service.UserService; @Servicepublic class UserServiceImpl implements UserService &#123; @Autowired UserMapper userMapper; @Override public void add(User u) &#123; userMapper.insert(u); &#125; @Override public void delete(int id) &#123; userMapper.deleteByPrimaryKey(id); &#125; @Override public void update(User u) &#123; userMapper.updateByPrimaryKeySelective(u); &#125; @Override public User get(int id) &#123; return userMapper.selectByPrimaryKey(id); &#125; public List&lt;User&gt; list()&#123; UserExample example =new UserExample(); example.setOrderByClause(&quot;id desc&quot;); return userMapper.selectByExample(example); &#125; @Override public boolean isExist(String name) &#123; UserExample example =new UserExample(); example.createCriteria().andNameEqualTo(name); List&lt;User&gt; result= userMapper.selectByExample(example); if(!result.isEmpty()) return true; return false; &#125; @Override public User get(String name, String password) &#123; UserExample example =new UserExample(); example.createCriteria().andNameEqualTo(name).andPasswordEqualTo(password); List&lt;User&gt; result= userMapper.selectByExample(example); if(result.isEmpty()) return null; return result.get(0); &#125; &#125; 04 loginPage.jsp登陆业务页面，用于向服务器提交账号和密码 与registerPage.jsp类似的，用于显示登录密码错误 1234&lt;c:if test&#x3D;&quot;$&#123;!empty msg&#125;&quot;&gt;$(&quot;span.errorMessage&quot;).html(&quot;$&#123;msg&#125;&quot;);$(&quot;div.loginErrorMessageDiv&quot;).show(); &lt;&#x2F;c:if&gt; 其他js函数是用于为空验证 tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\loginPage.jsp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt; $(function()&#123; &lt;c:if test=&quot;$&#123;!empty msg&#125;&quot;&gt; $(&quot;span.errorMessage&quot;).html(&quot;$&#123;msg&#125;&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); &lt;/c:if&gt; $(&quot;form.loginForm&quot;).submit(function()&#123; if(0==$(&quot;#name&quot;).val().length||0==$(&quot;#password&quot;).val().length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入账号密码&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); return false; &#125; return true; &#125;); $(&quot;form.loginForm input&quot;).keyup(function()&#123; $(&quot;div.loginErrorMessageDiv&quot;).hide(); &#125;); var left = window.innerWidth/2+162; $(&quot;div.loginSmallDiv&quot;).css(&quot;left&quot;,left); &#125;)&lt;/script&gt; &lt;div id=&quot;loginDiv&quot; style=&quot;position: relative&quot;&gt; &lt;div class=&quot;simpleLogo&quot;&gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt;&lt;img src=&quot;img/site/simpleLogo.png&quot;&gt;&lt;/a&gt; &lt;/div&gt; &lt;img id=&quot;loginBackgroundImg&quot; class=&quot;loginBackgroundImg&quot; src=&quot;img/site/loginBackground.png&quot;&gt; &lt;form class=&quot;loginForm&quot; action=&quot;forelogin&quot; method=&quot;post&quot;&gt; &lt;div id=&quot;loginSmallDiv&quot; class=&quot;loginSmallDiv&quot;&gt; &lt;div class=&quot;loginErrorMessageDiv&quot;&gt; &lt;div class=&quot;alert alert-danger&quot; &gt; &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt; &lt;span class=&quot;errorMessage&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;login_acount_text&quot;&gt;账户登录&lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-user&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;手机/会员名/邮箱&quot; type=&quot;text&quot;&gt; &lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-lock&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;密码&quot; type=&quot;text&quot;&gt; &lt;/div&gt; &lt;span class=&quot;text-danger&quot;&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt; &lt;div&gt; &lt;a class=&quot;notImplementLink&quot; href=&quot;#nowhere&quot;&gt;忘记登录密码&lt;/a&gt; &lt;a href=&quot;registerPage&quot; class=&quot;pull-right&quot;&gt;免费注册&lt;/a&gt; &lt;/div&gt; &lt;div style=&quot;margin-top:20px&quot;&gt; &lt;button class=&quot;btn btn-block redButton&quot; type=&quot;submit&quot;&gt;登录&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; 05 ForeController.login()loginPage.jsp的form提交数据到路径 forelogin,导致ForeController.login()方法被调用 12345678910111213@RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125;&#125; 获取账号密码 把账号通过HtmlUtils.htmlEscape进行转义 根据账号和密码获取User对象3.1 如果对象为空，则服务端跳转回login.jsp，也带上错误信息，并且使用 loginPage.jsp 中的办法显示错误信息3.2 如果对象存在，则把对象保存在session中，并客户端跳转到首页”forehome”注 为什么要用 HtmlUtils.htmlEscape？ 因为注册的时候，ForeController.register()，就进行了转义，所以这里也需要转义。有些同学在恶意注册的时候，会使用诸如 alert('papapa') 这样的名称，会导致网页打开就弹出一个对话框。 那么在转义之后，就没有这个问题了。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125;&#125; 7.2.3 退出在登录成功后，点击置顶导航的退出 通过访问退出路径： http://127.0.0.1:8080/tmall_ssm/forelogout 导致ForeController.logout()方法被调用 01 ForeController.logout()123456@RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); //在session中去掉&quot;user&quot; return &quot;redirect:forehome&quot;; //客户端跳转到首页: &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125;&#125; 7.2.4 产品页01 Product123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147package com.how2java.tmall.pojo; import java.util.Date;import java.util.List; public class Product &#123; private Integer id; private String name; private String subTitle; private Float originalPrice; private Float promotePrice; private Integer stock; private Integer cid; private Date createDate; /*非数据库字段*/ private Category category; private ProductImage firstProductImage; private List&lt;ProductImage&gt; productSingleImages; //单个产品图片集合 private List&lt;ProductImage&gt; productDetailImages; //详情产品图片集合 private int saleCount; //销量 private int reviewCount; //累计评价 public Category getCategory() &#123; return category; &#125; public void setCategory(Category category) &#123; this.category = category; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125; public String getSubTitle() &#123; return subTitle; &#125; public void setSubTitle(String subTitle) &#123; this.subTitle = subTitle == null ? null : subTitle.trim(); &#125; public Float getOriginalPrice() &#123; return originalPrice; &#125; public void setOriginalPrice(Float originalPrice) &#123; this.originalPrice = originalPrice; &#125; public Float getPromotePrice() &#123; return promotePrice; &#125; public void setPromotePrice(Float promotePrice) &#123; this.promotePrice = promotePrice; &#125; public Integer getStock() &#123; return stock; &#125; public void setStock(Integer stock) &#123; this.stock = stock; &#125; public Integer getCid() &#123; return cid; &#125; public void setCid(Integer cid) &#123; this.cid = cid; &#125; public Date getCreateDate() &#123; return createDate; &#125; public void setCreateDate(Date createDate) &#123; this.createDate = createDate; &#125; public ProductImage getFirstProductImage() &#123; return firstProductImage; &#125; public void setFirstProductImage(ProductImage firstProductImage) &#123; this.firstProductImage = firstProductImage; &#125; public List&lt;ProductImage&gt; getProductSingleImages() &#123; return productSingleImages; &#125; public void setProductSingleImages(List&lt;ProductImage&gt; productSingleImages) &#123; this.productSingleImages = productSingleImages; &#125; public List&lt;ProductImage&gt; getProductDetailImages() &#123; return productDetailImages; &#125; public void setProductDetailImages(List&lt;ProductImage&gt; productDetailImages) &#123; this.productDetailImages = productDetailImages; &#125; public int getSaleCount() &#123; return saleCount; &#125; public void setSaleCount(int saleCount) &#123; this.saleCount = saleCount; &#125; public int getReviewCount() &#123; return reviewCount; &#125; public void setReviewCount(int reviewCount) &#123; this.reviewCount = reviewCount; &#125;&#125; 02 Review修改自动生成的评价类Review, 增加User属性 1private User user; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.how2java.tmall.pojo; import java.util.Date; public class Review &#123; private Integer id; private String content; private Integer uid; private Integer pid; private Date createDate; /*非数据库字段*/ private User user; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getContent() &#123; return content; &#125; public void setContent(String content) &#123; this.content = content == null ? null : content.trim(); &#125; public Integer getUid() &#123; return uid; &#125; public void setUid(Integer uid) &#123; this.uid = uid; &#125; public Integer getPid() &#123; return pid; &#125; public void setPid(Integer pid) &#123; this.pid = pid; &#125; public Date getCreateDate() &#123; return createDate; &#125; public void setCreateDate(Date createDate) &#123; this.createDate = createDate; &#125; public User getUser() &#123; return user; &#125; public void setUser(User user) &#123; this.user = user; &#125;&#125; 03 ReviewService增加ReviewService，提供CURD以及通过产品获取评价方法： 12List list(int pid);int getCount(int pid); 1234567891011121314151617package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Review; public interface ReviewService &#123; void add(Review c); void delete(int id); void update(Review c); Review get(int id); List list(int pid); int getCount(int pid);&#125; 04 User修改User, 增加一个getAnonymousName方法用于在显示评价者的时候进行匿名显示 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.how2java.tmall.pojo; public class User &#123; private Integer id; private String name; private String password; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password == null ? null : password.trim(); &#125; public String getAnonymousName()&#123; if(null==name) return null; if(name.length()&lt;=1) return &quot;*&quot;; if(name.length()==2) return name.substring(0,1) +&quot;*&quot;; char[] cs =name.toCharArray(); for (int i = 1; i &lt; cs.length-1; i++) &#123; cs[i]=&#x27;*&#x27;; &#125; return new String(cs); &#125;&#125; 05 ReviewServiceImpl增加ReviewServiceImpl，实现对应方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.how2java.tmall.service.impl; import java.util.List;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import com.how2java.tmall.mapper.ReviewMapper;import com.how2java.tmall.pojo.Review;import com.how2java.tmall.pojo.ReviewExample;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.ReviewService;import com.how2java.tmall.service.UserService; @Servicepublic class ReviewServiceImpl implements ReviewService &#123; @Autowired ReviewMapper reviewMapper; @Autowired UserService userService; @Override public void add(Review c) &#123; reviewMapper.insert(c); &#125; @Override public void delete(int id) &#123; reviewMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Review c) &#123; reviewMapper.updateByPrimaryKeySelective(c); &#125; @Override public Review get(int id) &#123; return reviewMapper.selectByPrimaryKey(id); &#125; public List&lt;Review&gt; list(int pid)&#123; ReviewExample example =new ReviewExample(); example.createCriteria().andPidEqualTo(pid); example.setOrderByClause(&quot;id desc&quot;); List&lt;Review&gt; result =reviewMapper.selectByExample(example); setUser(result); return result; &#125; public void setUser(List&lt;Review&gt; reviews)&#123; for (Review review : reviews) &#123; setUser(review); &#125; &#125; private void setUser(Review review) &#123; int uid = review.getUid(); User user =userService.get(uid); review.setUser(user); &#125; @Override public int getCount(int pid) &#123; return list(pid).size(); &#125;&#125; 06 OrderItemService修改OrderItemService，增加根据产品获取销售量的方法： 1int getSaleCount(int pid); 12345678910111213141516171819202122package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem; public interface OrderItemService &#123; void add(OrderItem c); void delete(int id); void update(OrderItem c); OrderItem get(int id); List list(); void fill(List&lt;Order&gt; os); void fill(Order o); int getSaleCount(int pid);&#125; 07 OrderItemServiceImpl修改OrderItemServiceImpl，实现getSaleCount方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.OrderItemMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.OrderItemExample;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.ProductService; @Servicepublic class OrderItemServiceImpl implements OrderItemService &#123; @Autowired OrderItemMapper orderItemMapper; @Autowired ProductService productService; @Override public void add(OrderItem c) &#123; orderItemMapper.insert(c); &#125; @Override public void delete(int id) &#123; orderItemMapper.deleteByPrimaryKey(id); &#125; @Override public void update(OrderItem c) &#123; orderItemMapper.updateByPrimaryKeySelective(c); &#125; @Override public OrderItem get(int id) &#123; OrderItem result = orderItemMapper.selectByPrimaryKey(id); setProduct(result); return result; &#125; public List&lt;OrderItem&gt; list()&#123; OrderItemExample example =new OrderItemExample(); example.setOrderByClause(&quot;id desc&quot;); return orderItemMapper.selectByExample(example); &#125; @Override public void fill(List&lt;Order&gt; os) &#123; for (Order o : os) &#123; fill(o); &#125; &#125; public void fill(Order o) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andOidEqualTo(o.getId()); example.setOrderByClause(&quot;id desc&quot;); List&lt;OrderItem&gt; ois =orderItemMapper.selectByExample(example); setProduct(ois); float total = 0; int totalNumber = 0; for (OrderItem oi : ois) &#123; total+=oi.getNumber()*oi.getProduct().getPromotePrice(); totalNumber+=oi.getNumber(); &#125; o.setTotal(total); o.setTotalNumber(totalNumber); o.setOrderItems(ois); &#125; public void setProduct(List&lt;OrderItem&gt; ois)&#123; for (OrderItem oi: ois) &#123; setProduct(oi); &#125; &#125; private void setProduct(OrderItem oi) &#123; Product p = productService.get(oi.getPid()); oi.setProduct(p); &#125; @Override public int getSaleCount(int pid) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andPidEqualTo(pid); List&lt;OrderItem&gt; ois =orderItemMapper.selectByExample(example); int result =0; for (OrderItem oi : ois) &#123; result+=oi.getNumber(); &#125; return result; &#125; &#125; 08 ProductService修改ProductService，增加为产品设置销量和评价数量的方法： 12void setSaleAndReviewNumber(Product p);void setSaleAndReviewNumber(List&lt;Product&gt; ps); 123456789101112131415161718192021222324package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product; public interface ProductService &#123; void add(Product p); void delete(int id); void update(Product p); Product get(int id); List list(int cid); void setFirstProductImage(Product p); void fill(List&lt;Category&gt; cs); void fill(Category c); void fillByRow(List&lt;Category&gt; cs); void setSaleAndReviewNumber(Product p); void setSaleAndReviewNumber(List&lt;Product&gt; ps);&#125; 09 ProductServiceImpl修改ProductServiceImpl，实现为产品设置销量和评价数量的方法： 12void setSaleAndReviewNumber(Product p);void setSaleAndReviewNumber 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135package com.how2java.tmall.service.impl; import java.util.ArrayList;import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.ProductMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductExample;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.ProductImageService;import com.how2java.tmall.service.ProductService;import com.how2java.tmall.service.ReviewService;@Servicepublic class ProductServiceImpl implements ProductService &#123; @Autowired ProductMapper productMapper; @Autowired CategoryService categoryService; @Autowired ProductImageService productImageService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @Override public void add(Product p) &#123; productMapper.insert(p); &#125; @Override public void delete(int id) &#123; productMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Product p) &#123; productMapper.updateByPrimaryKeySelective(p); &#125; @Override public Product get(int id) &#123; Product p = productMapper.selectByPrimaryKey(id); setFirstProductImage(p); setCategory(p); return p; &#125; public void setCategory(List&lt;Product&gt; ps)&#123; for (Product p : ps) setCategory(p); &#125; public void setCategory(Product p)&#123; int cid = p.getCid(); Category c = categoryService.get(cid); p.setCategory(c); &#125; @Override public List list(int cid) &#123; ProductExample example = new ProductExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setFirstProductImage(result); setCategory(result); return result; &#125; @Override public void setFirstProductImage(Product p) &#123; List&lt;ProductImage&gt; pis = productImageService.list(p.getId(), ProductImageService.type_single); if (!pis.isEmpty()) &#123; ProductImage pi = pis.get(0); p.setFirstProductImage(pi); &#125; &#125; @Override public void fill(List&lt;Category&gt; cs) &#123; for (Category c : cs) &#123; fill(c); &#125; &#125; @Override public void fillByRow(List&lt;Category&gt; cs) &#123; int productNumberEachRow = 8; for (Category c : cs) &#123; List&lt;Product&gt; products = c.getProducts(); List&lt;List&lt;Product&gt;&gt; productsByRow = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; products.size(); i+=productNumberEachRow) &#123; int size = i+productNumberEachRow; size= size&gt;products.size()?products.size():size; List&lt;Product&gt; productsOfEachRow =products.subList(i, size); productsByRow.add(productsOfEachRow); &#125; c.setProductsByRow(productsByRow); &#125; &#125; @Override public void setSaleAndReviewNumber(Product p) &#123; int saleCount = orderItemService.getSaleCount(p.getId()); p.setSaleCount(saleCount); int reviewCount = reviewService.getCount(p.getId()); p.setReviewCount(reviewCount); &#125; @Override public void setSaleAndReviewNumber(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setSaleAndReviewNumber(p); &#125; &#125; @Override public void fill(Category c) &#123; List&lt;Product&gt; ps = list(c.getId()); c.setProducts(ps); &#125; public void setFirstProductImage(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setFirstProductImage(p); &#125; &#125;&#125; 10 ForeController.product()通过访问地址 http://127.0.0.1:8080/tmall_ssm/foreproduct?pid=844 导致ForeController.product() 方法被调用 获取参数pid 根据pid获取Product 对象p 根据对象p，获取这个产品对应的单个图片集合 根据对象p，获取这个产品对应的详情图片集合 获取产品的所有属性值 获取产品对应的所有的评价 设置产品的销量和评价数量 把上述取值放在request属性上 服务端跳转到 “product.jsp” 页面 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596package com.how2java.tmall.controller; import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; &#125; 11 product.jsp与 register.jsp 相仿，product.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。中间是产品业务页面 productPage.jsp tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\ product.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/simpleSearch.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/product/productPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 12 productPage.jspproductPage.jsp 又由3个页面组成 imgAndInfo.jsp单个图片和基本信息 productReview.jsp评价信息 productDetail.jsp详情图片 tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\product\\productPage.jsp 12345678910111213141516&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;title&gt;模仿天猫官网 $&#123;p.name&#125;&lt;/title&gt;&lt;div class=&quot;categoryPictureInProductPageDiv&quot;&gt; &lt;img class=&quot;categoryPictureInProductPage&quot; src=&quot;img/category/$&#123;p.category.id&#125;.jpg&quot;&gt;&lt;/div&gt; &lt;div class=&quot;productPageDiv&quot;&gt; &lt;%@include file=&quot;imgAndInfo.jsp&quot; %&gt; &lt;%@include file=&quot;productReview.jsp&quot; %&gt; &lt;%@include file=&quot;productDetail.jsp&quot; %&gt;&lt;/div&gt; 13 imgAndInfo.jsp 左侧显示5张单个图片1.1 默认显示第一张图片 1&lt;img src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot; class=&quot;bigImg&quot;&gt; ​ 1.2 5张小图片 123&lt;c:forEach items=&quot;$&#123;p.productSingleImages&#125;&quot; var=&quot;pi&quot;&gt; &lt;img src=&quot;img/productSingle_small/$&#123;pi.id&#125;.jpg&quot; bigImageURL=&quot;img/productSingle/$&#123;pi.id&#125;.jpg&quot; class=&quot;smallImage&quot;&gt;&lt;/c:forEach&gt; 右边显示基本信息2.1 标题和小标题 123456&lt;div class=&quot;productTitle&quot;&gt; $&#123;p.name&#125;&lt;/div&gt;&lt;div class=&quot;productSubTitle&quot;&gt; $&#123;p.subTitle&#125; &lt;/div&gt; 2.2 原始价格和促销价 12&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; 2.3 销量和累计评价 12&lt;div&gt;销量 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.saleCount &#125;&lt;/span&gt;&lt;/div&gt; &lt;div&gt;累计评价 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; 2.4 库存 1&lt;span&gt;库存$&#123;p.stock&#125;件&lt;/span&gt; tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\imgAndInfo.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt; $(function()&#123; var stock = $&#123;p.stock&#125;; $(&quot;.productNumberSetting&quot;).keyup(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); num = parseInt(num); if(isNaN(num)) num= 1; if(num&lt;=0) num = 1; if(num&gt;stock) num = stock; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.increaseNumber&quot;).click(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); num++; if(num&gt;stock) num = stock; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.decreaseNumber&quot;).click(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); --num; if(num&lt;=0) num=1; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.addCartLink&quot;).click(function()&#123; var page = &quot;forecheckLogin&quot;; $.get( page, function(result)&#123; if(&quot;success&quot;==result)&#123; var pid = $&#123;p.id&#125;; var num= $(&quot;.productNumberSetting&quot;).val(); var addCartpage = &quot;foreaddCart&quot;; $.get( addCartpage, &#123;&quot;pid&quot;:pid,&quot;num&quot;:num&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; $(&quot;.addCartButton&quot;).html(&quot;已加入购物车&quot;); $(&quot;.addCartButton&quot;).attr(&quot;disabled&quot;,&quot;disabled&quot;); $(&quot;.addCartButton&quot;).css(&quot;background-color&quot;,&quot;lightgray&quot;) $(&quot;.addCartButton&quot;).css(&quot;border-color&quot;,&quot;lightgray&quot;) $(&quot;.addCartButton&quot;).css(&quot;color&quot;,&quot;black&quot;) &#125; else&#123; &#125; &#125; ); &#125; else&#123; $(&quot;#loginModal&quot;).modal(&#x27;show&#x27;); &#125; &#125; ); return false; &#125;); $(&quot;.buyLink&quot;).click(function()&#123; var page = &quot;forecheckLogin&quot;; $.get( page, function(result)&#123; if(&quot;success&quot;==result)&#123; var num = $(&quot;.productNumberSetting&quot;).val(); location.href= $(&quot;.buyLink&quot;).attr(&quot;href&quot;)+&quot;&amp;num=&quot;+num; &#125; else&#123; $(&quot;#loginModal&quot;).modal(&#x27;show&#x27;); &#125; &#125; ); return false; &#125;); $(&quot;button.loginSubmitButton&quot;).click(function()&#123; var name = $(&quot;#name&quot;).val(); var password = $(&quot;#password&quot;).val(); if(0==name.length||0==password.length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入账号密码&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); return false; &#125; var page = &quot;foreloginAjax&quot;; $.get( page, &#123;&quot;name&quot;:name,&quot;password&quot;:password&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; location.reload(); &#125; else&#123; $(&quot;span.errorMessage&quot;).html(&quot;账号密码错误&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); &#125; &#125; ); return true; &#125;); $(&quot;img.smallImage&quot;).mouseenter(function()&#123; var bigImageURL = $(this).attr(&quot;bigImageURL&quot;); $(&quot;img.bigImg&quot;).attr(&quot;src&quot;,bigImageURL); &#125;); $(&quot;img.bigImg&quot;).load( function()&#123; $(&quot;img.smallImage&quot;).each(function()&#123; var bigImageURL = $(this).attr(&quot;bigImageURL&quot;); img = new Image(); img.src = bigImageURL; img.onload = function()&#123; console.log(bigImageURL); $(&quot;div.img4load&quot;).append($(img)); &#125;; &#125;); &#125; );&#125;); &lt;/script&gt; &lt;div class=&quot;imgAndInfo&quot;&gt; &lt;div class=&quot;imgInimgAndInfo&quot;&gt; &lt;img src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot; class=&quot;bigImg&quot;&gt; &lt;div class=&quot;smallImageDiv&quot;&gt; &lt;c:forEach items=&quot;$&#123;p.productSingleImages&#125;&quot; var=&quot;pi&quot;&gt; &lt;img src=&quot;img/productSingle_small/$&#123;pi.id&#125;.jpg&quot; bigImageURL=&quot;img/productSingle/$&#123;pi.id&#125;.jpg&quot; class=&quot;smallImage&quot;&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;div class=&quot;img4load hidden&quot; &gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;infoInimgAndInfo&quot;&gt; &lt;div class=&quot;productTitle&quot;&gt; $&#123;p.name&#125; &lt;/div&gt; &lt;div class=&quot;productSubTitle&quot;&gt; $&#123;p.subTitle&#125; &lt;/div&gt; &lt;div class=&quot;productPrice&quot;&gt; &lt;div class=&quot;juhuasuan&quot;&gt; &lt;span class=&quot;juhuasuanBig&quot; &gt;聚划算&lt;/span&gt; &lt;span&gt;此商品即将参加聚划算，&lt;span class=&quot;juhuasuanTime&quot;&gt;1天19小时&lt;/span&gt;后开始，&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;productPriceDiv&quot;&gt; &lt;div class=&quot;gouwujuanDiv&quot;&gt;&lt;img height=&quot;16px&quot; src=&quot;img/site/gouwujuan.png&quot;&gt; &lt;span&gt; 全天猫实物商品通用&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;originalDiv&quot;&gt; &lt;span class=&quot;originalPriceDesc&quot;&gt;价格&lt;/span&gt; &lt;span class=&quot;originalPriceYuan&quot;&gt;¥&lt;/span&gt; &lt;span class=&quot;originalPrice&quot;&gt; &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;promotionDiv&quot;&gt; &lt;span class=&quot;promotionPriceDesc&quot;&gt;促销价 &lt;/span&gt; &lt;span class=&quot;promotionPriceYuan&quot;&gt;¥&lt;/span&gt; &lt;span class=&quot;promotionPrice&quot;&gt; &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productSaleAndReviewNumber&quot;&gt; &lt;div&gt;销量 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.saleCount &#125;&lt;/span&gt;&lt;/div&gt; &lt;div&gt;累计评价 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productNumber&quot;&gt; &lt;span&gt;数量&lt;/span&gt; &lt;span&gt; &lt;span class=&quot;productNumberSettingSpan&quot;&gt; &lt;input class=&quot;productNumberSetting&quot; type=&quot;text&quot; value=&quot;1&quot;&gt; &lt;/span&gt; &lt;span class=&quot;arrow&quot;&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;increaseNumber&quot;&gt; &lt;span class=&quot;updown&quot;&gt; &lt;img src=&quot;img/site/increase.png&quot;&gt; &lt;/span&gt; &lt;/a&gt; &lt;span class=&quot;updownMiddle&quot;&gt; &lt;/span&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;decreaseNumber&quot;&gt; &lt;span class=&quot;updown&quot;&gt; &lt;img src=&quot;img/site/decrease.png&quot;&gt; &lt;/span&gt; &lt;/a&gt; &lt;/span&gt; 件&lt;/span&gt; &lt;span&gt;库存$&#123;p.stock&#125;件&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;serviceCommitment&quot;&gt; &lt;span class=&quot;serviceCommitmentDesc&quot;&gt;服务承诺&lt;/span&gt; &lt;span class=&quot;serviceCommitmentLink&quot;&gt; &lt;a href=&quot;#nowhere&quot;&gt;正品保证&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;极速退款&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;赠运费险&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;七天无理由退换&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;buyDiv&quot;&gt; &lt;a class=&quot;buyLink&quot; href=&quot;forebuyone?pid=$&#123;p.id&#125;&quot;&gt;&lt;button class=&quot;buyButton&quot;&gt;立即购买&lt;/button&gt;&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;addCartLink&quot;&gt;&lt;button class=&quot;addCartButton&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;加入购物车&lt;/button&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; 14 productReview.jsp借助c:forEach遍历request中的reviews 12345678910111213141516171819202122232425262728293031&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;productReviewDiv&quot; &gt; &lt;div class=&quot;productReviewTopPart&quot;&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;productReviewTopPartSelectedLink&quot;&gt;商品详情&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;selected&quot;&gt;累计评价 &lt;span class=&quot;productReviewTopReviewLinkNumber&quot;&gt;$&#123;p.reviewCount&#125;&lt;/span&gt; &lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;productReviewContentPart&quot;&gt; &lt;c:forEach items=&quot;$&#123;reviews&#125;&quot; var=&quot;r&quot;&gt; &lt;div class=&quot;productReviewItem&quot;&gt; &lt;div class=&quot;productReviewItemDesc&quot;&gt; &lt;div class=&quot;productReviewItemContent&quot;&gt; $&#123;r.content &#125; &lt;/div&gt; &lt;div class=&quot;productReviewItemDate&quot;&gt;&lt;fmt:formatDate value=&quot;$&#123;r.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd&quot;/&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productReviewItemUserInfo&quot;&gt; $&#123;r.user.anonymousName&#125;&lt;span class=&quot;userInfoGrayPart&quot;&gt;（匿名）&lt;/span&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; 15 productDetail.jsp如图所示，productDetail.jsp做了两件事 显示属性值 123&lt;c:forEach items=&quot;$&#123;pvs&#125;&quot; var=&quot;pv&quot;&gt; &lt;span&gt;$&#123;pv.property.name&#125;: $&#123;fn:substring(pv.value, 0, 10)&#125; &lt;/span&gt;&lt;/c:forEach&gt; 显示详情图片 123&lt;c:forEach items=&quot;$&#123;p.productDetailImages&#125;&quot; var=&quot;pi&quot;&gt; &lt;img src=&quot;img/productDetail/$&#123;pi.id&#125;.jpg&quot;&gt;&lt;/c:forEach&gt; 1234567891011121314151617181920212223242526&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;productDetailDiv&quot; &gt; &lt;div class=&quot;productDetailTopPart&quot;&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;productDetailTopPartSelectedLink selected&quot;&gt;商品详情&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;productDetailTopReviewLink&quot;&gt;累计评价 &lt;span class=&quot;productDetailTopReviewLinkNumber&quot;&gt;$&#123;p.reviewCount&#125;&lt;/span&gt; &lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;productParamterPart&quot;&gt; &lt;div class=&quot;productParamter&quot;&gt;产品参数：&lt;/div&gt; &lt;div class=&quot;productParamterList&quot;&gt; &lt;c:forEach items=&quot;$&#123;pvs&#125;&quot; var=&quot;pv&quot;&gt; &lt;span&gt;$&#123;pv.property.name&#125;: $&#123;fn:substring(pv.value, 0, 10)&#125; &lt;/span&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productDetailImagesPart&quot;&gt; &lt;c:forEach items=&quot;$&#123;p.productDetailImages&#125;&quot; var=&quot;pi&quot;&gt; &lt;img src=&quot;img/productDetail/$&#123;pi.id&#125;.jpg&quot;&gt; &lt;/c:forEach&gt; &lt;/div&gt;&lt;/div&gt; 7.2.5 模拟登录01 imgAndInfo.jsp立即购买和加入购物车这两个按钮的监听是放在imgAndInfo.jsp页面中 这两个按钮都会通过JQuery的.get方法，用异步ajax的方式访问forecheckLogin，获取当前是否登录状态如果返回的不是”success” 即表明是未登录状态，那么就会打开登录的模态窗口 1$(&quot;#loginModal&quot;).modal(&#x27;show&#x27;); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt; $(function()&#123; var stock = $&#123;p.stock&#125;; $(&quot;.productNumberSetting&quot;).keyup(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); num = parseInt(num); if(isNaN(num)) num= 1; if(num&lt;=0) num = 1; if(num&gt;stock) num = stock; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.increaseNumber&quot;).click(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); num++; if(num&gt;stock) num = stock; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.decreaseNumber&quot;).click(function()&#123; var num= $(&quot;.productNumberSetting&quot;).val(); --num; if(num&lt;=0) num=1; $(&quot;.productNumberSetting&quot;).val(num); &#125;); $(&quot;.addCartLink&quot;).click(function()&#123; var page = &quot;forecheckLogin&quot;; $.get( page, function(result)&#123; if(&quot;success&quot;==result)&#123; var pid = $&#123;p.id&#125;; var num= $(&quot;.productNumberSetting&quot;).val(); var addCartpage = &quot;foreaddCart&quot;; $.get( addCartpage, &#123;&quot;pid&quot;:pid,&quot;num&quot;:num&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; $(&quot;.addCartButton&quot;).html(&quot;已加入购物车&quot;); $(&quot;.addCartButton&quot;).attr(&quot;disabled&quot;,&quot;disabled&quot;); $(&quot;.addCartButton&quot;).css(&quot;background-color&quot;,&quot;lightgray&quot;) $(&quot;.addCartButton&quot;).css(&quot;border-color&quot;,&quot;lightgray&quot;) $(&quot;.addCartButton&quot;).css(&quot;color&quot;,&quot;black&quot;) &#125; else&#123; &#125; &#125; ); &#125; else&#123; $(&quot;#loginModal&quot;).modal(&#x27;show&#x27;); &#125; &#125; ); return false; &#125;); $(&quot;.buyLink&quot;).click(function()&#123; var page = &quot;forecheckLogin&quot;; $.get( page, function(result)&#123; if(&quot;success&quot;==result)&#123; var num = $(&quot;.productNumberSetting&quot;).val(); location.href= $(&quot;.buyLink&quot;).attr(&quot;href&quot;)+&quot;&amp;num=&quot;+num; &#125; else&#123; $(&quot;#loginModal&quot;).modal(&#x27;show&#x27;); &#125; &#125; ); return false; &#125;); $(&quot;button.loginSubmitButton&quot;).click(function()&#123; var name = $(&quot;#name&quot;).val(); var password = $(&quot;#password&quot;).val(); if(0==name.length||0==password.length)&#123; $(&quot;span.errorMessage&quot;).html(&quot;请输入账号密码&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); return false; &#125; var page = &quot;foreloginAjax&quot;; $.get( page, &#123;&quot;name&quot;:name,&quot;password&quot;:password&#125;, function(result)&#123; if(&quot;success&quot;==result)&#123; location.reload(); &#125; else&#123; $(&quot;span.errorMessage&quot;).html(&quot;账号密码错误&quot;); $(&quot;div.loginErrorMessageDiv&quot;).show(); &#125; &#125; ); return true; &#125;); $(&quot;img.smallImage&quot;).mouseenter(function()&#123; var bigImageURL = $(this).attr(&quot;bigImageURL&quot;); $(&quot;img.bigImg&quot;).attr(&quot;src&quot;,bigImageURL); &#125;); $(&quot;img.bigImg&quot;).load( function()&#123; $(&quot;img.smallImage&quot;).each(function()&#123; var bigImageURL = $(this).attr(&quot;bigImageURL&quot;); img = new Image(); img.src = bigImageURL; img.onload = function()&#123; console.log(bigImageURL); $(&quot;div.img4load&quot;).append($(img)); &#125;; &#125;); &#125; );&#125;); &lt;/script&gt; &lt;div class=&quot;imgAndInfo&quot;&gt; &lt;div class=&quot;imgInimgAndInfo&quot;&gt; &lt;img src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot; class=&quot;bigImg&quot;&gt; &lt;div class=&quot;smallImageDiv&quot;&gt; &lt;c:forEach items=&quot;$&#123;p.productSingleImages&#125;&quot; var=&quot;pi&quot;&gt; &lt;img src=&quot;img/productSingle_small/$&#123;pi.id&#125;.jpg&quot; bigImageURL=&quot;img/productSingle/$&#123;pi.id&#125;.jpg&quot; class=&quot;smallImage&quot;&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;div class=&quot;img4load hidden&quot; &gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;infoInimgAndInfo&quot;&gt; &lt;div class=&quot;productTitle&quot;&gt; $&#123;p.name&#125; &lt;/div&gt; &lt;div class=&quot;productSubTitle&quot;&gt; $&#123;p.subTitle&#125; &lt;/div&gt; &lt;div class=&quot;productPrice&quot;&gt; &lt;div class=&quot;juhuasuan&quot;&gt; &lt;span class=&quot;juhuasuanBig&quot; &gt;聚划算&lt;/span&gt; &lt;span&gt;此商品即将参加聚划算，&lt;span class=&quot;juhuasuanTime&quot;&gt;1天19小时&lt;/span&gt;后开始，&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;productPriceDiv&quot;&gt; &lt;div class=&quot;gouwujuanDiv&quot;&gt;&lt;img height=&quot;16px&quot; src=&quot;img/site/gouwujuan.png&quot;&gt; &lt;span&gt; 全天猫实物商品通用&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;originalDiv&quot;&gt; &lt;span class=&quot;originalPriceDesc&quot;&gt;价格&lt;/span&gt; &lt;span class=&quot;originalPriceYuan&quot;&gt;¥&lt;/span&gt; &lt;span class=&quot;originalPrice&quot;&gt; &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.originalPrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;promotionDiv&quot;&gt; &lt;span class=&quot;promotionPriceDesc&quot;&gt;促销价 &lt;/span&gt; &lt;span class=&quot;promotionPriceYuan&quot;&gt;¥&lt;/span&gt; &lt;span class=&quot;promotionPrice&quot;&gt; &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productSaleAndReviewNumber&quot;&gt; &lt;div&gt;销量 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.saleCount &#125;&lt;/span&gt;&lt;/div&gt; &lt;div&gt;累计评价 &lt;span class=&quot;redColor boldWord&quot;&gt; $&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;productNumber&quot;&gt; &lt;span&gt;数量&lt;/span&gt; &lt;span&gt; &lt;span class=&quot;productNumberSettingSpan&quot;&gt; &lt;input class=&quot;productNumberSetting&quot; type=&quot;text&quot; value=&quot;1&quot;&gt; &lt;/span&gt; &lt;span class=&quot;arrow&quot;&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;increaseNumber&quot;&gt; &lt;span class=&quot;updown&quot;&gt; &lt;img src=&quot;img/site/increase.png&quot;&gt; &lt;/span&gt; &lt;/a&gt; &lt;span class=&quot;updownMiddle&quot;&gt; &lt;/span&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;decreaseNumber&quot;&gt; &lt;span class=&quot;updown&quot;&gt; &lt;img src=&quot;img/site/decrease.png&quot;&gt; &lt;/span&gt; &lt;/a&gt; &lt;/span&gt; 件&lt;/span&gt; &lt;span&gt;库存$&#123;p.stock&#125;件&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;serviceCommitment&quot;&gt; &lt;span class=&quot;serviceCommitmentDesc&quot;&gt;服务承诺&lt;/span&gt; &lt;span class=&quot;serviceCommitmentLink&quot;&gt; &lt;a href=&quot;#nowhere&quot;&gt;正品保证&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;极速退款&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;赠运费险&lt;/a&gt; &lt;a href=&quot;#nowhere&quot;&gt;七天无理由退换&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;buyDiv&quot;&gt; &lt;a class=&quot;buyLink&quot; href=&quot;forebuyone?pid=$&#123;p.id&#125;&quot;&gt;&lt;button class=&quot;buyButton&quot;&gt;立即购买&lt;/button&gt;&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; class=&quot;addCartLink&quot;&gt;&lt;button class=&quot;addCartButton&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;加入购物车&lt;/button&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; 02 ForeController.checkLogin()在上一步的ajax访问路径/forecheckLogin会导致ForeController.checkLogin()方法被调用。获取session中的”user”对象如果不为空，即表示已经登录，返回字符串”success”如果为空，即表示未登录，返回字符串”fail” 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107package com.how2java.tmall.controller; import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; &#125; 03 modal.jspmodal.jsp 页面被 footer.jsp 所包含，所以每个页面都是加载了的。通过imgAndInfo.jsp页面中的购买按钮或者加入购物车按钮显示出来。点击登录按钮时，使用imgAndInfo.jsp 页面中的ajax代码进行登录验证： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;modal &quot; id=&quot;loginModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt; &lt;div class=&quot;modal-dialog loginDivInProductPageModalDiv&quot;&gt; &lt;div class=&quot;modal-content&quot;&gt; &lt;div class=&quot;loginDivInProductPage&quot;&gt; &lt;div class=&quot;loginErrorMessageDiv&quot;&gt; &lt;div class=&quot;alert alert-danger&quot; &gt; &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt; &lt;span class=&quot;errorMessage&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;login_acount_text&quot;&gt;账户登录&lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-user&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;手机/会员名/邮箱&quot; type=&quot;text&quot;&gt; &lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-lock&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;密码&quot; type=&quot;text&quot;&gt; &lt;/div&gt; &lt;span class=&quot;text-danger&quot;&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt; &lt;div&gt; &lt;a href=&quot;#nowhere&quot;&gt;忘记登录密码&lt;/a&gt; &lt;a href=&quot;register.jsp&quot; class=&quot;pull-right&quot;&gt;免费注册&lt;/a&gt; &lt;/div&gt; &lt;div style=&quot;margin-top:20px&quot;&gt; &lt;button class=&quot;btn btn-block redButton loginSubmitButton&quot; type=&quot;submit&quot;&gt;登录&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; &lt;div class=&quot;modal&quot; id=&quot;deleteConfirmModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt; &lt;div class=&quot;modal-dialog deleteConfirmModalDiv&quot;&gt; &lt;div class=&quot;modal-content&quot;&gt; &lt;div class=&quot;modal-header&quot;&gt; &lt;button data-dismiss=&quot;modal&quot; class=&quot;close&quot; type=&quot;button&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Close&lt;/span&gt;&lt;/button&gt; &lt;h4 class=&quot;modal-title&quot;&gt;确认删除？&lt;/h4&gt; &lt;/div&gt; &lt;div class=&quot;modal-footer&quot;&gt; &lt;button data-dismiss=&quot;modal&quot; class=&quot;btn btn-default&quot; type=&quot;button&quot;&gt;关闭&lt;/button&gt; &lt;button class=&quot;btn btn-primary deleteConfirmButton&quot; id=&quot;submit&quot; type=&quot;button&quot;&gt;确认&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 04 ForeController.loginAjax()在上一步modal.jsp中，点击了登录按钮之后，访问路径/foreloginAjax,导致ForeController.loginAjax()方法被调用 获取账号密码 通过账号密码获取User对象2.1 如果User对象为空，那么就返回”fail”字符串。2.2 如果User对象不为空，那么就把User对象放在session中，并返回”success” 字符串 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119package com.how2java.tmall.controller; import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; &#125; 7.2.6 分类页01 5个Comparator比较器分类这个页面有排序功能，所以在讲解ForeController之前，先准备5个Comparator比较器 tmall_ssm\\src\\main\\java\\comparator ProductAllComparator 综合比较器把 销量x评价 高的放前面 1234567891011121314package comparator; import java.util.Comparator; import com.how2java.tmall.pojo.Product; public class ProductAllComparator implements Comparator&lt;Product&gt;&#123; @Override public int compare(Product p1, Product p2) &#123; return p2.getReviewCount()*p2.getSaleCount()-p1.getReviewCount()*p1.getSaleCount(); &#125; &#125; ProductReviewComparator 人气比较器 把 评价数量多的放前面 1234567891011121314package comparator; import java.util.Comparator; import com.how2java.tmall.pojo.Product; public class ProductDateComparator implements Comparator&lt;Product&gt;&#123; @Override public int compare(Product p1, Product p2) &#123; return p2.getCreateDate().compareTo(p1.getCreateDate()); &#125; &#125; ProductDateComparator 新品比较器把 创建日期晚的放前面 1234567891011121314package comparator; import java.util.Comparator; import com.how2java.tmall.pojo.Product; public class ProductPriceComparator implements Comparator&lt;Product&gt;&#123; @Override public int compare(Product p1, Product p2) &#123; return (int) (p1.getPromotePrice()-p2.getPromotePrice()); &#125; &#125; ProductSaleCountComparator 销量比较器把 销量高的放前面 1234567891011121314package comparator; import java.util.Comparator; import com.how2java.tmall.pojo.Product; public class ProductReviewComparator implements Comparator&lt;Product&gt;&#123; @Override public int compare(Product p1, Product p2) &#123; return p2.getReviewCount()-p1.getReviewCount(); &#125; &#125; ProductPriceComparator 价格比较器把 价格低的放前面 1234567891011121314package comparator; import java.util.Comparator; import com.how2java.tmall.pojo.Product; public class ProductSaleCountComparator implements Comparator&lt;Product&gt;&#123; @Override public int compare(Product p1, Product p2) &#123; return p2.getSaleCount()-p1.getSaleCount(); &#125; &#125; 02 ForeController.category() 获取参数cid 根据cid获取分类Category对象 c 为c填充产品 为产品填充销量和评价数据 获取参数sort5.1 如果sort==null，即不排序5.2 如果sort!=null，则根据sort的值，从5个Comparator比较器中选择一个对应的排序器进行排序 把c放在model中 服务端跳转到 category.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152package com.how2java.tmall.controller; import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125;&#125; 03 category.jsp与 register.jsp 相仿，category.jsp也包含了header.jsp, top.jsp, simpleSearch.jsp， footer.jsp 等公共页面。 中间是分类业务页面 categoryPage.jsp tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\ category.jsp 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/search.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/category/categoryPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 04 categoryPage.jspcategoryPage.jsp 里有3个内容 显示当前分类图片 1&lt;img src=&quot;img/category/$&#123;c.id&#125;.jpg&quot;&gt; 排序条 sortBar.jsp 产品列表 productsByCategory.jsp tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\category\\categoryPage.jsp 12345678910&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;&lt;title&gt;模仿天猫官网-$&#123;c.name&#125;&lt;/title&gt;&lt;div id=&quot;category&quot;&gt; &lt;div class=&quot;categoryPageDiv&quot;&gt; &lt;img src=&quot;img/category/$&#123;c.id&#125;.jpg&quot;&gt; &lt;%@include file=&quot;sortBar.jsp&quot;%&gt; &lt;%@include file=&quot;productsByCategory.jsp&quot;%&gt; &lt;/div&gt;&lt;/div&gt; 05 sortBar.jspsortBar.jsp 即排序条，做了如下几个与数据相关的事情 根据sort参数判断哪个排序按钮高亮 每个排序按钮提交到本页面，即/forecategory，并带上参数sort 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt; &lt;script&gt;$(function()&#123; $(&quot;input.sortBarPrice&quot;).keyup(function()&#123; var num= $(this).val(); if(num.length==0)&#123; $(&quot;div.productUnit&quot;).show(); return; &#125; num = parseInt(num); if(isNaN(num)) num= 1; if(num&lt;=0) num = 1; $(this).val(num); var begin = $(&quot;input.beginPrice&quot;).val(); var end = $(&quot;input.endPrice&quot;).val(); if(!isNaN(begin) &amp;&amp; !isNaN(end))&#123; console.log(begin); console.log(end); $(&quot;div.productUnit&quot;).hide(); $(&quot;div.productUnit&quot;).each(function()&#123; var price = $(this).attr(&quot;price&quot;); price = new Number(price); if(price&lt;=end &amp;&amp; price&gt;=begin) $(this).show(); &#125;); &#125; &#125;);&#125;);&lt;/script&gt;&lt;div class=&quot;categorySortBar&quot;&gt; &lt;table class=&quot;categorySortBarTable categorySortTable&quot;&gt; &lt;tr&gt; &lt;td &lt;c:if test=&quot;$&#123;&#x27;all&#x27;==param.sort||empty param.sort&#125;&quot;&gt;class=&quot;grayColumn&quot;&lt;/c:if&gt; &gt;&lt;a href=&quot;?cid=$&#123;c.id&#125;&amp;sort=all&quot;&gt;综合&lt;span class=&quot;glyphicon glyphicon-arrow-down&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td &lt;c:if test=&quot;$&#123;&#x27;review&#x27;==param.sort&#125;&quot;&gt;class=&quot;grayColumn&quot;&lt;/c:if&gt; &gt;&lt;a href=&quot;?cid=$&#123;c.id&#125;&amp;sort=review&quot;&gt;人气&lt;span class=&quot;glyphicon glyphicon-arrow-down&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td &lt;c:if test=&quot;$&#123;&#x27;date&#x27;==param.sort&#125;&quot;&gt;class=&quot;grayColumn&quot;&lt;/c:if&gt;&gt;&lt;a href=&quot;?cid=$&#123;c.id&#125;&amp;sort=date&quot;&gt;新品&lt;span class=&quot;glyphicon glyphicon-arrow-down&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td &lt;c:if test=&quot;$&#123;&#x27;saleCount&#x27;==param.sort&#125;&quot;&gt;class=&quot;grayColumn&quot;&lt;/c:if&gt;&gt;&lt;a href=&quot;?cid=$&#123;c.id&#125;&amp;sort=saleCount&quot;&gt;销量&lt;span class=&quot;glyphicon glyphicon-arrow-down&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td &lt;c:if test=&quot;$&#123;&#x27;price&#x27;==param.sort&#125;&quot;&gt;class=&quot;grayColumn&quot;&lt;/c:if&gt;&gt;&lt;a href=&quot;?cid=$&#123;c.id&#125;&amp;sort=price&quot;&gt;价格&lt;span class=&quot;glyphicon glyphicon-resize-vertical&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;table class=&quot;categorySortBarTable&quot;&gt; &lt;tr&gt; &lt;td&gt;&lt;input class=&quot;sortBarPrice beginPrice&quot; type=&quot;text&quot; placeholder=&quot;请输入&quot;&gt;&lt;/td&gt; &lt;td class=&quot;grayColumn priceMiddleColumn&quot;&gt;-&lt;/td&gt; &lt;td&gt;&lt;input class=&quot;sortBarPrice endPrice&quot; type=&quot;text&quot; placeholder=&quot;请输入&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; 06 productsByCategory.jspproductsByCategory.jsp显示当前分类下的所有产品 通过forEach遍历c.products集合里的每个产品，并把产品标题，价格，图片，评价数，成交数打印出来 解释下：categorycount，这个是用于测试的，在访问地址的时候加这个参数 http://127.0.0.1:8080/tmall_ssm/forecategory?cid=74&amp;categorycount=2 这样就只显示2个产品，仅供测试使用 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;c:if test=&quot;$&#123;empty param.categorycount&#125;&quot;&gt; &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;100&quot;/&gt;&lt;/c:if&gt; &lt;c:if test=&quot;$&#123;!empty param.categorycount&#125;&quot;&gt; &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;$&#123;param.categorycount&#125;&quot;/&gt;&lt;/c:if&gt; &lt;div class=&quot;categoryProducts&quot;&gt; &lt;c:forEach items=&quot;$&#123;c.products&#125;&quot; var=&quot;p&quot; varStatus=&quot;stc&quot;&gt; &lt;c:if test=&quot;$&#123;stc.count&lt;=categorycount&#125;&quot;&gt; &lt;div class=&quot;productUnit&quot; price=&quot;$&#123;p.promotePrice&#125;&quot;&gt; &lt;div class=&quot;productUnitFrame&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; &lt;img class=&quot;productImage&quot; src=&quot;img/productSingle_middle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt; &lt;/a&gt; &lt;span class=&quot;productPrice&quot;&gt;¥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;a class=&quot;productLink&quot; href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; $&#123;fn:substring(p.name, 0, 50)&#125; &lt;/a&gt; &lt;a class=&quot;tmallLink&quot; href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt;天猫专卖&lt;/a&gt; &lt;div class=&quot;show1 productInfo&quot;&gt; &lt;span class=&quot;monthDeal &quot;&gt;月成交 &lt;span class=&quot;productDealNumber&quot;&gt;$&#123;p.saleCount&#125;笔&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;productReview&quot;&gt;评价&lt;span class=&quot;productReviewNumber&quot;&gt;$&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;wangwang&quot;&gt; &lt;a class=&quot;wangwanglink&quot; href=&quot;#nowhere&quot;&gt; &lt;img src=&quot;img/site/wangwang.png&quot;&gt; &lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&lt;/div&gt; 7.2.7 搜索01 search.jsp以及simpleSearch.jsp每个页面都包含了搜索的jsp，首页和搜索结果页包含的是search.jsp，其他页面包含的是simpleSearch.jsp。 这两个页面都提供了一个form，提交数据keyword到foresearch这个路径 123456789101112131415161718192021222324252627&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;img id=&quot;logo&quot; src=&quot;img/site/logo.gif&quot; class=&quot;logo&quot;&gt; &lt;/a&gt; &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt; &lt;div class=&quot;searchDiv&quot;&gt; &lt;input name=&quot;keyword&quot; type=&quot;text&quot; value=&quot;$&#123;param.keyword&#125;&quot; placeholder=&quot;时尚男鞋 太阳镜 &quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;searchButton&quot;&gt;搜索&lt;/button&gt; &lt;div class=&quot;searchBelow&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&gt;=5 and st.count&lt;=8&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;c:if test=&quot;$&#123;st.count!=8&#125;&quot;&gt; &lt;span&gt;|&lt;/span&gt; &lt;/c:if&gt; &lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; 123456789101112131415161718192021222324252627282930&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div &gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;img id=&quot;simpleLogo&quot; class=&quot;simpleLogo&quot; src=&quot;img/site/simpleLogo.png&quot;&gt; &lt;/a&gt; &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt; &lt;div class=&quot;simpleSearchDiv pull-right&quot;&gt; &lt;input type=&quot;text&quot; placeholder=&quot;平衡车 原汁机&quot; value=&quot;$&#123;param.keyword&#125;&quot; name=&quot;keyword&quot;&gt; &lt;button class=&quot;searchButton&quot; type=&quot;submit&quot;&gt;搜天猫&lt;/button&gt; &lt;div class=&quot;searchBelow&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&gt;=8 and st.count&lt;=11&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;c:if test=&quot;$&#123;st.count!=11&#125;&quot;&gt; &lt;span&gt;|&lt;/span&gt; &lt;/c:if&gt; &lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&lt;/div&gt; 02 ForeController.search()通过search.jsp或者simpleSearch.jsp提交数据到路径 /foresearch， 导致ForeController.search()方法被调用 获取参数keyword 根据keyword进行模糊查询，获取满足条件的前20个产品 为这些产品设置销量和评价数量 把产品结合设置在model的”ps”属性上 服务端跳转到 searchResult.jsp 页面 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.how2java.tmall.pojo.*;import com.how2java.tmall.service.*;import comparator.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.util.HtmlUtils; import javax.servlet.http.HttpSession;import java.util.Collections;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; @RequestMapping(&quot;foreregister&quot;) public String register(Model model,User user) &#123; String name = user.getName(); name = HtmlUtils.htmlEscape(name); user.setName(name); boolean exist = userService.isExist(name); if(exist)&#123; String m =&quot;用户名已经被使用,不能使用&quot;; model.addAttribute(&quot;msg&quot;, m); return &quot;fore/register&quot;; &#125; userService.add(user); return &quot;redirect:registerSuccessPage&quot;; &#125; @RequestMapping(&quot;forelogin&quot;) public String login(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password, Model model, HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; model.addAttribute(&quot;msg&quot;, &quot;账号密码错误&quot;); return &quot;fore/login&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;forelogout&quot;) public String logout( HttpSession session) &#123; session.removeAttribute(&quot;user&quot;); return &quot;redirect:forehome&quot;; &#125; @RequestMapping(&quot;foreproduct&quot;) public String product( int pid, Model model) &#123; Product p = productService.get(pid); List&lt;ProductImage&gt; productSingleImages = productImageService.list(p.getId(), ProductImageService.type_single); List&lt;ProductImage&gt; productDetailImages = productImageService.list(p.getId(), ProductImageService.type_detail); p.setProductSingleImages(productSingleImages); p.setProductDetailImages(productDetailImages); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); List&lt;Review&gt; reviews = reviewService.list(p.getId()); productService.setSaleAndReviewNumber(p); model.addAttribute(&quot;reviews&quot;, reviews); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;fore/product&quot;; &#125; @RequestMapping(&quot;forecheckLogin&quot;) @ResponseBody public String checkLogin( HttpSession session) &#123; User user =(User) session.getAttribute(&quot;user&quot;); if(null!=user) return &quot;success&quot;; return &quot;fail&quot;; &#125; @RequestMapping(&quot;foreloginAjax&quot;) @ResponseBody public String loginAjax(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;password&quot;) String password,HttpSession session) &#123; name = HtmlUtils.htmlEscape(name); User user = userService.get(name,password); if(null==user)&#123; return &quot;fail&quot;; &#125; session.setAttribute(&quot;user&quot;, user); return &quot;success&quot;; &#125; @RequestMapping(&quot;forecategory&quot;) public String category(int cid,String sort, Model model) &#123; Category c = categoryService.get(cid); productService.fill(c); productService.setSaleAndReviewNumber(c.getProducts()); if(null!=sort)&#123; switch(sort)&#123; case &quot;review&quot;: Collections.sort(c.getProducts(),new ProductReviewComparator()); break; case &quot;date&quot; : Collections.sort(c.getProducts(),new ProductDateComparator()); break; case &quot;saleCount&quot; : Collections.sort(c.getProducts(),new ProductSaleCountComparator()); break; case &quot;price&quot;: Collections.sort(c.getProducts(),new ProductPriceComparator()); break; case &quot;all&quot;: Collections.sort(c.getProducts(),new ProductAllComparator()); break; &#125; &#125; model.addAttribute(&quot;c&quot;, c); return &quot;fore/category&quot;; &#125; @RequestMapping(&quot;foresearch&quot;) public String search( String keyword,Model model)&#123; PageHelper.offsetPage(0,20); List&lt;Product&gt; ps= productService.search(keyword); productService.setSaleAndReviewNumber(ps); model.addAttribute(&quot;ps&quot;,ps); return &quot;fore/searchResult&quot;; &#125;&#125; 03 ProductService修改ProductService，增加search方法 123456789101112131415161718192021222324252627package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product; public interface ProductService &#123; void add(Product p); void delete(int id); void update(Product p); Product get(int id); List list(int cid); void setFirstProductImage(Product p); void fill(List&lt;Category&gt; cs); void fill(Category c); void fillByRow(List&lt;Category&gt; cs); void setSaleAndReviewNumber(Product p); void setSaleAndReviewNumber(List&lt;Product&gt; ps); List&lt;Product&gt; search(String keyword);&#125; 04 ProductServiceImpl修改ProductServiceImpl实现search方法，通过关键字进行模糊查询 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146package com.how2java.tmall.service.impl; import java.util.ArrayList;import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.ProductMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductExample;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.ProductImageService;import com.how2java.tmall.service.ProductService;import com.how2java.tmall.service.ReviewService;@Servicepublic class ProductServiceImpl implements ProductService &#123; @Autowired ProductMapper productMapper; @Autowired CategoryService categoryService; @Autowired ProductImageService productImageService; @Autowired OrderItemService orderItemService; @Autowired ReviewService reviewService; @Override public void add(Product p) &#123; productMapper.insert(p); &#125; @Override public void delete(int id) &#123; productMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Product p) &#123; productMapper.updateByPrimaryKeySelective(p); &#125; @Override public Product get(int id) &#123; Product p = productMapper.selectByPrimaryKey(id); setFirstProductImage(p); setCategory(p); return p; &#125; public void setCategory(List&lt;Product&gt; ps)&#123; for (Product p : ps) setCategory(p); &#125; public void setCategory(Product p)&#123; int cid = p.getCid(); Category c = categoryService.get(cid); p.setCategory(c); &#125; @Override public List list(int cid) &#123; ProductExample example = new ProductExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setFirstProductImage(result); setCategory(result); return result; &#125; @Override public void setFirstProductImage(Product p) &#123; List&lt;ProductImage&gt; pis = productImageService.list(p.getId(), ProductImageService.type_single); if (!pis.isEmpty()) &#123; ProductImage pi = pis.get(0); p.setFirstProductImage(pi); &#125; &#125; @Override public void fill(List&lt;Category&gt; cs) &#123; for (Category c : cs) &#123; fill(c); &#125; &#125; @Override public void fillByRow(List&lt;Category&gt; cs) &#123; int productNumberEachRow = 8; for (Category c : cs) &#123; List&lt;Product&gt; products = c.getProducts(); List&lt;List&lt;Product&gt;&gt; productsByRow = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; products.size(); i+=productNumberEachRow) &#123; int size = i+productNumberEachRow; size= size&gt;products.size()?products.size():size; List&lt;Product&gt; productsOfEachRow =products.subList(i, size); productsByRow.add(productsOfEachRow); &#125; c.setProductsByRow(productsByRow); &#125; &#125; @Override public void setSaleAndReviewNumber(Product p) &#123; int saleCount = orderItemService.getSaleCount(p.getId()); p.setSaleCount(saleCount); int reviewCount = reviewService.getCount(p.getId()); p.setReviewCount(reviewCount); &#125; @Override public void setSaleAndReviewNumber(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setSaleAndReviewNumber(p); &#125; &#125; @Override public List&lt;Product&gt; search(String keyword) &#123; ProductExample example = new ProductExample(); example.createCriteria().andNameLike(&quot;%&quot; + keyword + &quot;%&quot;); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setFirstProductImage(result); setCategory(result); return result; &#125; @Override public void fill(Category c) &#123; List&lt;Product&gt; ps = list(c.getId()); c.setProducts(ps); &#125; public void setFirstProductImage(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setFirstProductImage(p); &#125; &#125;&#125; 05 searchResult.jsptmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\searchResult.jsp 与 register.jsp 相仿，searchResult.jsp 也包含了header.jsp, top.jsp, search.jsp， footer.jsp 等公共页面。中间是搜索结果业务页面 searchResultPage.jsp 注： 在search.jsp中，又把参数keyword显示在输入框中 1&lt;input name=&quot;keyword&quot; type=&quot;text&quot; value=&quot;$&#123;param.keyword&#125;&quot; placeholder=&quot;时尚男鞋 太阳镜 &quot;&gt; 12345678&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/search.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/searchResultPage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 123456789101112131415161718192021222324252627&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;img id=&quot;logo&quot; src=&quot;img/site/logo.gif&quot; class=&quot;logo&quot;&gt; &lt;/a&gt; &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt; &lt;div class=&quot;searchDiv&quot;&gt; &lt;input name=&quot;keyword&quot; type=&quot;text&quot; value=&quot;$&#123;param.keyword&#125;&quot; placeholder=&quot;时尚男鞋 太阳镜 &quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;searchButton&quot;&gt;搜索&lt;/button&gt; &lt;div class=&quot;searchBelow&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&gt;=5 and st.count&lt;=8&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;c:if test=&quot;$&#123;st.count!=8&#125;&quot;&gt; &lt;span&gt;|&lt;/span&gt; &lt;/c:if&gt; &lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; 06 searchResultPage.jsptmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\searchResultPage.jsp 12345678910&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div id=&quot;searchResult&quot;&gt; &lt;div class=&quot;searchResultDiv&quot;&gt; &lt;%@include file=&quot;productsBySearch.jsp&quot;%&gt; &lt;/div&gt; &lt;/div&gt; 07 productsBySearch.jspproductsBySearch.jsp 显示产寻结果： 遍历ps，把每个产品的图片，价格，标题等信息显示出来 如果ps为空，则显示 “没有满足条件的产品” 12345678910111213141516171819202122232425262728293031&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;searchProducts&quot;&gt; &lt;c:forEach items=&quot;$&#123;ps&#125;&quot; var=&quot;p&quot;&gt; &lt;div class=&quot;productUnit&quot; price=&quot;$&#123;p.promotePrice&#125;&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; &lt;img class=&quot;productImage&quot; src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt; &lt;/a&gt; &lt;span class=&quot;productPrice&quot;&gt;¥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/span&gt; &lt;a class=&quot;productLink&quot; href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; $&#123;fn:substring(p.name, 0, 50)&#125; &lt;/a&gt; &lt;a class=&quot;tmallLink&quot; href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt;天猫专卖&lt;/a&gt; &lt;div class=&quot;productInfo&quot;&gt; &lt;span class=&quot;monthDeal &quot;&gt;月成交 &lt;span class=&quot;productDealNumber&quot;&gt;$&#123;p.saleCount&#125;笔&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;productReview&quot;&gt;评价&lt;span class=&quot;productReviewNumber&quot;&gt;$&#123;p.reviewCount&#125;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;wangwang&quot;&gt;&lt;img src=&quot;img/site/wangwang.png&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;c:if test=&quot;$&#123;empty ps&#125;&quot;&gt; &lt;div class=&quot;noMatch&quot;&gt;没有满足条件的产品&lt;div&gt; &lt;/c:if&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目06","date":"2020-09-16T03:22:25.000Z","path":"2020/09/16/电商网站的SSM项目06/","text":"7 原型-前端在开发功能之前，都会先有原型界面。 通常原型界面的数据不是真实的，是临时写在页面上，为用户提供一个直观的界面感受的。 原型的目的通常有两个： 用于和客户沟通交流，一图胜千言，哪里可以保留，哪里需要修改，在原型界面的基础上，就可以高效率的沟通了。 指导功能开发，有可视的原型界面，开发人员可以更准确的设计系统和功能，同时在设计系统的过程中，又能反过来验证是否支持这些界面上的功能。 7.1 前台首页前台也包括许多功能， 与后台-分类管理类似的，首先做前台-首页这个功能。 前台无需登录从前台模块之间的依赖性，以及开发顺序的合理性来考虑，把前台功能分为了 无需登录 即可使用的功能，和需要登录 才能访问的功能。 建立在前一步前台-首页的基础之上，开始进行一系列的无需登录功能开发。 前台需要登录接着是需要登录的前台功能。 这部分功能基本上都是和购物相关的。 因此，一开始先把购物流程 单独拿出来捋清楚，其中还特别注明了购物流程环节与表关系，这样能够更好的建立对前端购物功能的理解。随着这部分功能的开发，就会进入订单生成部分，在此之前，先准备了一个 订单状态图，在理解了这个图之后，可以更好的进行订单相关功能的开发。 01 静态图片资源下载地址：https://how2j.cn/frontdownload?bean.id=1515 解压到tmall-ssm\\src\\main\\webapp\\img 02 ForeController1专门用来对应前台页面的路径 03 home 方法那么首页需要什么数据呢？ 从 首页展示需求分析上来看： 在横向导航栏上提供4个分类连接 在纵向导航栏上提供全部17个分类连接 当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐产品列表 按照每种分类显示5个商品的方式，显示所有17种分类 04 CategoryCategory新增两个瞬时字段products和productsByRow。 1234List&lt;Product&gt; products; //代表一个分类下有多个产品。List&lt;List&lt;Product&gt;&gt; productsByRow; /*productsByRow这个属性的类型是List&lt;List&lt;Product&gt;&gt; productsByRow。即一个分类又对应多个 List&lt;Product&gt;，提供这个属性，是为了在首页竖状导航的分类名称右边显示推荐产品列表。*/ 一个分类会对应多行产品，而一行产品里又有多个产品记录。为了实现界面上的这个功能，为Category类设计了List&lt;List&gt; productsByRow这样一个集合属性 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.how2java.tmall.pojo; import java.util.List; public class Category &#123; private Integer id; private String name; /*如下是非数据库字段*/ private List&lt;Product&gt; products; private List&lt;List&lt;Product&gt;&gt; productsByRow; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125; public List&lt;Product&gt; getProducts() &#123; return products; &#125; public void setProducts(List&lt;Product&gt; products) &#123; this.products = products; &#125; public List&lt;List&lt;Product&gt;&gt; getProductsByRow() &#123; return productsByRow; &#125; public void setProductsByRow(List&lt;List&lt;Product&gt;&gt; productsByRow) &#123; this.productsByRow = productsByRow; &#125;&#125; 04 ProductServiceProductService新增加3个方法 123public void fill(List&lt;Category&gt; categorys);public void fill(Category category);public void fillByRow(List&lt;Category&gt; categorys); 123456789101112131415161718192021package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product; public interface ProductService &#123; void add(Product p); void delete(int id); void update(Product p); Product get(int id); List list(int cid); void setFirstProductImage(Product p); void fill(List&lt;Category&gt; cs); void fill(Category c); void fillByRow(List&lt;Category&gt; cs);&#125; 05 ProductServiceImpl为ProductService中新增加的三个方法提供实现。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.ProductMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductExample;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.ProductImageService;import com.how2java.tmall.service.ProductService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.ArrayList;import java.util.List;@Servicepublic class ProductServiceImpl implements ProductService &#123; @Autowired ProductMapper productMapper; @Autowired CategoryService categoryService; @Autowired ProductImageService productImageService; @Override public void add(Product p) &#123; productMapper.insert(p); &#125; @Override public void delete(int id) &#123; productMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Product p) &#123; productMapper.updateByPrimaryKeySelective(p); &#125; @Override public Product get(int id) &#123; Product p = productMapper.selectByPrimaryKey(id); setFirstProductImage(p); setCategory(p); return p; &#125; public void setCategory(List&lt;Product&gt; ps)&#123; for (Product p : ps) setCategory(p); &#125; public void setCategory(Product p)&#123; int cid = p.getCid(); Category c = categoryService.get(cid); p.setCategory(c); &#125; @Override public List list(int cid) &#123; ProductExample example = new ProductExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setCategory(result); setFirstProductImage(result); return result; &#125; @Override public void setFirstProductImage(Product p) &#123; List&lt;ProductImage&gt; pis = productImageService.list(p.getId(), ProductImageService.type_single); if (!pis.isEmpty()) &#123; ProductImage pi = pis.get(0); p.setFirstProductImage(pi); &#125; &#125; @Override //为分类填充产品集合 public void fill(List&lt;Category&gt; cs) &#123; for (Category c : cs) &#123; fill(c); &#125; &#125; @Override //为多个分类填充产品集合 public void fill(Category c) &#123; List&lt;Product&gt; ps = list(c.getId()); c.setProducts(ps); &#125; @Override //为多个分类填充推荐产品集合，即把分类下的产品集合，按照8个为一行，拆成多行，以利于后续页面上进行显示 public void fillByRow(List&lt;Category&gt; cs) &#123; int productNumberEachRow = 8; for (Category c : cs) &#123; List&lt;Product&gt; products = c.getProducts(); List&lt;List&lt;Product&gt;&gt; productsByRow = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; products.size(); i+=productNumberEachRow) &#123; int size = i+productNumberEachRow; size= size&gt;products.size()?products.size():size; List&lt;Product&gt; productsOfEachRow =products.subList(i, size); productsByRow.add(productsOfEachRow); &#125; c.setProductsByRow(productsByRow); &#125; &#125; public void setFirstProductImage(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setFirstProductImage(p); &#125; &#125; &#125; 06 ForeController2home()方法映射首页访问路径 “forehome”. 查询所有分类 为这些分类填充产品集合 为这些分类填充推荐产品集合 服务端跳转到home.jsp 123456789101112131415161718192021222324252627282930313233343536373839package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.*;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class ForeController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @Autowired UserService userService; @Autowired ProductImageService productImageService; @Autowired PropertyValueService propertyValueService; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @RequestMapping(&quot;forehome&quot;) public String home(Model model) &#123; List&lt;Category&gt; cs= categoryService.list(); productService.fill(cs); productService.fillByRow(cs); model.addAttribute(&quot;cs&quot;, cs); return &quot;fore/home&quot;; &#125; &#125; 07 home.jsp观察模仿天猫前端，可以发现前台页面有如下特点： 有共同的置顶导航 有共同的搜索栏 有共同的页脚 根据这样的特点，在设计前台jsp页面的时候，就制作了很多公共页面，其他前台页面就共享这些公共页面，使得开发和维护成本降低不少 根据前台页面的特点，我们把home.jsp设计成如代码所示。 header.jsp引入标准标签库，js,css，自定义javascript函数等 top.jsp置顶导航 search.jsp搜索栏 homePage.jsp首页业务页面 footer.jsp页脚 tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\fore\\home.jsp 1234567&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt;&lt;%@include file=&quot;../include/fore/header.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/top.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/search.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/home/homePage.jsp&quot;%&gt;&lt;%@include file=&quot;../include/fore/footer.jsp&quot;%&gt; 08 header.jsp声明为html5格式 1&lt;!DOCTYPE html&gt; 让浏览器以UTF显示中文，本页面的中文文字采用UTF-8编码，启动EL表达式 12&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; 引入标准标签库 c通常用于条件判断和遍历fmt用于格式化日期和货币fn用于校验长度 123&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix=&#x27;fmt&#x27; %&gt;&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt; 引入bootstrap和jquery 123&lt;script src=&quot;js/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;link href=&quot;css/bootstrap/3.3.6/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;script src=&quot;js/bootstrap/3.3.6/bootstrap.min.js&quot;&gt;&lt;/script&gt; 自定义前端样式 1&lt;link href=&quot;css/fore/style.css&quot; rel=&quot;stylesheet&quot;&gt; 除了轮播和图标，前端几乎没用Bootstrap中的样式，所有的自定义样式都在这个文件里。 tmall_ssm \\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\header.jsp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&lt;!DOCTYPE html&gt;&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix=&#x27;fmt&#x27; %&gt;&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt; &lt;html&gt; &lt;head&gt; &lt;script src=&quot;js/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;link href=&quot;css/bootstrap/3.3.6/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;script src=&quot;js/bootstrap/3.3.6/bootstrap.min.js&quot;&gt;&lt;/script&gt; &lt;link href=&quot;css/fore/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;script&gt;function formatMoney(num)&#123; num = num.toString().replace(/\\$|\\,/g,&#x27;&#x27;); if(isNaN(num)) num = &quot;0&quot;; sign = (num == (num = Math.abs(num))); num = Math.floor(num*100+0.50000000001); cents = num%100; num = Math.floor(num/100).toString(); if(cents&lt;10) cents = &quot;0&quot; + cents; for (var i = 0; i &lt; Math.floor((num.length-(1+i))/3); i++) num = num.substring(0,num.length-(4*i+3))+&#x27;,&#x27;+ num.substring(num.length-(4*i+3)); return (((sign)?&#x27;&#x27;:&#x27;-&#x27;) + num + &#x27;.&#x27; + cents); &#125;function checkEmpty(id, name)&#123; var value = $(&quot;#&quot;+id).val(); if(value.length==0)&#123; $(&quot;#&quot;+id)[0].focus(); return false; &#125; return true;&#125; $(function()&#123; $(&quot;a.productDetailTopReviewLink&quot;).click(function()&#123; $(&quot;div.productReviewDiv&quot;).show(); $(&quot;div.productDetailDiv&quot;).hide(); &#125;); $(&quot;a.productReviewTopPartSelectedLink&quot;).click(function()&#123; $(&quot;div.productReviewDiv&quot;).hide(); $(&quot;div.productDetailDiv&quot;).show(); &#125;); $(&quot;span.leaveMessageTextareaSpan&quot;).hide(); $(&quot;img.leaveMessageImg&quot;).click(function()&#123; $(this).hide(); $(&quot;span.leaveMessageTextareaSpan&quot;).show(); $(&quot;div.orderItemSumDiv&quot;).css(&quot;height&quot;,&quot;100px&quot;); &#125;); $(&quot;div#footer a[href$=#nowhere]&quot;).click(function()&#123; alert(&quot;模仿天猫的连接，并没有跳转到实际的页面&quot;); &#125;); $(&quot;a.wangwanglink&quot;).click(function()&#123; alert(&quot;模仿旺旺的图标，并不会打开旺旺&quot;); &#125;); $(&quot;a.notImplementLink&quot;).click(function()&#123; alert(&quot;这个功能没做，蛤蛤~&quot;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt; &lt;body&gt; 09 top.jsptmall_ssm \\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\top.jsp 置顶导航页面这里会根据用户是否登录，决定是否显示退出按钮，或者登录注册按钮，以及购物车中的商品数量。 1234567891011121314151617181920212223242526272829&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;nav class=&quot;top &quot;&gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;span style=&quot;color:#C40000;margin:0px&quot; class=&quot; glyphicon glyphicon-home redColor&quot;&gt;&lt;/span&gt; 天猫首页 &lt;/a&gt; &lt;span&gt;喵，欢迎来天猫&lt;/span&gt; &lt;c:if test=&quot;$&#123;!empty user&#125;&quot;&gt; &lt;a href=&quot;loginPage&quot;&gt;$&#123;user.name&#125;&lt;/a&gt; &lt;a href=&quot;forelogout&quot;&gt;退出&lt;/a&gt; &lt;/c:if&gt; &lt;c:if test=&quot;$&#123;empty user&#125;&quot;&gt; &lt;a href=&quot;loginPage&quot;&gt;请登录&lt;/a&gt; &lt;a href=&quot;registerPage&quot;&gt;免费注册&lt;/a&gt; &lt;/c:if&gt; &lt;span class=&quot;pull-right&quot;&gt; &lt;a href=&quot;forebought&quot;&gt;我的订单&lt;/a&gt; &lt;a href=&quot;forecart&quot;&gt; &lt;span style=&quot;color:#C40000;margin:0px&quot; class=&quot; glyphicon glyphicon-shopping-cart redColor&quot;&gt;&lt;/span&gt; 购物车&lt;strong&gt;$&#123;cartTotalItemNumber&#125;&lt;/strong&gt;件&lt;/a&gt; &lt;/span&gt; &lt;/nav&gt; 10 search.jsp这里会从request的属性”cs” 中获取到分类集合，并取第5个到第8个，一共4个来显示。 123456789101112131415161718192021222324252627&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;a href=&quot;$&#123;contextPath&#125;&quot;&gt; &lt;img id=&quot;logo&quot; src=&quot;img/site/logo.gif&quot; class=&quot;logo&quot;&gt; &lt;/a&gt; &lt;form action=&quot;foresearch&quot; method=&quot;post&quot; &gt; &lt;div class=&quot;searchDiv&quot;&gt; &lt;input name=&quot;keyword&quot; type=&quot;text&quot; placeholder=&quot;时尚男鞋 太阳镜 &quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;searchButton&quot;&gt;搜索&lt;/button&gt; &lt;div class=&quot;searchBelow&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&gt;=5 and st.count&lt;=8&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;c:if test=&quot;$&#123;st.count!=8&#125;&quot;&gt; &lt;span&gt;|&lt;/span&gt; &lt;/c:if&gt; &lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; 11 footer.jsp页脚部分 tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\footer.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;%@include file=&quot;modal.jsp&quot; %&gt; &lt;div id=&quot;footer&quot; class=&quot;footer&quot; style=&quot;display: block;&quot;&gt; &lt;div id=&quot;footer_ensure&quot; class=&quot;footer_ensure&quot;&gt; &lt;a href=&quot;#nowhere&quot;&gt; &lt;img src=&quot;img/site/ensure.png&quot;&gt; &lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;horizontal_line&quot;&gt; &lt;/div&gt; &lt;div id=&quot;footer_desc&quot; class=&quot;footer_desc&quot;&gt; &lt;div class=&quot;descColumn&quot;&gt; &lt;span class=&quot;descColumnTitle&quot;&gt;购物指南&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;免费注册&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;开通支付宝&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;支付宝充值&lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;descColumn&quot;&gt; &lt;span class=&quot;descColumnTitle&quot;&gt;天猫保障&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;发票保障&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;售后规则&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;缺货赔付&lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;descColumn&quot;&gt; &lt;span class=&quot;descColumnTitle&quot;&gt;支付方式&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;快捷支付&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;信用卡&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;蚂蚁花呗&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;货到付款&lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;descColumn&quot;&gt; &lt;span class=&quot;descColumnTitle&quot;&gt;商家服务&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;商家入驻&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;商家中心&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;天猫智库&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;天猫规则&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;物流服务&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;喵言喵语&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;运营服务&lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;descColumn&quot;&gt; &lt;span class=&quot;descColumnTitle&quot;&gt;手机天猫&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;&lt;img src=&quot;img/site/ma.png&quot;&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;clear:both&quot;&gt; &lt;/div&gt; &lt;div id=&quot;copyright&quot; class=&quot;copyright&quot;&gt; &lt;div class=&quot;coptyrightMiddle&quot;&gt; &lt;img id=&quot;cateye&quot; class=&quot;cateye&quot; src=&quot;img/site/cateye.png&quot;&gt; &lt;div class=&quot;white_link&quot; &gt; &lt;a href=&quot;#nowhere&quot; style=&quot;padding-left:0px&quot; &gt;关于天猫&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt; 帮助中心&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;开放平台&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt; 诚聘英才&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;联系我们&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;网站合作&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;法律声明&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt;知识产权&lt;/a&gt; &lt;a href=&quot;#nowhere&quot; &gt; 廉正举报 &lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;white_link&quot; &gt; &lt;a href=&quot;#nowhere&quot; style=&quot;padding-left:0px&quot; &gt; 阿里巴巴集团&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 淘宝网&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;天猫 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 聚划算&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;全球速卖通&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;阿里巴巴国际交易市场&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;1688&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt;阿里妈妈&lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 阿里旅行·去啊 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 阿里云计算 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 阿里通信 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; YunOS &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 阿里旅行·去啊 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 万网 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 高德 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 优视 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 友盟 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 虾米 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 天天动听 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 来往 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 钉钉 &lt;/a&gt;&lt;span class=&quot;slash&quot;&gt;|&lt;/span&gt; &lt;a href=&quot;#nowhere&quot; &gt; 支付宝 &lt;/a&gt; &lt;/div&gt; &lt;div class=&quot;license&quot;&gt; &lt;span&gt;增值电信业务经营许可证： 浙B2-20110446&lt;/span&gt; &lt;span&gt;网络文化经营许可证：浙网文[2015]0295-065号&lt;/span&gt; &lt;span&gt;互联网医疗保健信息服务 审核同意书 浙卫网审【2014】6号 &lt;/span&gt; &lt;span&gt;互联网药品信息服务资质证书编号：浙-（经营性）-2012-0005&lt;/span&gt; &lt;div class=&quot;copyRightYear&quot;&gt;© 2003-2016 TMALL.COM 版权所有&lt;/div&gt; &lt;div&gt; &lt;img src=&quot;img/site/copyRight1.jpg&quot;&gt; &lt;img src=&quot;img/site/copyRight2.jpg&quot;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 除了显示页脚的静态信息外，还包含了modal.jsp 这个modal.jsp里提供了两个模态窗口 1. 登录模态窗口 当用户在未登录状态，于产品页点击购买的时候会弹出 2. 删除模态窗口 当用户在我的订单页面,和购物车页面进行删除操作的时候，就会弹出模态删除窗口。 tmall_ssm\\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\modal.jsp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;modal &quot; id=&quot;loginModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt; &lt;div class=&quot;modal-dialog loginDivInProductPageModalDiv&quot;&gt; &lt;div class=&quot;modal-content&quot;&gt; &lt;div class=&quot;loginDivInProductPage&quot;&gt; &lt;div class=&quot;loginErrorMessageDiv&quot;&gt; &lt;div class=&quot;alert alert-danger&quot; &gt; &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt; &lt;span class=&quot;errorMessage&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;login_acount_text&quot;&gt;账户登录&lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-user&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;手机/会员名/邮箱&quot; type=&quot;text&quot;&gt; &lt;/div&gt; &lt;div class=&quot;loginInput &quot; &gt; &lt;span class=&quot;loginInputIcon &quot;&gt; &lt;span class=&quot; glyphicon glyphicon-lock&quot;&gt;&lt;/span&gt; &lt;/span&gt; &lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;密码&quot;&gt; &lt;/div&gt; &lt;span class=&quot;text-danger&quot;&gt;不要输入真实的天猫账号密码&lt;/span&gt;&lt;br&gt;&lt;br&gt; &lt;div&gt; &lt;a href=&quot;#nowhere&quot;&gt;忘记登录密码&lt;/a&gt; &lt;a href=&quot;register.jsp&quot; class=&quot;pull-right&quot;&gt;免费注册&lt;/a&gt; &lt;/div&gt; &lt;div style=&quot;margin-top:20px&quot;&gt; &lt;button class=&quot;btn btn-block redButton loginSubmitButton&quot; type=&quot;submit&quot;&gt;登录&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; &lt;div class=&quot;modal&quot; id=&quot;deleteConfirmModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; &gt; &lt;div class=&quot;modal-dialog deleteConfirmModalDiv&quot;&gt; &lt;div class=&quot;modal-content&quot;&gt; &lt;div class=&quot;modal-header&quot;&gt; &lt;button data-dismiss=&quot;modal&quot; class=&quot;close&quot; type=&quot;button&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Close&lt;/span&gt;&lt;/button&gt; &lt;h4 class=&quot;modal-title&quot;&gt;确认删除？&lt;/h4&gt; &lt;/div&gt; &lt;div class=&quot;modal-footer&quot;&gt; &lt;button data-dismiss=&quot;modal&quot; class=&quot;btn btn-default&quot; type=&quot;button&quot;&gt;关闭&lt;/button&gt; &lt;button class=&quot;btn btn-primary deleteConfirmButton&quot; id=&quot;submit&quot; type=&quot;button&quot;&gt;确认&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 12.homePage.jsp首页业务页面 在homePage中要显示如下内容1 天猫超市连接右侧有4个分类数据2 竖状导航栏显示17个分类数据3 每个分类又再对应不同的推荐产品集合4 中部会显示17个分类5 每个分类又显示前5款产品6 每款产品又会显示第一张图片，标题，价格等信息 倘若把这些功能都在一个jsp中开发出来看，那么这个jsp就会变得非常的长，并且难以维护和扩展。在这里，就可以借鉴home.jsp的思路，把一个大的页面，拆成各个小的jsp，这样维护起来就相对容易了 tmall_ssm \\src\\main\\webapp\\WEB-INF\\jsp\\include\\fore\\home 123456789&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;title&gt;模仿天猫官网&lt;/title&gt; &lt;div class=&quot;homepageDiv&quot;&gt; &lt;%@include file=&quot;categoryAndcarousel.jsp&quot;%&gt; &lt;%@include file=&quot;homepageCategoryProducts.jsp&quot;%&gt; &lt;/div&gt; categoryAndcarousel.jsp分类和轮播1.1 categoryMenu.jsp竖状分类菜单1.2 productsAsideCategorys.jsp竖状分类菜单右侧的推荐产品列表1.3 carousel.jsp轮播 homepageCategoryProducts.jsp总体17种分类以及每种分类对应的5个产品 13 categoryAndcarousel.jspcategoryAndcarousel.jsp 页面利用ForeController传递过来的数据，天猫国际几个字旁边显示4个分类超链另外包含了其他3个页面：categoryMenu.jspproductsAsideCategorys.jspcarousel.jsp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;function showProductsAsideCategorys(cid)&#123; $(&quot;div.eachCategory[cid=&quot;+cid+&quot;]&quot;).css(&quot;background-color&quot;,&quot;white&quot;); $(&quot;div.eachCategory[cid=&quot;+cid+&quot;] a&quot;).css(&quot;color&quot;,&quot;#87CEFA&quot;); $(&quot;div.productsAsideCategorys[cid=&quot;+cid+&quot;]&quot;).show();&#125; function hideProductsAsideCategorys(cid)&#123; $(&quot;div.eachCategory[cid=&quot;+cid+&quot;]&quot;).css(&quot;background-color&quot;,&quot;#e2e2e3&quot;); $(&quot;div.eachCategory[cid=&quot;+cid+&quot;] a&quot;).css(&quot;color&quot;,&quot;#000&quot;); $(&quot;div.productsAsideCategorys[cid=&quot;+cid+&quot;]&quot;).hide();&#125;$(function()&#123; $(&quot;div.eachCategory&quot;).mouseenter(function()&#123; var cid = $(this).attr(&quot;cid&quot;); showProductsAsideCategorys(cid); &#125;); $(&quot;div.eachCategory&quot;).mouseleave(function()&#123; var cid = $(this).attr(&quot;cid&quot;); hideProductsAsideCategorys(cid); &#125;); $(&quot;div.productsAsideCategorys&quot;).mouseenter(function()&#123; var cid = $(this).attr(&quot;cid&quot;); showProductsAsideCategorys(cid); &#125;); $(&quot;div.productsAsideCategorys&quot;).mouseleave(function()&#123; var cid = $(this).attr(&quot;cid&quot;); hideProductsAsideCategorys(cid); &#125;); $(&quot;div.rightMenu span&quot;).mouseenter(function()&#123; var left = $(this).position().left; var top = $(this).position().top; var width = $(this).css(&quot;width&quot;); var destLeft = parseInt(left) + parseInt(width)/2; $(&quot;img#catear&quot;).css(&quot;left&quot;,destLeft); $(&quot;img#catear&quot;).css(&quot;top&quot;,top-20); $(&quot;img#catear&quot;).fadeIn(500); &#125;); $(&quot;div.rightMenu span&quot;).mouseleave(function()&#123; $(&quot;img#catear&quot;).hide(); &#125;); var left = $(&quot;div#carousel-of-product&quot;).offset().left; $(&quot;div.categoryMenu&quot;).css(&quot;left&quot;,left-20); $(&quot;div.categoryWithCarousel div.head&quot;).css(&quot;margin-left&quot;,left); $(&quot;div.productsAsideCategorys&quot;).css(&quot;left&quot;,left-20); &#125;);&lt;/script&gt; &lt;img src=&quot;img/site/catear.png&quot; id=&quot;catear&quot; class=&quot;catear&quot;/&gt; &lt;div class=&quot;categoryWithCarousel&quot;&gt; &lt;div class=&quot;headbar show1&quot;&gt; &lt;div class=&quot;head &quot;&gt; &lt;span style=&quot;margin-left:10px&quot; class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt; &lt;span style=&quot;margin-left:10px&quot; &gt;商品分类&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;rightMenu&quot;&gt; &lt;span&gt;&lt;a href=&quot;&quot;&gt;&lt;img src=&quot;img/site/chaoshi.png&quot;/&gt;&lt;/a&gt;&lt;/span&gt; &lt;span&gt;&lt;a href=&quot;&quot;&gt;&lt;img src=&quot;img/site/guoji.png&quot;/&gt;&lt;/a&gt;&lt;/span&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&lt;=4&#125;&quot;&gt; &lt;span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt;&lt;/span&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/div&gt; &lt;div style=&quot;position: relative&quot;&gt; &lt;%@include file=&quot;categoryMenu.jsp&quot; %&gt;&lt;/div&gt; &lt;div style=&quot;position: relative;left: 0;top: 0;&quot;&gt; &lt;%@include file=&quot;productsAsideCategorys.jsp&quot; %&gt;&lt;/div&gt; &lt;%@include file=&quot;carousel.jsp&quot; %&gt; &lt;div class=&quot;carouselBackgroundDiv&quot;&gt;&lt;/div&gt; &lt;/div&gt; 14 categoryMenu.jspcategoryMenu.jsp 显示左侧的竖状分类导航 12345678910111213&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div class=&quot;categoryMenu&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot;&gt; &lt;div cid=&quot;$&#123;c.id&#125;&quot; class=&quot;eachCategory&quot;&gt; &lt;span class=&quot;glyphicon glyphicon-link&quot;&gt;&lt;/span&gt; &lt;a href=&quot;forecategory?cid=$&#123;c.id&#125;&quot;&gt; $&#123;c.name&#125; &lt;/a&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/div&gt; 15 productsAsideCategorys.jspproductsAsideCategorys.jsp 进行了三层遍历 先取出每个分类 然后取出每个分类的productsByRow集合 根据productsByRow集合，取出每个产品，把产品的subTitle信息里的第一个单词取出来显示。 JQuery代码解释： 这个是用于随机挑选一个产品作为推荐产品，来进行高亮显示。 严格的说，应该是后台设置那个产品是推荐产品，不过这里偷懒了，直接在前端按照20%的概率，随机挑选了一个产品。 12345$(&quot;div.productsAsideCategorys div.row a&quot;).each(function()&#123; var v = Math.round(Math.random() *6); if(v == 1) $(this).css(&quot;color&quot;,&quot;#87CEFA&quot;);&#125;); 1234567891011121314151617181920212223242526272829303132333435&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;$(function()&#123; $(&quot;div.productsAsideCategorys div.row a&quot;).each(function()&#123; var v = Math.round(Math.random() *6); if(v == 1) $(this).css(&quot;color&quot;,&quot;#87CEFA&quot;); &#125;);&#125;); &lt;/script&gt;&lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot;&gt; &lt;div cid=&quot;$&#123;c.id&#125;&quot; class=&quot;productsAsideCategorys&quot;&gt; &lt;c:forEach items=&quot;$&#123;c.productsByRow&#125;&quot; var=&quot;ps&quot;&gt; &lt;div class=&quot;row show1&quot;&gt; &lt;c:forEach items=&quot;$&#123;ps&#125;&quot; var=&quot;p&quot;&gt; &lt;c:if test=&quot;$&#123;!empty p.subTitle&#125;&quot;&gt; &lt;a href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; &lt;c:forEach items=&quot;$&#123;fn:split(p.subTitle, &#x27; &#x27;)&#125;&quot; var=&quot;title&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.index==0&#125;&quot;&gt; $&#123;title&#125; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;/a&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;div class=&quot;seperator&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/div&gt; &lt;/c:forEach&gt; 16 carousel.jsp轮播部分，都是静态的页面，没有用到服务端数据 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;div id=&quot;carousel-of-product&quot; class=&quot;carousel-of-product carousel slide1&quot; data-ride=&quot;carousel&quot;&gt; &lt;!-- Indicators --&gt; &lt;ol class=&quot;carousel-indicators&quot;&gt; &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;0&quot; class=&quot;active&quot;&gt;&lt;/li&gt; &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;1&quot;&gt;&lt;/li&gt; &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;2&quot;&gt;&lt;/li&gt; &lt;li data-target=&quot;#carousel-of-product&quot; data-slide-to=&quot;3&quot;&gt;&lt;/li&gt; &lt;/ol&gt; &lt;!-- Wrapper for slides --&gt; &lt;div class=&quot;carousel-inner&quot; role=&quot;listbox&quot;&gt; &lt;div class=&quot;item active&quot;&gt; &lt;img class=&quot;carousel carouselImage&quot; src=&quot;img/lunbo/1.jpg&quot; &gt; &lt;/div&gt; &lt;div class=&quot;item&quot;&gt; &lt;img class=&quot;carouselImage&quot; src=&quot;img/lunbo/2.jpg&quot; &gt; &lt;/div&gt; &lt;div class=&quot;item&quot;&gt; &lt;img class=&quot;carouselImage&quot; src=&quot;img/lunbo/3.jpg&quot; &gt; &lt;/div&gt; &lt;div class=&quot;item&quot;&gt; &lt;img class=&quot;carouselImage&quot; src=&quot;img/lunbo/4.jpg&quot; &gt; &lt;/div&gt; &lt;/div&gt; &lt;!-- Controls --&gt;&lt;!-- &lt;a class=&quot;left carousel-control&quot; href=&quot;#carousel-of-product&quot; role=&quot;button&quot; data-slide=&quot;prev&quot;&gt; --&gt;&lt;!-- &lt;span class=&quot;glyphicon glyphicon-chevron-left&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; --&gt; &lt;!-- &lt;/a&gt; --&gt;&lt;!-- &lt;a class=&quot;right carousel-control&quot; href=&quot;#carousel-of-product&quot; role=&quot;button&quot; data-slide=&quot;next&quot;&gt; --&gt;&lt;!-- &lt;span class=&quot;glyphicon glyphicon-chevron-right&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; --&gt; &lt;!-- &lt;/a&gt; --&gt; &lt;/div&gt; 17 homepageCategoryProducts.jsphomepageCategoryProducts.jsp 进行了2次遍历 遍历所有的分类，取出每个分类对象 遍历分类对象的products集合，取出每个产品，然后显示该产品的标题，图片，价格等信息 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;!DOCTYPE html&gt;&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;c:if test=&quot;$&#123;empty param.categorycount&#125;&quot;&gt; &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;100&quot;/&gt;&lt;/c:if&gt; &lt;c:if test=&quot;$&#123;!empty param.categorycount&#125;&quot;&gt; &lt;c:set var=&quot;categorycount&quot; scope=&quot;page&quot; value=&quot;$&#123;param.categorycount&#125;&quot;/&gt;&lt;/c:if&gt; &lt;div class=&quot;homepageCategoryProducts&quot;&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot; varStatus=&quot;stc&quot;&gt; &lt;c:if test=&quot;$&#123;stc.count&lt;=categorycount&#125;&quot;&gt; &lt;div class=&quot;eachHomepageCategoryProducts&quot;&gt; &lt;div class=&quot;left-mark&quot;&gt;&lt;/div&gt; &lt;span class=&quot;categoryTitle&quot;&gt;$&#123;c.name&#125;&lt;/span&gt; &lt;br&gt; &lt;c:forEach items=&quot;$&#123;c.products&#125;&quot; var=&quot;p&quot; varStatus=&quot;st&quot;&gt; &lt;c:if test=&quot;$&#123;st.count&lt;=5&#125;&quot;&gt; &lt;div class=&quot;productItem&quot; &gt; &lt;a href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt;&lt;img width=&quot;100px&quot; src=&quot;img/productSingle_middle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/a&gt; &lt;a class=&quot;productItemDescLink&quot; href=&quot;foreproduct?pid=$&#123;p.id&#125;&quot;&gt; &lt;span class=&quot;productItemDesc&quot;&gt;[热销] $&#123;fn:substring(p.name, 0, 20)&#125; &lt;/span&gt; &lt;/a&gt; &lt;span class=&quot;productPrice&quot;&gt; &lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; minFractionDigits=&quot;2&quot;/&gt; &lt;/span&gt; &lt;/div&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/c:if&gt; &lt;/c:forEach&gt; &lt;img id=&quot;endpng&quot; class=&quot;endpng&quot; src=&quot;img/site/end.png&quot;&gt; &lt;/div&gt; 虽然首页显示的内容非常多，可以说是前端里最复杂的一个展示页面，但是通过这种拆成小块jsp的思路，每个jsp页面的功能就相对单一了。 可以更好的帮助大家理解。","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目05","date":"2020-09-05T01:20:25.000Z","path":"2020/09/05/电商网站的SSM项目05/","text":"6 后台其他页面6.1 属性管理01 PropertyProperty实体类已经和其他所有的实体类一起，在所有逆向工程 这个环节就一起自动生成好了。 不过仅仅有自动生成的实体类代码，还不足以支撑业务需要，所以在Property基础上增加了一个Category 字段。 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.how2java.tmall.pojo; public class Property &#123; private Integer id; private Integer cid; private String name; /*非数据库字段*/ private Category category; public Category getCategory() &#123; return category; &#125; public void setCategory(Category category) &#123; this.category = category; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public Integer getCid() &#123; return cid; &#125; public void setCid(Integer cid) &#123; this.cid = cid; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125;&#125; 02 PropertyService新建PropertyService，提供CRUD一套。 需要注意的是，因为在业务上需要查询某个分类下的属性，所以list方法会带上对应分类的id 12345678910111213package com.how2java.tmall.service; import com.how2java.tmall.pojo.Property; import java.util.List; public interface PropertyService &#123; void add(Property c); void delete(int id); void update(Property c); Property get(int id); List list(int cid);&#125; 03 PropertyServiceImpl新增PropertyServiceImpl实现[PropertyService]对应的方法。 通过调用自动生成的PropertyMapper就可以实现大部分方法了。值得注意的是查询的时候用到了辅助查询类：PropertyExample，它的使用也很方便，这一行表示查询cid字段 1example.createCriteria().andCidEqualTo(cid); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.PropertyMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.Property;import com.how2java.tmall.pojo.PropertyExample;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.PropertyService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class PropertyServiceImpl implements PropertyService &#123; @Autowired PropertyMapper propertyMapper; @Override public void add(Property p) &#123; propertyMapper.insert(p); &#125; @Override public void delete(int id) &#123; propertyMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Property p) &#123; propertyMapper.updateByPrimaryKeySelective(p); &#125; @Override public Property get(int id) &#123; return propertyMapper.selectByPrimaryKey(id); &#125; @Override public List list(int cid) &#123; PropertyExample example =new PropertyExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); return propertyMapper.selectByExample(example); &#125; &#125; 04 PropertyController控制器类，用于映射不同路径的访问。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package com.how2java.tmall.controller; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Property;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.PropertyService;import com.how2java.tmall.util.Page; @Controller@RequestMapping(&quot;&quot;)public class PropertyController &#123; @Autowired CategoryService categoryService; @Autowired PropertyService propertyService; //在PropertyController通过参数Property 接受注入 @RequestMapping(&quot;admin_property_add&quot;) public String add(Model model, Property p) &#123; propertyService.add(p); //通过propertyService保存到数据库 return &quot;redirect:admin_property_list?cid=&quot;+p.getCid(); //客户端跳转到admin_property_list,并带上参数cid &#125; @RequestMapping(&quot;admin_property_delete&quot;) //在PropertyController的delete方法中获取id public String delete(int id) &#123; //根据id获取Property对象 Property p = propertyService.get(id); // 借助propertyService删除这个对象对应的数据 propertyService.delete(id); //客户端跳转到admin_property_list，并带上参数cid return &quot;redirect:admin_property_list?cid=&quot;+p.getCid(); &#125; @RequestMapping(&quot;admin_property_edit&quot;) public String edit(Model model, int id) &#123; //在PropertyController的edit方法中，根据id获取Property对象 Property p = propertyService.get(id); //根据properoty对象的cid属性获取Category对象，并把其设置在Property对象的category属性上 Category c = categoryService.get(p.getCid()); //把Property对象放在request的 &quot;p&quot; 属性中 p.setCategory(c); model.addAttribute(&quot;p&quot;, p); //服务端跳转到admin/editProperty.jsp return &quot;admin/editProperty&quot;; &#125; @RequestMapping(&quot;admin_property_update&quot;) ////在PropertyController的update方法中获取Property对象 public String update(Property p) &#123; //借助propertyService更新这个对象到数据库 propertyService.update(p); //客户端跳转到admin_property_list，并带上参数cid return &quot;redirect:admin_property_list?cid=&quot;+p.getCid(); &#125; //查询地址admin_property_list映射的是PropertyController的list()方法 @RequestMapping(&quot;admin_property_list&quot;) //获取分类 cid,和分页对象page public String list(int cid, Model model, Page page) &#123; Category c = categoryService.get(cid); //通过PageHelper设置分页参数 PageHelper.offsetPage(page.getStart(),page.getCount()); //基于cid，获取当前分类下的属性集合 List&lt;Property&gt; ps = propertyService.list(cid); //通过PageInfo获取属性总数 int total = (int) new PageInfo&lt;&gt;(ps).getTotal(); //把总数设置给分页page对象 page.setTotal(total); //拼接字符串&quot;&amp;cid=&quot;+c.getId()，设置给page对象的Param值。 因为属性分页都是基于当前分类下的分页，所以分页的时候需要传递这个cid page.setParam(&quot;&amp;cid=&quot;+c.getId()); //把属性集合设置到 request的 &quot;ps&quot; 属性上 model.addAttribute(&quot;ps&quot;, ps); //把分类对象设置到 request的 &quot;c&quot; 属性上 model.addAttribute(&quot;c&quot;, c); //把分页对象设置到 request的 &quot;page&quot; 对象上 model.addAttribute(&quot;page&quot;, page); //服务端跳转到admin/listProperty.jsp页面 return &quot;admin/listProperty&quot;; &#125;&#125; 04 listProperty.jsp+editProperty.jsp查询和编辑的jsp页面 listProperty.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt; $(function() &#123; $(&quot;#addForm&quot;).submit(function() &#123; if (checkEmpty(&quot;name&quot;, &quot;属性名称&quot;)) return true; return false; &#125;); &#125;);&lt;/script&gt; &lt;title&gt;属性管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;!--面包屑导航--&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;!--第一个连接跳转到admin_category_list--&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;!--第二个连接跳转到admin_property_list?cid=--&gt; &lt;li&gt;&lt;a href=&quot;admin_property_list?cid=$&#123;c.id&#125;&quot;&gt;$&#123;c.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;属性管理&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;属性名称&lt;/th&gt; &lt;th&gt;编辑&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;!--在listProperty.jsp页面上使用c:forEach 遍历ps集合，并显示--&gt; &lt;c:forEach items=&quot;$&#123;ps&#125;&quot; var=&quot;p&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt; &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_property_edit?id=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_property_delete?id=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot;%&gt; &lt;/div&gt; &lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增属性&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_property_add&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;属性名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;!-- 在listProperty.jsp页面提交数据的时候，除了提交属性名称，还会提交cid--&gt; &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;$&#123;c.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; editProperty.jsp 123456789101112131415161718192021222324252627282930313233343536373839&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;title&gt;编辑属性&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;admin_property_list?cid=$&#123;p.category.id&#125;&quot;&gt;$&#123;p.category.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;编辑属性&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;panel panel-warning editDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;编辑属性&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_property_update&quot;&gt; &lt;table class=&quot;editTable&quot;&gt; &lt;tr&gt; &lt;td&gt;属性名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; value=&quot;$&#123;p.name&#125;&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;!--在editProperty.jsp中显示属性名称--&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;$&#123;p.id&#125;&quot;&gt; &lt;!--在editProperty.jsp中隐式提供id和cid( cid 通过 p.category.id 获取)--&gt; &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;$&#123;p.category.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 6.2 产品管理01 ProductProduct在自动生成的基础上增加category属性 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798package com.how2java.tmall.pojo; import java.util.Date;import java.util.List; public class Product &#123; private Integer id; private String name; private String subTitle; private Float originalPrice; private Float promotePrice; private Integer stock; private Integer cid; private Date createDate; /*非数据库字段*/ private Category category; public Category getCategory() &#123; return category; &#125; public void setCategory(Category category) &#123; this.category = category; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125; public String getSubTitle() &#123; return subTitle; &#125; public void setSubTitle(String subTitle) &#123; this.subTitle = subTitle == null ? null : subTitle.trim(); &#125; public Float getOriginalPrice() &#123; return originalPrice; &#125; public void setOriginalPrice(Float originalPrice) &#123; this.originalPrice = originalPrice; &#125; public Float getPromotePrice() &#123; return promotePrice; &#125; public void setPromotePrice(Float promotePrice) &#123; this.promotePrice = promotePrice; &#125; public Integer getStock() &#123; return stock; &#125; public void setStock(Integer stock) &#123; this.stock = stock; &#125; public Integer getCid() &#123; return cid; &#125; public void setCid(Integer cid) &#123; this.cid = cid; &#125; public Date getCreateDate() &#123; return createDate; &#125; public void setCreateDate(Date createDate) &#123; this.createDate = createDate; &#125; &#125; 02 ProductService新增ProductService，提供CRUD一套 1234567891011121314package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product; public interface ProductService &#123; void add(Product p); void delete(int id); void update(Product p); Product get(int id); List list(int cid);&#125; 03 ProductServiceImpl新增ProductServiceImpl ，提供CRUD一套。 值得一提的是， get和list方法都会把取出来的Product对象设置上对应的category 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.ProductMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductExample;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.ProductService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List;@Servicepublic class ProductServiceImpl implements ProductService &#123; @Autowired ProductMapper productMapper; @Autowired CategoryService categoryService; @Override public void add(Product p) &#123; productMapper.insert(p); &#125; @Override public void delete(int id) &#123; productMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Product p) &#123; productMapper.updateByPrimaryKeySelective(p); &#125; @Override public Product get(int id) &#123; Product p = productMapper.selectByPrimaryKey(id); setCategory(p); return p; &#125; public void setCategory(List&lt;Product&gt; ps)&#123; for (Product p : ps) setCategory(p); &#125; public void setCategory(Product p)&#123; int cid = p.getCid(); Category c = categoryService.get(cid); p.setCategory(c); &#125; @Override public List list(int cid) &#123; ProductExample example = new ProductExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setCategory(result); return result; &#125;&#125; 04 ProductController12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.how2java.tmall.controller; import java.util.Date;import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.ProductService;import com.how2java.tmall.util.Page; @Controller@RequestMapping(&quot;&quot;)public class ProductController &#123; @Autowired CategoryService categoryService; @Autowired ProductService productService; @RequestMapping(&quot;admin_product_add&quot;) public String add(Model model, Product p) &#123; p.setCreateDate(new Date()); productService.add(p); return &quot;redirect:admin_product_list?cid=&quot;+p.getCid(); &#125; @RequestMapping(&quot;admin_product_delete&quot;) public String delete(int id) &#123; Product p = productService.get(id); productService.delete(id); return &quot;redirect:admin_product_list?cid=&quot;+p.getCid(); &#125; @RequestMapping(&quot;admin_product_edit&quot;) public String edit(Model model, int id) &#123; Product p = productService.get(id); Category c = categoryService.get(p.getCid()); p.setCategory(c); model.addAttribute(&quot;p&quot;, p); return &quot;admin/editProduct&quot;; &#125; @RequestMapping(&quot;admin_product_update&quot;) public String update(Product p) &#123; productService.update(p); return &quot;redirect:admin_product_list?cid=&quot;+p.getCid(); &#125; @RequestMapping(&quot;admin_product_list&quot;) public String list(int cid, Model model, Page page) &#123; Category c = categoryService.get(cid); PageHelper.offsetPage(page.getStart(),page.getCount()); List&lt;Product&gt; ps = productService.list(cid); int total = (int) new PageInfo&lt;&gt;(ps).getTotal(); page.setTotal(total); page.setParam(&quot;&amp;cid=&quot;+c.getId()); model.addAttribute(&quot;ps&quot;, ps); model.addAttribute(&quot;c&quot;, c); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listProduct&quot;; &#125;&#125; 05 listProduct.jsp+editProduct.jsp然后是查询和编辑的jsp页面 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt; $(function() &#123; $(&quot;#addForm&quot;).submit(function() &#123; if (!checkEmpty(&quot;name&quot;, &quot;产品名称&quot;)) return false;// if (!checkEmpty(&quot;subTitle&quot;, &quot;小标题&quot;))// return false; if (!checkNumber(&quot;originalPrice&quot;, &quot;原价格&quot;)) return false; if (!checkNumber(&quot;promotePrice&quot;, &quot;优惠价格&quot;)) return false; if (!checkInt(&quot;stock&quot;, &quot;库存&quot;)) return false; return true; &#125;); &#125;);&lt;/script&gt; &lt;title&gt;产品管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;c.id&#125;&quot;&gt;$&#123;c.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;产品管理&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;图片&lt;/th&gt; &lt;th&gt;产品名称&lt;/th&gt; &lt;th&gt;产品小标题&lt;/th&gt; &lt;th width=&quot;53px&quot;&gt;原价格&lt;/th&gt; &lt;th width=&quot;80px&quot;&gt;优惠价格&lt;/th&gt; &lt;th width=&quot;80px&quot;&gt;库存数量&lt;/th&gt; &lt;th width=&quot;80px&quot;&gt;图片管理&lt;/th&gt; &lt;th width=&quot;80px&quot;&gt;设置属性&lt;/th&gt; &lt;th width=&quot;42px&quot;&gt;编辑&lt;/th&gt; &lt;th width=&quot;42px&quot;&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;ps&#125;&quot; var=&quot;p&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;p.id&#125;&lt;/td&gt; &lt;td&gt; &lt;%--&lt;c:if test=&quot;$&#123;!empty p.firstProductImage&#125;&quot;&gt;--%&gt; &lt;%--&lt;img width=&quot;40px&quot; src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt;--%&gt; &lt;%--&lt;/c:if&gt;--%&gt; &lt;/td&gt; &lt;td&gt;$&#123;p.name&#125;&lt;/td&gt; &lt;td&gt;$&#123;p.subTitle&#125;&lt;/td&gt; &lt;td&gt;$&#123;p.originalPrice&#125;&lt;/td&gt; &lt;td&gt;$&#123;p.promotePrice&#125;&lt;/td&gt; &lt;td&gt;$&#123;p.stock&#125;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_productImage_list?pid=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-picture&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_propertyValue_edit?pid=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_product_edit?id=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_product_delete?id=$&#123;p.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot;%&gt; &lt;/div&gt; &lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_product_add&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;产品名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;产品小标题&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;subTitle&quot; name=&quot;subTitle&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;原价格&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;originalPrice&quot; value=&quot;99.98&quot; name=&quot;originalPrice&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;优惠价格&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;promotePrice&quot; value=&quot;19.98&quot; name=&quot;promotePrice&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;库存&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;stock&quot; value=&quot;99&quot; name=&quot;stock&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;$&#123;c.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;title&gt;编辑产品&lt;/title&gt; &lt;script&gt; $(function() &#123; $(&quot;#editForm&quot;).submit(function() &#123; if (!checkEmpty(&quot;name&quot;, &quot;产品名称&quot;)) return false;// if (!checkEmpty(&quot;subTitle&quot;, &quot;小标题&quot;))// return false; if (!checkNumber(&quot;originalPrice&quot;, &quot;原价格&quot;)) return false; if (!checkNumber(&quot;promotePrice&quot;, &quot;优惠价格&quot;)) return false; if (!checkInt(&quot;stock&quot;, &quot;库存&quot;)) return false; return true; &#125;); &#125;);&lt;/script&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;p.category.id&#125;&quot;&gt;$&#123;p.category.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;$&#123;p.name&#125;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;编辑产品&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;panel panel-warning editDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;编辑产品&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_product_update&quot;&gt; &lt;table class=&quot;editTable&quot;&gt; &lt;tr&gt; &lt;td&gt;产品名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; value=&quot;$&#123;p.name&#125;&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;产品小标题&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;subTitle&quot; name=&quot;subTitle&quot; type=&quot;text&quot; value=&quot;$&#123;p.subTitle&#125;&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;原价格&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;originalPrice&quot; value=&quot;$&#123;p.originalPrice&#125;&quot; name=&quot;originalPrice&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;优惠价格&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;promotePrice&quot; value=&quot;$&#123;p.promotePrice&#125;&quot; name=&quot;promotePrice&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;库存&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;stock&quot; value=&quot;$&#123;p.stock&#125;&quot; name=&quot;stock&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;$&#123;p.id&#125;&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;cid&quot; value=&quot;$&#123;p.category.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 6.3 产品图片管理ProductImage直接使用自动生成的，没有变化 01 ProductImageService创建ProductImageService，提供CURD。 12345678910111213141516171819package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.ProductImage; public interface ProductImageService &#123; //两个常量，分别表示单个图片和详情图片： String type_single = &quot;type_single&quot;; String type_detail = &quot;type_detail&quot;; void add(ProductImage pi); void delete(int id); void update(ProductImage pi); ProductImage get(int id); //根据产品id和图片类型查询的list方法 List list(int pid, String type);&#125; 02 ProductImageServiceImpl创建ProductImageServiceImpl，实现CURD相关方法 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.ProductImageMapper;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.pojo.ProductImageExample;import com.how2java.tmall.service.ProductImageService; @Servicepublic class ProductImageServiceImpl implements ProductImageService &#123; @Autowired ProductImageMapper productImageMapper; @Override public void add(ProductImage pi) &#123; productImageMapper.insert(pi); &#125; @Override public void delete(int id) &#123; productImageMapper.deleteByPrimaryKey(id); &#125; @Override public void update(ProductImage pi) &#123; productImageMapper.updateByPrimaryKeySelective(pi); &#125; @Override public ProductImage get(int id) &#123; return productImageMapper.selectByPrimaryKey(id); &#125; @Override public List list(int pid, String type) &#123; ProductImageExample example =new ProductImageExample(); //关于list方法，使用了ProductImageExample 类，这样的写法表示同时匹配pid和type。 example.createCriteria() .andPidEqualTo(pid) .andTypeEqualTo(type); example.setOrderByClause(&quot;id desc&quot;); return productImageMapper.selectByExample(example); &#125;&#125; 03 ProductImageController提供了list,add和delete方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.how2java.tmall.controller; import java.awt.image.BufferedImage;import java.io.File;import java.util.List; import javax.imageio.ImageIO;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.service.ProductImageService;import com.how2java.tmall.service.ProductService;import com.how2java.tmall.util.ImageUtil;import com.how2java.tmall.util.Page;import com.how2java.tmall.util.UploadedImageFile; @Controller@RequestMapping(&quot;&quot;)public class ProductImageController &#123; @Autowired ProductService productService; @Autowired ProductImageService productImageService; @RequestMapping(&quot;admin_productImage_add&quot;) public String add(ProductImage pi, HttpSession session, UploadedImageFile uploadedImageFile) &#123; productImageService.add(pi); String fileName = pi.getId()+ &quot;.jpg&quot;; String imageFolder; String imageFolder_small=null; String imageFolder_middle=null; if(ProductImageService.type_single.equals(pi.getType()))&#123; imageFolder= session.getServletContext().getRealPath(&quot;img/productSingle&quot;); imageFolder_small= session.getServletContext().getRealPath(&quot;img/productSingle_small&quot;); imageFolder_middle= session.getServletContext().getRealPath(&quot;img/productSingle_middle&quot;); &#125; else&#123; imageFolder= session.getServletContext().getRealPath(&quot;img/productDetail&quot;); &#125; File f = new File(imageFolder, fileName); f.getParentFile().mkdirs(); try &#123; uploadedImageFile.getImage().transferTo(f); BufferedImage img = ImageUtil.change2jpg(f); ImageIO.write(img, &quot;jpg&quot;, f); if(ProductImageService.type_single.equals(pi.getType())) &#123; File f_small = new File(imageFolder_small, fileName); File f_middle = new File(imageFolder_middle, fileName); ImageUtil.resizeImage(f, 56, 56, f_small); ImageUtil.resizeImage(f, 217, 190, f_middle); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return &quot;redirect:admin_productImage_list?pid=&quot;+pi.getPid(); &#125; @RequestMapping(&quot;admin_productImage_delete&quot;) public String delete(int id,HttpSession session) &#123; ProductImage pi = productImageService.get(id); String fileName = pi.getId()+ &quot;.jpg&quot;; String imageFolder; String imageFolder_small=null; String imageFolder_middle=null; if(ProductImageService.type_single.equals(pi.getType()))&#123; imageFolder= session.getServletContext().getRealPath(&quot;img/productSingle&quot;); imageFolder_small= session.getServletContext().getRealPath(&quot;img/productSingle_small&quot;); imageFolder_middle= session.getServletContext().getRealPath(&quot;img/productSingle_middle&quot;); File imageFile = new File(imageFolder,fileName); File f_small = new File(imageFolder_small,fileName); File f_middle = new File(imageFolder_middle,fileName); imageFile.delete(); f_small.delete(); f_middle.delete(); &#125; else&#123; imageFolder= session.getServletContext().getRealPath(&quot;img/productDetail&quot;); File imageFile = new File(imageFolder,fileName); imageFile.delete(); &#125; productImageService.delete(id); return &quot;redirect:admin_productImage_list?pid=&quot;+pi.getPid(); &#125; @RequestMapping(&quot;admin_productImage_list&quot;) public String list(int pid, Model model) &#123; Product p =productService.get(pid); List&lt;ProductImage&gt; pisSingle = productImageService.list(pid, ProductImageService.type_single); List&lt;ProductImage&gt; pisDetail = productImageService.list(pid, ProductImageService.type_detail); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pisSingle&quot;, pisSingle); model.addAttribute(&quot;pisDetail&quot;, pisDetail); return &quot;admin/listProductImage&quot;; &#125;&#125; 04 listProductImage.jsp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt; $(function()&#123; $(&quot;.addFormSingle&quot;).submit(function()&#123; if(checkEmpty(&quot;filepathSingle&quot;,&quot;图片文件&quot;))&#123; $(&quot;#filepathSingle&quot;).value(&quot;&quot;); return true; &#125; return false; &#125;); $(&quot;.addFormDetail&quot;).submit(function()&#123; if(checkEmpty(&quot;filepathDetail&quot;,&quot;图片文件&quot;)) return true; return false; &#125;); &#125;); &lt;/script&gt; &lt;title&gt;产品图片管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;p.category.id&#125;&quot;&gt;$&#123;p.category.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;$&#123;p.name&#125;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;产品图片管理&lt;/li&gt; &lt;/ol&gt; &lt;table class=&quot;addPictureTable&quot; align=&quot;center&quot;&gt; &lt;tr&gt; &lt;td class=&quot;addPictureTableTD&quot;&gt; &lt;div&gt; &lt;div class=&quot;panel panel-warning addPictureDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;b class=&quot;text-primary&quot;&gt; 单个 &lt;/b&gt;图片&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; class=&quot;addFormSingle&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;请选择本地图片 尺寸400X400 为佳&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt; &lt;input id=&quot;filepathSingle&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td align=&quot;center&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;type_single&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;$&#123;p.id&#125;&quot; /&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;产品单个图片缩略图&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;pisSingle&#125;&quot; var=&quot;pi&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt; &lt;td&gt; &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productSingle/$&#123;pi.id&#125;.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productSingle/$&#123;pi.id&#125;.jpg&quot;&gt;&lt;/a&gt; &lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_productImage_delete?id=$&#123;pi.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;/td&gt; &lt;td class=&quot;addPictureTableTD&quot;&gt; &lt;div&gt; &lt;div class=&quot;panel panel-warning addPictureDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增产品&lt;b class=&quot;text-primary&quot;&gt; 详情 &lt;/b&gt;图片&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; class=&quot;addFormDetail&quot; action=&quot;admin_productImage_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;请选择本地图片 宽度790 为佳&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt; &lt;input id=&quot;filepathDetail&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td align=&quot;center&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;type_detail&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;$&#123;p.id&#125;&quot; /&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;产品详情图片缩略图&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;pisDetail&#125;&quot; var=&quot;pi&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;pi.id&#125;&lt;/td&gt; &lt;td&gt; &lt;a title=&quot;点击查看原图&quot; href=&quot;img/productDetail/$&#123;pi.id&#125;.jpg&quot;&gt;&lt;img height=&quot;50px&quot; src=&quot;img/productDetail/$&#123;pi.id&#125;.jpg&quot;&gt;&lt;/a&gt; &lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_productImage_delete?id=$&#123;pi.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 05 Product回到产品管理，在产品列表页面，是没有图片的。 因为当时还没有产品图片管理功能，现在支持了，所以需要对Product做一些调整。 新增属性: 1private ProductImage firstProductImage; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108package com.how2java.tmall.pojo; import java.util.Date;import java.util.List; public class Product &#123; private Integer id; private String name; private String subTitle; private Float originalPrice; private Float promotePrice; private Integer stock; private Integer cid; private Date createDate; /*非数据库字段*/ private Category category; private ProductImage firstProductImage; public ProductImage getFirstProductImage() &#123; return firstProductImage; &#125; public void setFirstProductImage(ProductImage firstProductImage) &#123; this.firstProductImage = firstProductImage; &#125; public Category getCategory() &#123; return category; &#125; public void setCategory(Category category) &#123; this.category = category; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name == null ? null : name.trim(); &#125; public String getSubTitle() &#123; return subTitle; &#125; public void setSubTitle(String subTitle) &#123; this.subTitle = subTitle == null ? null : subTitle.trim(); &#125; public Float getOriginalPrice() &#123; return originalPrice; &#125; public void setOriginalPrice(Float originalPrice) &#123; this.originalPrice = originalPrice; &#125; public Float getPromotePrice() &#123; return promotePrice; &#125; public void setPromotePrice(Float promotePrice) &#123; this.promotePrice = promotePrice; &#125; public Integer getStock() &#123; return stock; &#125; public void setStock(Integer stock) &#123; this.stock = stock; &#125; public Integer getCid() &#123; return cid; &#125; public void setCid(Integer cid) &#123; this.cid = cid; &#125; public Date getCreateDate() &#123; return createDate; &#125; public void setCreateDate(Date createDate) &#123; this.createDate = createDate; &#125; &#125; 06 ProductService新增方法： 1void setFirstProductImage(Product p); 12345678910111213141516package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product; public interface ProductService &#123; void add(Product p); void delete(int id); void update(Product p); Product get(int id); List list(int cid); void setFirstProductImage(Product p); &#125; 07 ProductServiceImpl增加方法 setFirstProductImage(Product p)：根据pid和图片类型查询出所有的单个图片，然后把第一个取出来放在firstProductImage上。 增加方法 setFirstProductImage(List ps)给多个产品设置图片 在get方法中调用setFirstProductImage(Product p) 为单个产品设置图片在list方法中调用setFirstProductImage(List ps) 为多个产品设置图片 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.ProductMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.ProductExample;import com.how2java.tmall.pojo.ProductImage;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.service.ProductImageService;import com.how2java.tmall.service.ProductService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List;@Servicepublic class ProductServiceImpl implements ProductService &#123; @Autowired ProductMapper productMapper; @Autowired CategoryService categoryService; @Autowired ProductImageService productImageService; @Override public void add(Product p) &#123; productMapper.insert(p); &#125; @Override public void delete(int id) &#123; productMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Product p) &#123; productMapper.updateByPrimaryKeySelective(p); &#125; @Override public Product get(int id) &#123; Product p = productMapper.selectByPrimaryKey(id); setFirstProductImage(p); setCategory(p); return p; &#125; public void setCategory(List&lt;Product&gt; ps)&#123; for (Product p : ps) setCategory(p); &#125; public void setCategory(Product p)&#123; int cid = p.getCid(); Category c = categoryService.get(cid); p.setCategory(c); &#125; @Override public List list(int cid) &#123; ProductExample example = new ProductExample(); example.createCriteria().andCidEqualTo(cid); example.setOrderByClause(&quot;id desc&quot;); List result = productMapper.selectByExample(example); setCategory(result); setFirstProductImage(result); return result; &#125; @Override public void setFirstProductImage(Product p) &#123; List&lt;ProductImage&gt; pis = productImageService.list(p.getId(), ProductImageService.type_single); if (!pis.isEmpty()) &#123; ProductImage pi = pis.get(0); p.setFirstProductImage(pi); &#125; &#125; public void setFirstProductImage(List&lt;Product&gt; ps) &#123; for (Product p : ps) &#123; setFirstProductImage(p); &#125; &#125; &#125; 08 listProduct.jsp把注释去掉： 123&lt;c:if test=&quot;$&#123;!empty p.firstProductImage&#125;&quot;&gt; &lt;img width=&quot;40px&quot; src=&quot;img/productSingle/$&#123;p.firstProductImage.id&#125;.jpg&quot;&gt;&lt;/c:if&gt; 6.4 产品属性值设置01 PropertyValue为PropertyValue增加一个Property属性以及getter,setter 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.how2java.tmall.pojo; public class PropertyValue &#123; private Integer id; private Integer pid; private Integer ptid; private String value; /*非数据库字段*/ private Property property; public Property getProperty() &#123; return property; &#125; public void setProperty(Property property) &#123; this.property = property; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public Integer getPid() &#123; return pid; &#125; public void setPid(Integer pid) &#123; this.pid = pid; &#125; public Integer getPtid() &#123; return ptid; &#125; public void setPtid(Integer ptid) &#123; this.ptid = ptid; &#125; public String getValue() &#123; return value; &#125; public void setValue(String value) &#123; this.value = value == null ? null : value.trim(); &#125;&#125; 02 PropertyValueService1234567891011121314package com.how2java.tmall.service; import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.PropertyValue; import java.util.List; public interface PropertyValueService &#123; void init(Product p); void update(PropertyValue pv); PropertyValue get(int ptid, int pid); List&lt;PropertyValue&gt; list(int pid);&#125; 03 PropertyValueServiceImplPropertyValueServiceImpl实现了PropertyValueService： get(int ptid, int pid)根据属性id和产品id获取PropertyValue对象 list(int pid)根据产品id获取所有的属性值 init方法3.1 这个方法的作用是初始化PropertyValue。 为什么要初始化呢？ 因为对于PropertyValue的管理，没有增加，只有修改。 所以需要通过初始化来进行自动地增加，以便于后面的修改。3.2 首先根据产品获取分类，然后获取这个分类下的所有属性集合3.3 然后用属性和id产品id去查询，看看这个属性和这个产品，是否已经存在属性值了。3.4 如果不存在，那么就创建一个属性值，并设置其属性和产品，接着插入到数据库中。这样就完成了属性值的初始化。 update（PropertyValue pv)更新 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.PropertyValueMapper;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.Property;import com.how2java.tmall.pojo.PropertyValue;import com.how2java.tmall.pojo.PropertyValueExample;import com.how2java.tmall.service.PropertyService;import com.how2java.tmall.service.PropertyValueService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class PropertyValueServiceImpl implements PropertyValueService &#123; @Autowired PropertyValueMapper propertyValueMapper; @Autowired PropertyService propertyService; @Override public void init(Product p) &#123; List&lt;Property&gt; pts = propertyService.list(p.getCid()); for (Property pt: pts) &#123; PropertyValue pv = get(pt.getId(),p.getId()); if(null==pv)&#123; pv = new PropertyValue(); pv.setPid(p.getId()); pv.setPtid(pt.getId()); propertyValueMapper.insert(pv); &#125; &#125; &#125; @Override public void update(PropertyValue pv) &#123; propertyValueMapper.updateByPrimaryKeySelective(pv); &#125; @Override public PropertyValue get(int ptid, int pid) &#123; PropertyValueExample example = new PropertyValueExample(); example.createCriteria().andPtidEqualTo(ptid).andPidEqualTo(pid); List&lt;PropertyValue&gt; pvs= propertyValueMapper.selectByExample(example); if (pvs.isEmpty()) return null; return pvs.get(0); &#125; @Override public List&lt;PropertyValue&gt; list(int pid) &#123; PropertyValueExample example = new PropertyValueExample(); example.createCriteria().andPidEqualTo(pid); List&lt;PropertyValue&gt; result = propertyValueMapper.selectByExample(example); for (PropertyValue pv : result) &#123; Property property = propertyService.get(pv.getPtid()); pv.setProperty(property); &#125; return result; &#125;&#125; 04 PropertyValueController123456789101112131415161718192021222324252627282930313233343536373839package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Product;import com.how2java.tmall.pojo.PropertyValue;import com.how2java.tmall.service.ProductService;import com.how2java.tmall.service.PropertyValueService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody; import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class PropertyValueController &#123; @Autowired PropertyValueService propertyValueService; @Autowired ProductService productService; @RequestMapping(&quot;admin_propertyValue_edit&quot;) public String edit(Model model,int pid) &#123; Product p = productService.get(pid); propertyValueService.init(p); List&lt;PropertyValue&gt; pvs = propertyValueService.list(p.getId()); model.addAttribute(&quot;p&quot;, p); model.addAttribute(&quot;pvs&quot;, pvs); return &quot;admin/editPropertyValue&quot;; &#125; @RequestMapping(&quot;admin_propertyValue_update&quot;) @ResponseBody public String update(PropertyValue pv) &#123; propertyValueService.update(pv); return &quot;success&quot;; &#125;&#125; 05 editPropertyValue.jsp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;title&gt;编辑产品属性值&lt;/title&gt; &lt;script&gt;$(function() &#123; $(&quot;input.pvValue&quot;).keyup(function()&#123; var value = $(this).val(); var page = &quot;admin_propertyValue_update&quot;; var pvid = $(this).attr(&quot;pvid&quot;); var parentSpan = $(this).parent(&quot;span&quot;); parentSpan.css(&quot;border&quot;,&quot;1px solid yellow&quot;); $.post( page, &#123;&quot;value&quot;:value,&quot;id&quot;:pvid&#125;, function(result)&#123; if(&quot;success&quot;==result) parentSpan.css(&quot;border&quot;,&quot;1px solid green&quot;); else parentSpan.css(&quot;border&quot;,&quot;1px solid red&quot;); &#125; ); &#125;);&#125;);&lt;/script&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;p.category.id&#125;&quot;&gt;$&#123;p.category.name&#125;&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;$&#123;p.name&#125;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;编辑产品属性&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;editPVDiv&quot;&gt; &lt;c:forEach items=&quot;$&#123;pvs&#125;&quot; var=&quot;pv&quot;&gt; &lt;div class=&quot;eachPV&quot;&gt; &lt;span class=&quot;pvName&quot; &gt;$&#123;pv.property.name&#125;&lt;/span&gt; &lt;span class=&quot;pvValue&quot;&gt;&lt;input class=&quot;pvValue&quot; pvid=&quot;$&#123;pv.id&#125;&quot; type=&quot;text&quot; value=&quot;$&#123;pv.value&#125;&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; 6.5 用户管理01 UserUser使用自动生成的，没变化 02 UserService新增接口UserService，提供CRUD一套 12345678910111213package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.User; public interface UserService &#123; void add(User c); void delete(int id); void update(User c); User get(int id); List list();&#125; 03 UserServiceImpl新建类UserServiceImpl，提供CURD一套 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.UserMapper;import com.how2java.tmall.pojo.User;import com.how2java.tmall.pojo.UserExample;import com.how2java.tmall.service.UserService; @Servicepublic class UserServiceImpl implements UserService &#123; @Autowired UserMapper userMapper; @Override public void add(User u) &#123; userMapper.insert(u); &#125; @Override public void delete(int id) &#123; userMapper.deleteByPrimaryKey(id); &#125; @Override public void update(User u) &#123; userMapper.updateByPrimaryKeySelective(u); &#125; @Override public User get(int id) &#123; return userMapper.selectByPrimaryKey(id); &#125; public List&lt;User&gt; list()&#123; UserExample example =new UserExample(); example.setOrderByClause(&quot;id desc&quot;); return userMapper.selectByExample(example); &#125; &#125; 04 UserController新建UserController类，提供分页查询 12345678910111213141516171819202122232425262728293031323334353637package com.how2java.tmall.controller; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.UserService;import com.how2java.tmall.util.Page; @Controller@RequestMapping(&quot;&quot;)public class UserController &#123; @Autowired UserService userService; @RequestMapping(&quot;admin_user_list&quot;) public String list(Model model, Page page)&#123; PageHelper.offsetPage(page.getStart(),page.getCount()); List&lt;User&gt; us= userService.list(); int total = (int) new PageInfo&lt;&gt;(us).getTotal(); page.setTotal(total); model.addAttribute(&quot;us&quot;, us); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listUser&quot;; &#125; &#125; 05 listUser.jsplistUser.jsp页面 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt;&lt;/script&gt; &lt;title&gt;用户管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;h1 class=&quot;label label-info&quot; &gt;用户管理&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;用户名称&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;us&#125;&quot; var=&quot;u&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;u.id&#125;&lt;/td&gt; &lt;td&gt;$&#123;u.name&#125;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt; &lt;/div&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 6.6 订单管理01 OrderItemOrderItem在自动创建的基础上增加了一个product属性。 因为在订单管理页面需要看到订单下面的订单项里的产品图片。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.how2java.tmall.pojo; public class OrderItem &#123; private Integer id; private Integer pid; private Integer oid; private Integer uid; private Integer number; /*非数据库字段*/ private Product product; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public Integer getPid() &#123; return pid; &#125; public void setPid(Integer pid) &#123; this.pid = pid; &#125; public Integer getOid() &#123; return oid; &#125; public void setOid(Integer oid) &#123; this.oid = oid; &#125; public Integer getUid() &#123; return uid; &#125; public void setUid(Integer uid) &#123; this.uid = uid; &#125; public Integer getNumber() &#123; return number; &#125; public void setNumber(Integer number) &#123; this.number = number; &#125; public Product getProduct() &#123; return product; &#125; public void setProduct(Product product) &#123; this.product = product; &#125;&#125; 02 Order.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213package com.how2java.tmall.pojo; import com.how2java.tmall.service.OrderService; import java.util.Date;import java.util.List; public class Order &#123; private Integer id; private String orderCode; private String address; private String post; private String receiver; private String mobile; private String userMessage; private Date createDate; private Date payDate; private Date deliveryDate; private Date confirmDate; private Integer uid; private String status; /*如下是非数据库字段*/ //该订单下的订单项列表 private List&lt;OrderItem&gt; orderItems; //该订单对应的用户 private User user; //该订单的总计金额 private float total; //该订单的总计数量 private int totalNumber; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getOrderCode() &#123; return orderCode; &#125; public void setOrderCode(String orderCode) &#123; this.orderCode = orderCode == null ? null : orderCode.trim(); &#125; public String getAddress() &#123; return address; &#125; public void setAddress(String address) &#123; this.address = address == null ? null : address.trim(); &#125; public String getPost() &#123; return post; &#125; public void setPost(String post) &#123; this.post = post == null ? null : post.trim(); &#125; public String getReceiver() &#123; return receiver; &#125; public void setReceiver(String receiver) &#123; this.receiver = receiver == null ? null : receiver.trim(); &#125; public String getMobile() &#123; return mobile; &#125; public void setMobile(String mobile) &#123; this.mobile = mobile == null ? null : mobile.trim(); &#125; public String getUserMessage() &#123; return userMessage; &#125; public void setUserMessage(String userMessage) &#123; this.userMessage = userMessage == null ? null : userMessage.trim(); &#125; public Date getCreateDate() &#123; return createDate; &#125; public void setCreateDate(Date createDate) &#123; this.createDate = createDate; &#125; public Date getPayDate() &#123; return payDate; &#125; public void setPayDate(Date payDate) &#123; this.payDate = payDate; &#125; public Date getDeliveryDate() &#123; return deliveryDate; &#125; public void setDeliveryDate(Date deliveryDate) &#123; this.deliveryDate = deliveryDate; &#125; public Date getConfirmDate() &#123; return confirmDate; &#125; public void setConfirmDate(Date confirmDate) &#123; this.confirmDate = confirmDate; &#125; public Integer getUid() &#123; return uid; &#125; public void setUid(Integer uid) &#123; this.uid = uid; &#125; public String getStatus() &#123; return status; &#125; public void setStatus(String status) &#123; this.status = status == null ? null : status.trim(); &#125; public List&lt;OrderItem&gt; getOrderItems() &#123; return orderItems; &#125; public void setOrderItems(List&lt;OrderItem&gt; orderItems) &#123; this.orderItems = orderItems; &#125; public static void main(String args[])&#123; Order o = new Order(); o.setStatus(OrderService.delete); System.out.println(o.getStatusDesc()); &#125; //getStatusDesc方法，用于把英文表达的Status信息转换为中文 public String getStatusDesc()&#123; String desc =&quot;未知&quot;; switch(status)&#123; case OrderService.waitPay: desc=&quot;待付款&quot;; break; case OrderService.waitDelivery: desc=&quot;待发货&quot;; break; case OrderService.waitConfirm: desc=&quot;待收货&quot;; break; case OrderService.waitReview: desc=&quot;等评价&quot;; break; case OrderService.finish: desc=&quot;完成&quot;; break; case OrderService.delete: desc=&quot;刪除&quot;; break; default: desc=&quot;未知&quot;; &#125; return desc; &#125; public float getTotal() &#123; return total; &#125; public void setTotal(float total) &#123; this.total = total; &#125; public int getTotalNumber() &#123; return totalNumber; &#125; public void setTotalNumber(int totalNumber) &#123; this.totalNumber = totalNumber; &#125; public User getUser() &#123; return user; &#125; public void setUser(User user) &#123; this.user = user; &#125;&#125; 03 OrderItemService新建OrderItemService，声明CRUD一套，以及fill(Order order) 和fill(List orders) 123456789101112131415161718192021package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem; public interface OrderItemService &#123; void add(OrderItem c); void delete(int id); void update(OrderItem c); OrderItem get(int id); List list(); void fill(List&lt;Order&gt; os); void fill(Order o); &#125; 04 OrderItemServiceImplOrderItemServiceImpl实现OrderItemService，提供CRUD一套方法的实现。 同时还提供fill(Order order)和fill(List orders), 先说fill(Order order) :为什么要提供这个方法呢？ 因为在订单管理界面，首先是遍历多个订单，然后遍历这个订单下的多个订单项。 而由MybatisGenerator逆向工程所创建的一套自动生成代码，是不具备一对多关系的，需要自己去二次开发。 这里就是做订单与订单项的一对多关系。在fill(Order order)中： 根据订单id查询出其对应的所有订单项 通过setProduct为所有的订单项设置Product属性 遍历所有的订单项，然后计算出该订单的总金额和总数量 最后再把订单项设置在订单的orderItems属性上。 在fill(List orders) 中，就是遍历每个订单，然后挨个调用fill(Order order)。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.OrderItemMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderItem;import com.how2java.tmall.pojo.OrderItemExample;import com.how2java.tmall.pojo.Product;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.ProductService; @Servicepublic class OrderItemServiceImpl implements OrderItemService &#123; @Autowired OrderItemMapper orderItemMapper; @Autowired ProductService productService; @Override public void add(OrderItem c) &#123; orderItemMapper.insert(c); &#125; @Override public void delete(int id) &#123; orderItemMapper.deleteByPrimaryKey(id); &#125; @Override public void update(OrderItem c) &#123; orderItemMapper.updateByPrimaryKeySelective(c); &#125; @Override public OrderItem get(int id) &#123; OrderItem result = orderItemMapper.selectByPrimaryKey(id); setProduct(result); return result; &#125; public List&lt;OrderItem&gt; list()&#123; OrderItemExample example =new OrderItemExample(); example.setOrderByClause(&quot;id desc&quot;); return orderItemMapper.selectByExample(example); &#125; @Override public void fill(List&lt;Order&gt; os) &#123; for (Order o : os) &#123; fill(o); &#125; &#125; public void fill(Order o) &#123; OrderItemExample example =new OrderItemExample(); example.createCriteria().andOidEqualTo(o.getId()); example.setOrderByClause(&quot;id desc&quot;); List&lt;OrderItem&gt; ois =orderItemMapper.selectByExample(example); setProduct(ois); float total = 0; int totalNumber = 0; for (OrderItem oi : ois) &#123; total+=oi.getNumber()*oi.getProduct().getPromotePrice(); totalNumber+=oi.getNumber(); &#125; o.setTotal(total); o.setTotalNumber(totalNumber); o.setOrderItems(ois); &#125; public void setProduct(List&lt;OrderItem&gt; ois)&#123; for (OrderItem oi: ois) &#123; setProduct(oi); &#125; &#125; private void setProduct(OrderItem oi) &#123; Product p = productService.get(oi.getPid()); oi.setProduct(p); &#125;&#125; 05 OrderService创建OrderService,提供CRUD一套，并提供订单状态的常量值 12345678910111213141516171819202122package com.how2java.tmall.service; import java.util.List; import com.how2java.tmall.pojo.Order; public interface OrderService &#123; String waitPay = &quot;waitPay&quot;; String waitDelivery = &quot;waitDelivery&quot;; String waitConfirm = &quot;waitConfirm&quot;; String waitReview = &quot;waitReview&quot;; String finish = &quot;finish&quot;; String delete = &quot;delete&quot;; void add(Order c); void delete(int id); void update(Order c); Order get(int id); List list();&#125; 06 OrderServiceImpl创建OrderServiceImpl ，实现CRUD一套方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package com.how2java.tmall.service.impl; import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import com.how2java.tmall.mapper.OrderMapper;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.pojo.OrderExample;import com.how2java.tmall.pojo.User;import com.how2java.tmall.service.OrderService;import com.how2java.tmall.service.UserService; @Servicepublic class OrderServiceImpl implements OrderService &#123; @Autowired OrderMapper orderMapper; @Autowired UserService userService; @Override public void add(Order c) &#123; orderMapper.insert(c); &#125; @Override public void delete(int id) &#123; orderMapper.deleteByPrimaryKey(id); &#125; @Override public void update(Order c) &#123; orderMapper.updateByPrimaryKeySelective(c); &#125; @Override public Order get(int id) &#123; return orderMapper.selectByPrimaryKey(id); &#125; public List&lt;Order&gt; list()&#123; OrderExample example =new OrderExample(); example.setOrderByClause(&quot;id desc&quot;); List&lt;Order&gt; result =orderMapper.selectByExample(example); setUser(result); return result; &#125; public void setUser(List&lt;Order&gt; os)&#123; for (Order o : os) setUser(o); &#125; public void setUser(Order o)&#123; int uid = o.getUid(); User u = userService.get(uid); o.setUser(u); &#125; &#125; 07 OrderController.java因为订单的增加和删除，都是在前台进行的。 所以OrderController提供的是list方法和delivery(发货)方法 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.how2java.tmall.controller; import java.io.IOException;import java.util.Date;import java.util.List; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.how2java.tmall.pojo.Order;import com.how2java.tmall.service.OrderItemService;import com.how2java.tmall.service.OrderService;import com.how2java.tmall.util.Page; @Controller@RequestMapping(&quot;&quot;)public class OrderController &#123; @Autowired OrderService orderService; @Autowired OrderItemService orderItemService; @RequestMapping(&quot;admin_order_list&quot;) public String list(Model model, Page page)&#123; PageHelper.offsetPage(page.getStart(),page.getCount()); List&lt;Order&gt; os= orderService.list(); int total = (int) new PageInfo&lt;&gt;(os).getTotal(); page.setTotal(total); orderItemService.fill(os); model.addAttribute(&quot;os&quot;, os); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listOrder&quot;; &#125; @RequestMapping(&quot;admin_order_delivery&quot;) public String delivery(Order o) throws IOException &#123; o.setDeliveryDate(new Date()); o.setStatus(OrderService.waitConfirm); orderService.update(o); return &quot;redirect:admin_order_list&quot;; &#125;&#125; 08 listOrder.jsp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt; $(function()&#123; $(&quot;button.orderPageCheckOrderItems&quot;).click(function()&#123; var oid = $(this).attr(&quot;oid&quot;); $(&quot;tr.orderPageOrderItemTR[oid=&quot;+oid+&quot;]&quot;).toggle(); &#125;); &#125;); &lt;/script&gt; &lt;title&gt;订单管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;h1 class=&quot;label label-info&quot; &gt;订单管理&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover1 table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;状态&lt;/th&gt; &lt;th&gt;金额&lt;/th&gt; &lt;th width=&quot;100px&quot;&gt;商品数量&lt;/th&gt; &lt;th width=&quot;100px&quot;&gt;买家名称&lt;/th&gt; &lt;th&gt;创建时间&lt;/th&gt; &lt;th&gt;支付时间&lt;/th&gt; &lt;th&gt;发货时间&lt;/th&gt; &lt;th&gt;确认收货时间&lt;/th&gt; &lt;th width=&quot;120px&quot;&gt;操作&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;os&#125;&quot; var=&quot;o&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;o.id&#125;&lt;/td&gt; &lt;td&gt;$&#123;o.statusDesc&#125;&lt;/td&gt; &lt;td&gt;￥&lt;fmt:formatNumber type=&quot;number&quot; value=&quot;$&#123;o.total&#125;&quot; minFractionDigits=&quot;2&quot;/&gt;&lt;/td&gt; &lt;td align=&quot;center&quot;&gt;$&#123;o.totalNumber&#125;&lt;/td&gt; &lt;td align=&quot;center&quot;&gt;$&#123;o.user.name&#125;&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;o.createDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;o.payDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;o.deliveryDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;o.confirmDate&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt; &lt;td&gt; &lt;button oid=$&#123;o.id&#125; class=&quot;orderPageCheckOrderItems btn btn-primary btn-xs&quot;&gt;查看详情&lt;/button&gt; &lt;c:if test=&quot;$&#123;o.status==&#x27;waitDelivery&#x27;&#125;&quot;&gt; &lt;a href=&quot;admin_order_delivery?id=$&#123;o.id&#125;&quot;&gt; &lt;button class=&quot;btn btn-primary btn-xs&quot;&gt;发货&lt;/button&gt; &lt;/a&gt; &lt;/c:if&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;orderPageOrderItemTR&quot; oid=$&#123;o.id&#125;&gt; &lt;td colspan=&quot;10&quot; align=&quot;center&quot;&gt; &lt;div class=&quot;orderPageOrderItem&quot;&gt; &lt;table width=&quot;800px&quot; align=&quot;center&quot; class=&quot;orderPageOrderItemTable&quot;&gt; &lt;c:forEach items=&quot;$&#123;o.orderItems&#125;&quot; var=&quot;oi&quot;&gt; &lt;tr&gt; &lt;td align=&quot;left&quot;&gt; &lt;img width=&quot;40px&quot; height=&quot;40px&quot; src=&quot;img/productSingle/$&#123;oi.product.firstProductImage.id&#125;.jpg&quot;&gt; &lt;/td&gt; &lt;td&gt; &lt;a href=&quot;foreproduct?pid=$&#123;oi.product.id&#125;&quot;&gt; &lt;span&gt;$&#123;oi.product.name&#125;&lt;/span&gt; &lt;/a&gt; &lt;/td&gt; &lt;td align=&quot;right&quot;&gt; &lt;span class=&quot;text-muted&quot;&gt;$&#123;oi.number&#125;个&lt;/span&gt; &lt;/td&gt; &lt;td align=&quot;right&quot;&gt; &lt;span class=&quot;text-muted&quot;&gt;单价：￥$&#123;oi.product.promotePrice&#125;&lt;/span&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/table&gt; &lt;/div&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;%@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt; &lt;/div&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt;","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目04","date":"2020-08-30T11:30:30.000Z","path":"2020/08/30/电商网站的SSM项目04/","text":"5 重构5.1 概述分类管理中的CategoryMapper.xml使用很直接的SQL语句开发出来，这样的好处是简单易懂，便于理解。可是，随着本项目功能的展开和复杂度的提升，使用这种直接的SQL语句方式的开发效率较低，需要自己手动写每一个SQL语句，而且其维护起来也比较麻烦。所以在理解和消化了分类管理的基础上，做进一步的改进，主要是在分页方式和逆向工程方面做了重构。 1分页方式目前的分页方式是自己写分页对应的limit SQL语句，并且提供一个获取总数的count(*) SQL。 不仅如此, mapper, service, service.impl 里都要提供两个方法：list(Page page), count() 分类是这么做的，后续其他所有的实体类要做分页管理的时候都要这么做，所以为了提高开发效率，把目前的分页方式改为使用 pageHelper分页插件来实现。 PageHelper也相当于物理分页。即数据库自带的分页，如mysql是limit。 PageHelper本质也是数据库查询。 因为是第三方插件，所以需要额外的jar包：pagehelper-5.1.0-beta2.jar，jsqlparser-1.0.jar 在mybatis-config.xml中，添加以下代码，表示开启PageHelper插件 1234&lt;plugins&gt; &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt; &lt;/plugin&gt; &lt;/plugins&gt; 123PageHelper.offsetPage(0, 5); //表示查出第一页的数据，每页5条PageInfo page= new PageInfo&lt;&gt;(cs); //可以获取分页信息，包括总数以及其他的信息 2 逆向工程MyBatis是当前主流的Java持久层框架之一，与Hibernate一样，也是一种ORM框架 目前分类管理中Mybatis中相关类都是自己手动编写的，包括：Category.java, CategoryMapper.java和CategoryMapper.xml。 尤其是CategoryMapper.xml里面主要是SQL语句，可以预见在接下来的开发任务中，随着业务逻辑的越来越复杂，SQL语句也会越来越复杂，进而导致开发速度降低，出错率增加，维护成本上升等问题。 为了解决手动编写SQL语句效率低这个问题，对Mybatis部分的代码，使用逆向工程进行重构。 所谓的逆向工程，就是在已经存在的数据库表结构基础上，通过工具，自动生成Category.java, CategoryMapper.java和CategoryMapper.xml。 5.2 分页方式重构01 CategoryMapper.xml 去掉total SQL语句 修改list SQL语句，去掉其中的limit 12345678910111213141516171819202122232425&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt; select * from category order by id desc &lt;/select&gt; &lt;insert id=&quot;add&quot; keyProperty=&quot;id&quot; useGeneratedKeys=&quot;true&quot; parameterType=&quot;Category&quot; &gt; insert into category ( name ) values (#&#123;name&#125;) &lt;/insert&gt; &lt;delete id=&quot;delete&quot;&gt; delete from category where id= #&#123;id&#125; &lt;/delete&gt; &lt;select id=&quot;get&quot; resultType=&quot;Category&quot;&gt; select * from category where id= #&#123;id&#125; &lt;/select&gt; &lt;update id=&quot;update&quot; parameterType=&quot;Category&quot; &gt; update category set name=#&#123;name&#125; where id=#&#123;id&#125; &lt;/update&gt;&lt;/mapper&gt; 02 CategoryMapper 去掉total()方法 去掉list(Page page)方法 新增list() 方法 1234567891011121314151617package com.how2java.tmall.mapper; import com.how2java.tmall.pojo.Category; import java.util.List; public interface CategoryMapper &#123; List&lt;Category&gt; list(); void add(Category category); void delete(int id); Category get(int id); void update(Category category);&#125; 03 CategoryService 去掉total()方法 去掉list(Page page)方法 新增list() 方法 12345678910111213141516package com.how2java.tmall.service; import com.how2java.tmall.pojo.Category;import java.util.List; public interface CategoryService&#123; List&lt;Category&gt; list(); void add(Category category); void delete(int id); Category get(int id); void update(Category category);&#125; 04 CategoryServiceImpl 去掉total()方法 去掉list(Page page)方法 新增list() 方法 12345678910111213141516171819202122232425262728293031323334353637383940package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list() &#123; return categoryMapper.list(); &#125; @Override public void add(Category category) &#123; categoryMapper.add(category); &#125; @Override public void delete(int id) &#123; categoryMapper.delete(id); &#125; @Override public Category get(int id) &#123; return categoryMapper.get(id); &#125; @Override public void update(Category category) &#123; categoryMapper.update(category); &#125;&#125; 05 CategoryController1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package com.how2java.tmall.controller; import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.util.ImageUtil;import com.how2java.tmall.util.Page;import com.how2java.tmall.util.UploadedImageFile;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.multipart.MultipartFile; import javax.imageio.ImageIO;import javax.servlet.http.HttpSession;import java.awt.image.BufferedImage;import java.io.File;import java.io.IOException;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class CategoryController &#123; @Autowired CategoryService categoryService; @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model,Page page)&#123; //通过分页插件指定分页参数 PageHelper.offsetPage(page.getStart(),page.getCount()); List&lt;Category&gt; cs= categoryService.list(); //调用list() 获取对应分页的数据 int total = (int) new PageInfo&lt;&gt;(cs).getTotal();//通过PageInfo获取总数 page.setTotal(total); model.addAttribute(&quot;cs&quot;, cs); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listCategory&quot;; &#125; @RequestMapping(&quot;admin_category_add&quot;) public String add(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; categoryService.add(c); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); if(!file.getParentFile().exists()) file.getParentFile().mkdirs(); uploadedImageFile.getImage().transferTo(file); BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); return &quot;redirect:/admin_category_list&quot;; &#125; @RequestMapping(&quot;admin_category_delete&quot;) public String delete(int id,HttpSession session) throws IOException &#123; categoryService.delete(id); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,id+&quot;.jpg&quot;); file.delete(); return &quot;redirect:/admin_category_list&quot;; &#125; @RequestMapping(&quot;admin_category_edit&quot;) public String edit(int id,Model model) throws IOException &#123; Category c= categoryService.get(id); model.addAttribute(&quot;c&quot;, c); return &quot;admin/editCategory&quot;; &#125; @RequestMapping(&quot;admin_category_update&quot;) public String update(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; categoryService.update(c); MultipartFile image = uploadedImageFile.getImage(); if(null!=image &amp;&amp;!image.isEmpty())&#123; File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); image.transferTo(file); BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); &#125; return &quot;redirect:/admin_category_list&quot;; &#125; &#125; 06 applicationContext.xml之前是注释掉的，现在释放出来 12345678910&lt;property name=&quot;plugins&quot;&gt; &lt;array&gt; &lt;bean class=&quot;com.github.pagehelper.PageInterceptor&quot;&gt; &lt;property name=&quot;properties&quot;&gt; &lt;value&gt; &lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/array&gt; &lt;/property&gt; 5.3 分类的逆向工程数据库版本是 MySQL5.5 逆向工程，就是在已经存在的数据库表结构基础上，通过工具，自动生成Category.java, CategoryMapper.java和CategoryMapper.xml。 01 OverIsMergeablePluginMybatis Generator是一个用于Mybatis逆向工程的工具。 MybatisGenerator插件是Mybatis官方提供的，这个插件存在一个固有的Bug，即当第一次生成了CategoryMapper.xml之后，再次运行会导致CategoryMapper.xml生成重复内容，而影响正常的运行。 需要自己写**(copy,paste)一个小插件类OverIsMergeablePlugin** 123456789101112131415161718192021222324252627package com.how2java.tmall.util; import org.mybatis.generator.api.GeneratedXmlFile;import org.mybatis.generator.api.IntrospectedTable;import org.mybatis.generator.api.PluginAdapter; import java.lang.reflect.Field;import java.util.List; public class OverIsMergeablePlugin extends PluginAdapter &#123; @Override public boolean validate(List&lt;String&gt; warnings) &#123; return true; &#125; @Override public boolean sqlMapGenerated(GeneratedXmlFile sqlMap, IntrospectedTable introspectedTable) &#123; try &#123; Field field = sqlMap.getClass().getDeclaredField(&quot;isMergeable&quot;); field.setAccessible(true); field.setBoolean(sqlMap, false); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return true; &#125;&#125; 02 generatorConfig.xml在resouces下创建generatorConfig.xml文件，其目的就是为了正确使用本插件而提供必要的配置信息 使用OverIsMergeablePlugin插件 1&lt;plugin type=&quot;com.how2java.tmall.util.OverIsMergeablePlugin&quot; /&gt; 在生成的代码中，不提供注释,如果提供注释，生成出来的代码，看上去乱七八糟的。 1&lt;commentGenerator&gt; 指定链接数据库 1&lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost/tmall_ssm&quot; userId=&quot;root&quot; password=&quot;admin&quot;&gt; 的账号和密码，逆向工程，首先要链接到数据库 指定生成的pojo,mapper, xml文件的存放位置 生成对应表及类名，目前只开放了category表，其他表都注释掉了。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;&lt;generatorConfiguration&gt; &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt; &lt;!--避免生成重复代码的插件--&gt; &lt;plugin type=&quot;com.how2java.tmall.util.OverIsMergeablePlugin&quot; /&gt; &lt;!--是否在代码中显示注释--&gt; &lt;commentGenerator&gt; &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot; /&gt; &lt;/commentGenerator&gt; &lt;!--数据库链接地址账号密码--&gt; &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost/tmall_ssm&quot; userId=&quot;root&quot; password=&quot;admin&quot;&gt; &lt;/jdbcConnection&gt; &lt;!--不知道做什么用的。。。反正贴上来了~--&gt; &lt;javaTypeResolver&gt; &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt; &lt;/javaTypeResolver&gt; &lt;!--生成pojo类存放位置--&gt; &lt;javaModelGenerator targetPackage=&quot;com.how2java.tmall.pojo&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt; &lt;/javaModelGenerator&gt; &lt;!--生成xml映射文件存放位置--&gt; &lt;sqlMapGenerator targetPackage=&quot;mapper&quot; targetProject=&quot;src/main/resources&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;/sqlMapGenerator&gt; &lt;!--生成mapper类存放位置--&gt; &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.how2java.tmall.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;/javaClientGenerator&gt; &lt;!--生成对应表及类名--&gt; &lt;table tableName=&quot;category&quot; domainObjectName=&quot;Category&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;!-- &lt;table tableName=&quot;property&quot; domainObjectName=&quot;Property&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;product&quot; domainObjectName=&quot;Product&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;productImage&quot; domainObjectName=&quot;ProductImage&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;order_&quot; domainObjectName=&quot;Order&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;propertyValue&quot; domainObjectName=&quot;PropertyValue&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;review&quot; domainObjectName=&quot;Review&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;user&quot; domainObjectName=&quot;User&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;orderItem&quot; domainObjectName=&quot;OrderItem&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; --&gt; &lt;/context&gt;&lt;/generatorConfiguration&gt; 03 MybatisGenerator运行即生成pojo.mapper和xml 生成代码成功，只能执行一次，以后执行会覆盖掉mapper,pojo,xml 等文件上做的修改。 必须把today变量修改为今天才可以执行，这样明天再执行就无法运行了，以免以后对Category类做了改动，不小心运行了MybatisGenerator 导致Category类上做的手动改动被覆盖掉了。 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.how2java.tmall.util; import org.mybatis.generator.api.MyBatisGenerator;import org.mybatis.generator.config.Configuration;import org.mybatis.generator.config.xml.ConfigurationParser;import org.mybatis.generator.internal.DefaultShellCallback; import java.io.InputStream;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Date;import java.util.List; public class MybatisGenerator &#123; public static void main(String[] args) throws Exception &#123; String today = &quot;2020-09-09&quot;; SimpleDateFormat sdf =new SimpleDateFormat(&quot;yyyy-MM-dd&quot;); Date now =sdf.parse(today); Date d = new Date(); if(d.getTime()&gt;now.getTime()+1000*60*60*24)&#123; System.err.println(&quot;——————未成成功运行——————&quot;); System.err.println(&quot;——————未成成功运行——————&quot;); System.err.println(&quot;本程序具有破坏作用，应该只运行一次，如果必须要再运行，需要修改today变量为今天，如:&quot; + sdf.format(new Date())); return; &#125; if(false) return; List&lt;String&gt; warnings = new ArrayList&lt;String&gt;(); boolean overwrite = true; InputStream is= MybatisGenerator.class.getClassLoader().getResource(&quot;generatorConfig.xml&quot;).openStream(); ConfigurationParser cp = new ConfigurationParser(warnings); Configuration config = cp.parseConfiguration(is); is.close(); DefaultShellCallback callback = new DefaultShellCallback(overwrite); MyBatisGenerator myBatisGenerator = new MyBatisGenerator(config, callback, warnings); myBatisGenerator.generate(null); System.out.println(&quot;生成代码成功，只能执行一次，以后执行会覆盖掉mapper,pojo,xml 等文件上做的修改&quot;); &#125;&#125; 运行MybatisGenerator， 自动生成Category, 插件自动生成的代码 自动生成的CategoryExample ( 它的作用是进行排序，条件查询的时候使用) 自动生成CategoryMapper.xml 插件自动生成的xml，与手动写的也差不了多少，主要区别在于提供了一个 id=”Example_Where_Clause”的SQL，借助这个可以进行多条件查询。 自动生成CategoryMapper 与手动编写的CategoryMapper比起来，CategoryMapper也是提供CURD一套，不过方法名发生了变化，比如：delete叫做deleteByPrimaryKey,update叫做updateByPrimaryKey.除此之外，修改还提供了一个updateByPrimaryKeySelective，其作用是只修改变化了的字段，未变化的字段就不修改了 查询list,变成了selectByExample(CategoryExample example); CategoryService没变化 CategoryController没变化 04 修改CategoryServiceImpl原先手动编写的： 12345678910111213141516171819202122232425262728293031323334353637package com.how2java.tmall.service.impl;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.util.Page;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.List;//注解@Service声明当前类是一个Service业务类@Servicepublic class CategoryServiceImpl implements CategoryService&#123; //通过自动装配@Autowired引入CategoryMapper,在list方法中调用CategoryMapper 的list方法 @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list() &#123; return categoryMapper.list(); &#125; @Override public void add(Category category) &#123; categoryMapper.add(category); &#125; @Override public void delete(int id) &#123; categoryMapper.delete(id); &#125; @Override public Category get(int id) &#123; return categoryMapper.get(id); &#125; @Override public void update(Category category) &#123; categoryMapper.update(category); &#125;&#125; 因为CategoryMapper的方法名发生了变化，所以CategoryServiceImpl要做相应的调整。 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.how2java.tmall.service.impl; import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.pojo.CategoryExample;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list() &#123; CategoryExample example =new CategoryExample(); example.setOrderByClause(&quot;id desc&quot;); return categoryMapper.selectByExample(example); //传递一个example对象，这个对象指定按照id倒排序来查询 &#125; @Override public void add(Category category) &#123; categoryMapper.insert(category); &#125; @Override public void delete(int id) &#123; categoryMapper.deleteByPrimaryKey(id); &#125; @Override public Category get(int id) &#123; return categoryMapper.selectByPrimaryKey(id); &#125; @Override public void update(Category category) &#123; categoryMapper.updateByPrimaryKeySelective(category); &#125;&#125; 修改之后，分类的pojo,xml.mapper都不用自己手动编写，大大提高了生产效率。 5.4 所有的逆向工程把其余所有的实体类，example类，mapper和xml都生成。为什么呢？ 因为随着业务的推进，需要对实体类进行修改，而修改之后，再通过插件创建的话，会覆盖掉实体类中的修改的。 所以干脆一口气把其余所有的实体类都生成 01 修改generatorConfig.xml修改generatorConfig.xml，把所有的table都释放出来 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;&lt;generatorConfiguration&gt; &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt; &lt;!--避免生成重复代码的插件--&gt; &lt;plugin type=&quot;com.how2java.tmall.util.OverIsMergeablePlugin&quot; /&gt; &lt;!--是否在代码中显示注释--&gt; &lt;commentGenerator&gt; &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot; /&gt; &lt;/commentGenerator&gt; &lt;!--数据库链接地址账号密码--&gt; &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost/tmall_ssm&quot; userId=&quot;root&quot; password=&quot;admin&quot;&gt; &lt;/jdbcConnection&gt; &lt;!--不知道做什么用的。。。反正贴上来了~--&gt; &lt;javaTypeResolver&gt; &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt; &lt;/javaTypeResolver&gt; &lt;!--生成pojo类存放位置--&gt; &lt;javaModelGenerator targetPackage=&quot;com.how2java.tmall.pojo&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt; &lt;/javaModelGenerator&gt; &lt;!--生成xml映射文件存放位置--&gt; &lt;sqlMapGenerator targetPackage=&quot;mapper&quot; targetProject=&quot;src/main/resources&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;/sqlMapGenerator&gt; &lt;!--生成mapper类存放位置--&gt; &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.how2java.tmall.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt; &lt;/javaClientGenerator&gt; &lt;!--生成对应表及类名--&gt; &lt;table tableName=&quot;category&quot; domainObjectName=&quot;Category&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;property&quot; domainObjectName=&quot;Property&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;product&quot; domainObjectName=&quot;Product&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;productImage&quot; domainObjectName=&quot;ProductImage&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;order_&quot; domainObjectName=&quot;Order&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;propertyValue&quot; domainObjectName=&quot;PropertyValue&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;review&quot; domainObjectName=&quot;Review&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;user&quot; domainObjectName=&quot;User&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;table tableName=&quot;orderItem&quot; domainObjectName=&quot;OrderItem&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;true&quot; selectByExampleQueryId=&quot;false&quot;&gt; &lt;property name=&quot;my.isgen.usekeys&quot; value=&quot;true&quot;/&gt; &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt; &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;JDBC&quot;/&gt; &lt;/table&gt; &lt;/context&gt;&lt;/generatorConfiguration&gt; 运行MybatisGenerator，today变量修改为今天 自动生成的生成的pojo和Example： 生成的Mapper类： xml文件：","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目03","date":"2020-08-20T14:12:30.000Z","path":"2020/08/20/电商网站的SSM项目03/","text":"4.3 创建项目4.3.1新建项目File–&gt;New Project新建项目 4.3.2选中maven webapp格式左边选中Maven –&gt; 勾选Create from archetype–&gt;选中 org.apache.maven.archetypes:maven-archetype-webapp–&gt; Next 4.3.3项目参数 *GroupId:com.how2java.tmall(名字随意) 4.3.4 Maven仓库Maven 是专门用于构建和管理Java项目的工具。 相同的项目结构 统一维护jar包 ​ 仓库是用于存放项目需要的jar包的​ maven采用一个仓库，多个项目的方式，让多个项目共享一个仓库里的相同jar包。 maven 本地仓库（Local repository) 的默认目录是：${user.home}/.m2/repository。 1C:\\Users\\hk199\\.m2\\repository 项目所需要的jar包都复制进去。 jar（Java ARchive，Java 归档），压缩包，里面有许多class文件。 groupId 项目包名(从右向左看就是域名/网址）: com.kun.tmall（或com.how2java.tmall,随意）artifactId 项目实际名称:tmall_ssmarchetypeArtifactId 项目类型: maven-archetype-webapp 4.3.5 pom.xmlpom.xml 用于维护当前项目都用了哪些jar包 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245&lt;!-- xmlns是XML Namespaces的缩写，中文名称是XML命名空间 --&gt;&lt;!-- xsd（XML Schema Definition)用来定义xml文档结构的。 XML解析器可以根据一个XSD文件的内容来解析另一个XML文件，判断该文件的结构是否和 XSD 文件中定义的一致, XSD文件可以理解为XML文档可以自定义的语法或格式检查器--&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;!--pom版本，一般都是4.0.0 --&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!--组织结构， 如com.kun.tmall生成的相对路径为：/com/kun/tmall --&gt; &lt;groupId&gt;com.how2java.tmall&lt;/groupId&gt; &lt;!--项目实际名 --&gt; &lt;artifactId&gt;tmall_ssm&lt;/artifactId&gt; &lt;!--项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;!--打包机制，例如jar、war、ear、pom --&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;!--定义在该文件中的常量，常有定义编码的常量--&gt; &lt;properties&gt; &lt;spring.version&gt;4.1.3.RELEASE&lt;/spring.version&gt; &lt;pagehelper.version&gt;5.1.2-beta&lt;/pagehelper.version&gt; &lt;mysql.version&gt;5.1.6&lt;/mysql.version&gt; &lt;mybatis.spring.version&gt;1.2.3&lt;/mybatis.spring.version&gt; &lt;mybatis.version&gt;3.1.1&lt;/mybatis.version&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;jstl.version&gt;1.2&lt;/jstl.version&gt; &lt;jsqlparser.version&gt;1.0&lt;/jsqlparser.version&gt; &lt;jackson.version&gt;1.2.7&lt;/jackson.version&gt; &lt;servlet-api.version&gt;3.1.0&lt;/servlet-api.version&gt; &lt;druid.version&gt;1.0.18&lt;/druid.version&gt; &lt;log4j.version&gt;1.2.16&lt;/log4j.version&gt; &lt;commons-logging.version&gt;1.2&lt;/commons-logging.version&gt; &lt;commons-fileupload.version&gt;1.2.1&lt;/commons-fileupload.version&gt; &lt;commons-io.version&gt;1.3.2&lt;/commons-io.version&gt; &lt;commons-lang.version&gt;2.6&lt;/commons-lang.version&gt; &lt;aopalliance.version&gt;1.0&lt;/aopalliance.version&gt; &lt;mybatis-generator.version&gt;1.3.5&lt;/mybatis-generator.version&gt; &lt;/properties&gt; &lt;dependencies&gt;&lt;!--使用groupId、artifactId和version确定所依赖的jar等--&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;$&#123;mybatis.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;$&#123;mybatis.spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;$&#123;mysql.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;$&#123;druid.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- JSP相关 --&gt; &lt;dependency&gt; &lt;groupId&gt;jstl&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;$&#123;jstl.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;$&#123;servlet-api.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- pageHelper --&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt; &lt;artifactId&gt;pagehelper&lt;/artifactId&gt; &lt;version&gt;$&#123;pagehelper.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!--jsqlparser--&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.jsqlparser&lt;/groupId&gt; &lt;artifactId&gt;jsqlparser&lt;/artifactId&gt; &lt;version&gt;$&#123;jsqlparser.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;version&gt;$&#123;commons-logging.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;$&#123;commons-fileupload.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;$&#123;commons-io.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-lang&lt;/groupId&gt; &lt;artifactId&gt;commons-lang&lt;/artifactId&gt; &lt;version&gt;$&#123;commons-lang.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;aopalliance&lt;/groupId&gt; &lt;artifactId&gt;aopalliance&lt;/artifactId&gt; &lt;version&gt;$&#123;aopalliance.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt; &lt;version&gt;$&#123;mybatis-generator.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!--编译配置--&gt; &lt;build&gt; &lt;!--定义输出的文件名--&gt; &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt; &lt;!--使用已定义的插件--&gt; &lt;plugins&gt; &lt;!-- 资源文件拷贝插件 --&gt; &lt;!--定义插件，使用artifactId和groupId还有版本定义，并使用configuration进行配置--&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt; &lt;version&gt;2.7&lt;/version&gt; &lt;configuration&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;!-- java编译插件 --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.2&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;!--定义使用的插件，和dependencyManagement相似，只定义并未引用--&gt; &lt;pluginManagement&gt; &lt;plugins&gt; &lt;!-- 配置Tomcat插件 --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt; &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.2&lt;/version&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;!--定义使用的资源文件--&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.properties&lt;/include&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;include&gt;**/*.tld&lt;/include&gt; &lt;/includes&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.properties&lt;/include&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/build&gt;&lt;/project&gt; 4.3.6 model，service，mapper， controller各层的作用 01 model层即entity层 存放实体类，与数据库中的属性值基本保持一致。 02 service层存放业务逻辑处理，也是一些关于数据库处理的操作，但不是直接和数据库打交道，他有接口还有接口的实现方法，在接口的实现方法中需要导入mapper层。 03 mapper层即dao层，现在用mybatis逆向工程生成的mapper层，其实就是dao层。 mapper层是直接跟数据库打交道的，它也是个接口，只有方法名字，具体实现在mapper.xml文件里，service是供我们使用的方法。 对数据库进行数据持久化操作，他的方法语句是直接针对数据库操作的，而service层是针对我们controller，也就是针对我们使用者。service的impl是把mapper和service进行整合的文件。 （数据持久化操作就是指，把数据放到持久化的介质中，同时提供增删改查操作，比如数据通过hibernate插入到数据库中。） 04 controller层控制器，导入service层，因为service中的方法是我们使用到的，controller通过接收前端传过来的参数进行业务操作，在返回一个指定的路径或者数据表。 在实际开发中的Service层可能被处理为实体Service层，而不是接口，业务逻辑直接写在Service（Class，不是Interface）层中，Controller直接调用Service，Service调用Mapper，Service之间也是可以互相调用。 4.3.7新建java源代码目录maven web项目默认是没有java源代码目录的，所以需要手动创建，并设置其为源代码目录右键main目录-&gt; New-&gt;Directory-&gt;输入java-&gt;右键java-&gt;Mark Directory as-&gt; Sources Root这样就创建了存放java源文件的目录了 鼠标左键选中java， 然后右键-&gt;New-&gt;Directory 输入 com.how2java.tmall.pojo 创建包 鼠标左键选中java，然后右键-&gt;New-&gt;Directory 输入 com.how2java.tmall.mapper 创建包 鼠标左键选中java，然后右键-&gt;New-&gt;Directory 输入 com.how2java.tmall.controller 创建包 鼠标左键选中 java，然后右键-&gt;New-&gt;Directory输入 com.how2java.tmall.service 创建包 4.3.8查询01 Category类实体类，声明了id和name,以及对应的setter,getter 选中pojo包，然后单击右键–&gt;Java Class，创建Category类。 1234567891011121314151617181920package com.how2java.tmall.pojo;public class Category &#123; private Integer id; private String name; public Integer getId()&#123; return id; &#125; public void setId(Integer id)&#123; this.id = id; &#125; public String getName()&#123; return name; &#125; public void setName(String name)&#123; this.name = name == null ? null:name.trim(); //trim()方法用于删除字符串的头尾空白符 &#125;&#125; 02 CategoryMapper接口选中mapper包，然后单击右键–&gt;Java Class（选择第二项Interface)，创建CategoryMapper接口。 因为目前只做查询，所以只声明了一个list方法 12345678package com.how2java.tmall.mapper;import com.how2java.tmall.pojo.Category;import java.util.List;public interface CategoryMapper &#123; public List&lt;Category&gt; list();&#125; 03 CategoryService接口服务层service用来编写接口和实现类 选中service包，然后单击右键–&gt;Java Class（选择第二项Interface)，创建CategoryService接口。 12345678package com.how2java.tmall.service;import com.how2java.tmall.pojo.Category;import java.util.List;public interface CategoryService &#123; public List&lt;Category&gt; list();&#125; 04 CategoryServiceImpl类是CategoryService接口的实现类 首先点中源目录：java 然后菜单-&gt;File-&gt;New-&gt;Package 输入 com.how2java.tmall.service.impl 创建包 123456789101112131415161718package com.how2java.tmall.service.impl;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.List;//注解@Service声明当前类是一个Service业务类 @Servicepublic class CategoryServiceImpl implements CategoryService&#123; //通过自动装配@Autowired引入CategoryMapper,在list方法中调用CategoryMapper 的list方法 @Autowired CategoryMapper categoryMapper; public List&lt;Category&gt; list() &#123; return categoryMapper.list(); &#125;&#125; @Autowired注解是一个用于容器(container)配置的注解。 它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。 通过 @Autowired的使用来消除 set ，get方法。 自动装配，Spring容器中的bean自动的和需要的bean类组装在一起。 java的注解实现的核心技术是反射 反射机制指在程序运行过程中，对任意一个类都能获取其所有属性和方法，并且对任意一个对象都能调用其任意一个方法。这种动态获取类和对象的信息，以及动态调用对象的方法的功能被称为Java语言的反射机制。 Class对象的由来是将class文件读入内存，并为之创建一个Class对象（类对象） 该Class对象是反射的核心，通过它可以调用类的任意方法。 Class.forName 类名.class new 类名().getClass() 类的正常加载过程，反射原理与class对象： Class对象的newInstance()方法来创建Class对象对应类的实例。 05 CategoryController在controller包中新建CategoryController类 12345678910111213141516171819202122232425262728293031package com.how2java.tmall.controller;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;//使用org.springframework.web.bind.annotation.RequestMapping注解类型将请求与处理方法一一对应。/** * Controller实现类包含了对用户请求的处理逻辑，是用户请求和业务逻辑之间的“桥梁,负责具体的业务逻辑处理 * 在Spring MVC中使用扫描机制找到应用中所有基于注解的控制器类 */import java.util.List;//注解@Controller声明当前类是一个控制器@Controller//注解@RequestMapping(&quot;&quot;)表示访问的时候无需额外的地址@RequestMapping(&quot;&quot;)public class CategoryController &#123; //注解@Autowired把CategoryServiceImpl自动装配进了CategoryService 接口 @Autowired CategoryService categoryService; //注解@RequestMapping(&quot;admin_category_list&quot;) 映射admin_category_list路径的访问 @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model)&#123; List&lt;Category&gt; cs = categoryService.list(); //获取所有的Category对象，然后放在&quot;cs&quot;中。 model.addAttribute(&quot;cs&quot;,cs); return &quot;admin/listCategory&quot;; //服务端跳转到 “admin/listCategory” 视图 //“admin/listCategory” 会根据后续的springMVC.xml 配置文件，跳转到 WEB-INF/jsp/admin/listCategory.jsp 文件 &#125;&#125; 06 CategoryMapper.xml 在resources目录下，新建mapper目录 右键mapper目录-&gt;New-&gt;File 新建文件CategoryMapper.xmlCategoryMapper.xml的namespace必须是com.how2java.tmall.mapper.CategoryMapper,以和CategoryMapper保持一致。 1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt;&lt;!--这条sql语句用id: list 进行标示以供后续代码调用。resultType=&quot;Category&quot; 表示返回的数据和Category关联起来--&gt; select * from category order by id desc &lt;/select&gt;&lt;/mapper&gt;&lt;!--在上述映射文件中，&lt;mapper&gt;元素是配置文件的根元素，它包含了一个namespace属性，该属性值通常设置为“包名+SQL映射文件名”，指定了唯一的命名空间;子元素&lt;select&gt;、&lt;insert&gt;、&lt;update&gt;以及&lt;delete&gt;中的信息是用于执行查询、添加、修改以及删除操作的配置,SQL语句。--&gt; 07 log4j.properties在resources目录下新建log4j.properties 该配置文件的作用是开启日志，当访问页面的时候，查看mybatis运行的情况，执行了什么SQL语句，以及sql语句的返回情况等信息。 12345678910111213141516171819202122# Global logging configuration#设置日志输出的等级为ERROR,低于ERROR就不会输出了#设置日志输出到stdoutlog4j.rootLogger=ERROR, stdout# MyBatis logging configuration...log4j.logger.com.how2java.tmall=TRACE# Console output...log4j.appender.stdout=org.apache.log4j.ConsoleAppenderlog4j.appender.stdout.layout=org.apache.log4j.PatternLayoutlog4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n# %5p [%t] (%F:%L) - %m%n 就表示宽度是5的优先等级 线程名称 (文件名:行号) - 信息 回车#%c 输出日志信息所属的类的全名#%d 输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，比如：%d&#123;yyy-MM-dd HH:mm:ss &#125;，输出类似：2002-10-18- 22：10：28#%f 输出日志信息所属的类的类名#%l 输出日志事件的发生位置，即输出日志信息的语句处于它所在的类的第几行#%m 输出代码中指定的信息，如log(message)中的message#%n 输出一个回车换行符，Windows平台为“rn”，Unix平台为“n”#%p 输出优先级，即DEBUG，INFO，WARN，ERROR，FATAL。如果是调用debug()输出的，则为DEBUG，依此类推#%r 输出自应用启动到输出该日志信息所耗费的毫秒数#%t 输出产生该日志事件的线程名#可以从MyBatis使用手册中的Logging小节复制，然后进行简单修改#在日志文件中配置了全局的日志配置、MyBatis的日志配置和控制台输出 08 jdbc.properties在resources目录下新建jdbc.properties 12345678910#数据库的配置文件jdbc.properties，此配置文件给出了访问数据库需要的必须信息：#1. 驱动 jdbc.driver=com.mysql.jdbc.Driver#2. url jdbc.url=jdbc:mysql://localhost:3306/tmall_ssm?useUnicode=true&amp;characterEncoding=utf8#3. 账号 jdbc.username=root#4. 密码 jdbc.password=adminjdbc.driver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://localhost:3306/tmall_ssm?useUnicode=true&amp;charcterEncoding=utf8jdbc.username=rootjdbc.password=admin 09 applicationContext.xml12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;&gt; &lt;!-- 启动对注解的识别 在Spring MVC中使用扫描机制找到应用中所有基于注解的控制器类， 所以，为了让控制器类被Spring MVC框架扫描到，需要在配置文件中声明spring-context， 并使用&lt;context：component-scan/&gt;元素指定控制器类的基本包--&gt; &lt;context:annotation-config /&gt; &lt;context:component-scan base-package=&quot;com.how2java.tmall.service&quot; /&gt; &lt;!-- 导入数据库配置文件, 指定对jdbc.properties的引用 --&gt; &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt; &lt;!-- 配置数据库连接池 --&gt; &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt; &lt;!-- 基本属性 url、user、password --&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt; &lt;!-- 配置初始化大小、最小、最大 --&gt; &lt;property name=&quot;initialSize&quot; value=&quot;1&quot; /&gt; &lt;property name=&quot;minIdle&quot; value=&quot;1&quot; /&gt; &lt;property name=&quot;maxActive&quot; value=&quot;20&quot; /&gt; &lt;!-- 配置获取连接等待超时的时间 --&gt; &lt;property name=&quot;maxWait&quot; value=&quot;60000&quot; /&gt; &lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt; &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;60000&quot; /&gt; &lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt; &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot; /&gt; &lt;property name=&quot;validationQuery&quot; value=&quot;SELECT 1&quot; /&gt; &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot; /&gt; &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot; /&gt; &lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt; &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot; /&gt; &lt;property name=&quot;maxPoolPreparedStatementPerConnectionSize&quot; value=&quot;20&quot; /&gt; &lt;/bean&gt; &lt;!--Mybatis的SessionFactory配置 配置Mybatis的SessionFactory，其中声明了别名， 并且使用前面配置的数据源，扫描CategoryMapper.xml配置文件 扫描Mapper类： CategoryMapper--&gt; &lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;typeAliasesPackage&quot; value=&quot;com.how2java.tmall.pojo&quot; /&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt; &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mapper/*.xml&quot;/&gt; &lt;!--分页插件，目前先注释，后面重构的时候才会使用 &lt;property name=&quot;plugins&quot;&gt; &lt;array&gt; &lt;bean class=&quot;com.github.pagehelper.PageInterceptor&quot;&gt; &lt;property name=&quot;properties&quot;&gt; &lt;value&gt; &lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/array&gt; &lt;/property&gt; --&gt; &lt;/bean&gt; &lt;!--Mybatis的Mapper文件识别--&gt; &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt; &lt;property name=&quot;basePackage&quot; value=&quot;com.how2java.tmall.mapper&quot;/&gt; &lt;/bean&gt;&lt;/beans&gt; 10 springMVC.xml在resources目录下新建springMVC.xml 12345678910111213141516171819202122232425262728293031&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&quot;&gt; &lt;!--启动注解识别--&gt; &lt;context:annotation-config/&gt; &lt;context:component-scan base-package=&quot;com.how2java.tmall.controller&quot;&gt; &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt; &lt;/context:component-scan&gt; &lt;mvc:annotation-driven /&gt; &lt;!--开通静态资源的访问--&gt; &lt;mvc:default-servlet-handler /&gt; &lt;!-- 视图定位 --&gt; &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot; /&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt; &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt; &lt;/bean&gt; &lt;!-- 对上传文件的解析--&gt; &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;/&gt;&lt;/beans&gt; 11 修改 web.xml 指定spring的配置文件为classpath下的applicationContext.xml 设置中文过滤器 指定spring mvc配置文件为classpath下的springMVC.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; version=&quot;2.5&quot;&gt; &lt;!-- spring的配置文件--&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;!--中文过滤器--&gt; &lt;filter&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;utf-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;!-- spring mvc核心：分发servlet --&gt; &lt;servlet&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- spring mvc的配置文件 --&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:springMVC.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;/web-app&gt; 12 静态资源https://how2j.cn/frontdownload?bean.id=1478 下载解压到webapp目录中 HTML:超文本标记语言（HyperText Markup Language） HTML是一种用来定义网页的文本，会HTML，就可以编写网页. HTTP是在网络上传输HTML的协议，用于浏览器和服务器的通信 在Web应用中，浏览器请求一个URL，服务器就把生成的HTML网页发送给浏览器，而浏览器和服务器之间的传输协议是HTTP HTTP协议是一个基于TCP协议之上的请求-响应协议 &lt;标签&gt;内容&lt;/标签&gt; 12345&lt;html&gt; &lt;body&gt; &lt;p&gt;Hello HTML&lt;/p&gt; &lt;/body&gt;&lt;/html&gt; CSS:指层叠样式表 (Cascading Style Sheets) 改变页面的布局和外观 改变所有页面的布局和外观 selector {property: value} 即 选择器{属性:值} Javascript 脚本语言 像[HTML]页面添加交互行为，嵌入动态文本于HTML页面，对浏览器事件做出响应等 与 标签 函数式编程 https://www.runoob.com 13 listCategory.jsp12步骤后，就会在WEB-INF下创建jsp目录。 然后在jsp目录中创建admin目录，接着创建listCategory.jsp文件listCategory.jsp主要作用是通过43行的forEach标签遍历”cs”里的内容，然后挨个显示出来 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;script&gt;$(function()&#123; $(&quot;#addForm&quot;).submit(function()&#123; if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;)) return false; if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;)) return false; return true; &#125;);&#125;); &lt;/script&gt; &lt;title&gt;分类管理&lt;/title&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;h1 class=&quot;label label-info&quot; &gt;分类管理&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;图片&lt;/th&gt; &lt;th&gt;分类名称&lt;/th&gt; &lt;th&gt;属性管理&lt;/th&gt; &lt;th&gt;产品管理&lt;/th&gt; &lt;th&gt;编辑&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot;&gt; &lt;tr&gt; &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt; &lt;td&gt;&lt;img height=&quot;40px&quot; src=&quot;img/category/$&#123;c.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_property_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_category_edit?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;%//@include file=&quot;../include/admin/adminPage.jsp&quot; %&gt; &lt;/div&gt; &lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;分类名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;分类圖片&lt;/td&gt; &lt;td&gt; &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 14 测试首先点中源目录：java 然后菜单-&gt;File-&gt;New-&gt;Package 输入 com.how2java.tmall.test 创建包接着创建测试TestTmall, 其作用是借助JDBC, 运行代码，创建10条分类测试数据。 12345678910111213141516171819202122232425262728293031323334353637383940package com.how2java.tmall.test; import java.sql.Connection;import java.sql.DriverManager;import java.sql.SQLException;import java.sql.Statement; public class TestTmall &#123; public static void main(String args[])&#123; //准备分类测试数据： try &#123; Class.forName(&quot;com.mysql.jdbc.Driver&quot;); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; try ( Connection c = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/tmall_ssm?useUnicode=true&amp;characterEncoding=utf8&quot;, &quot;root&quot;, &quot;admin&quot;); Statement s = c.createStatement(); ) &#123; for (int i = 1; i &lt;=10 ; i++) &#123; String sqlFormat = &quot;insert into category values (null, &#x27;测试分类%d&#x27;)&quot;; String sql = String.format(sqlFormat, i); s.execute(sql); &#125; System.out.println(&quot;已经成功创建10条分类测试数据&quot;); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; &#125; 15 总结 首先浏览器上访问路径 /admin_category_list tomcat根据web.xml上的配置信息，拦截到了/admin_category_list，并将其交由DispatcherServlet处理。 DispatcherServlet 根据springMVC的配置，将这次请求交由CategoryController类进行处理，所以需要进行这个类的实例化 在实例化CategoryController的时候，注入CategoryServiceImpl 在实例化CategoryServiceImpl的时候，又注入CategoryMapper 根据ApplicationContext.xml中的配置信息，将CategoryMapper和CategoryMapper.xml关联起来了。 这样就拿到了实例化好了的CategoryController,并调用list方法 在list方法中，访问CategoryService,并获取数据，并把数据放在”cs”上，接着服务端跳转到listCategory.jsp去 最后在listCategory.jsp 中显示数据 4.3.9 分页选中java目录，右键-&gt;New -&gt; Package -&gt; com.how2java.tmall.util包 01 新建Page.java新增Page这个实体类专门为分页提供必要信息属性：int start; 开始位置int count; 每页显示的数量int total; 总共有多少条数据String param; 参数(这个属性在后续有用到，但是分类的分页查询里并没有用到，请忽略) 方法：getTotalPage 根据 每页显示的数量count以及总共有多少条数据total，计算出总共有多少页getLast 计算出最后一页的数值是多少isHasPreviouse 判断是否有前一页isHasNext 判断是否有后一页 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101package com.how2java.tmall.util;public class Page &#123; private int start; //开始页数 private int count; //每页显示个数 private int total; //总数 private String param; //参数 private static final int defaultCount = 5; //默认每页显示5条 public int getStart() &#123; return start; &#125; public void setStart(int start) &#123; this.start = start; &#125; public int getCount() &#123; return count; &#125; public void setCount(int count) &#123; this.count = count; &#125; public Page()&#123; count = defaultCount; &#125; public Page(int start, int count)&#123; this(); this.start = start; this.count = count; &#125; public boolean isHasPreviouse()&#123; if(start==0)&#123; return false; &#125; return true; &#125; public boolean isHasNext()&#123; if(start==getLast()) return false; return true; &#125; public int getTotalPage()&#123; int totalPage; // 假设总数是50，是能够被5整除的，那么就有10页 if (0 == total % count) totalPage = total /count; // 假设总数是51，不能够被5整除的，那么就有11页 else totalPage = total / count + 1; if(0==totalPage) totalPage = 1; return totalPage; &#125; public int getLast()&#123; int last; // 假设总数是50，是能够被5整除的，那么最后一页的开始就是45 if (0 == total % count) last = total - count; // 假设总数是51，不能够被5整除的，那么最后一页的开始就是50 else last = total - total % count; last = last&lt;0?0:last; return last; &#125; @Override public String toString() &#123; return &quot;Page [start=&quot; + start + &quot;, count=&quot; + count + &quot;, total=&quot; + total + &quot;, getStart()=&quot; + getStart() + &quot;, getCount()=&quot; + getCount() + &quot;, isHasPreviouse()=&quot; + isHasPreviouse() + &quot;, isHasNext()=&quot; + isHasNext() + &quot;, getTotalPage()=&quot; + getTotalPage() + &quot;, getLast()=&quot; + getLast() + &quot;]&quot;; &#125; public int getTotal() &#123; return total; &#125; public void setTotal(int total) &#123; this.total = total; &#125; public String getParam() &#123; return param; &#125; public void setParam(String param) &#123; this.param = param; &#125;&#125; 02 修改CategoryMapperMapper层 提供一个支持分页的查询方法list(Page page)和获取总数的方法total 123456789101112package com.how2java.tmall.mapper; import com.how2java.tmall.util.Page;import com.how2java.tmall.pojo.Category; import java.util.List; public interface CategoryMapper &#123; public List&lt;Category&gt; list(Page page); public int total();&#125; 03 修改CategoryMapper.xmlMybatis配置Sql 修改CategoryMapper.xml，以提供带分页的查询语句和获取总数的sql语句 123456789101112131415161718192021222324&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt; select * from category order by id desc &lt;!--Mybatis 动态SQL里的if标签--&gt; &lt;if test=&quot;start!=null and count!=null&quot;&gt; &lt;!-- 使用#&#123;&#125;意味着使用的预编译的语句,即在使用jdbc时的preparedStatement--&gt; limit #&#123;start&#125;,#&#123;count&#125; &lt;!-- 根据分页数据start和count查询数据 --&gt; &lt;/if&gt; &lt;/select&gt; &lt;!-- 查询用户记录总数 --&gt; &lt;select id=&quot;total&quot; resultType=&quot;int&quot;&gt; select count(*) from category &lt;!--Select count(*) 返回的是记录的数目--&gt; &lt;/select&gt; &lt;/mapper&gt; 04 修改CategoryService提供一个支持分页的查询方法list(Page page)和获取总数的方法total 12345678910111213package com.how2java.tmall.service;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.util.Page;import java.util.List;public interface CategoryService &#123; public int total(); public List&lt;Category&gt; list(Page page); &#125; 05 修改CategoryServiceImpl提供一个支持分页的查询方法list(Page page)和获取总数的方法total 123456789101112131415161718192021222324package com.how2java.tmall.service.impl;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.util.Page;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.List;//注解@Service声明当前类是一个Service业务类 @Servicepublic class CategoryServiceImpl implements CategoryService&#123; //通过自动装配@Autowired引入CategoryMapper,在list方法中调用CategoryMapper 的list方法 @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list(Page page) &#123; return categoryMapper.list(page); &#125; @Override public int total()&#123; return categoryMapper.total(); &#125;&#125; 06 修改CategoryController 为方法list增加参数Page用于获取浏览器传递过来的分页信息 categoryService.list(page); 获取当前页的分类集合 通过categoryService.total(); 获取分类总数 通过page.setTotal(total); 为分页对象设置总数 把分类集合放在”cs”中 把分页对象放在 “page“ 中 跳转到listCategory.jsp页面 12345678910111213141516171819202122232425262728293031323334353637package com.how2java.tmall.controller;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.util.Page;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;//使用org.springframework.web.bind.annotation.RequestMapping注解类型将请求与处理方法一一对应。/* Controller实现类包含了对用户请求的处理逻辑，是用户请求和业务逻辑之间的“桥梁,负责具体的业务逻辑处理 在Spring MVC中使用扫描机制找到应用中所有基于注解的控制器类 */import java.util.List;//注解@Controller声明当前类是一个控制器@Controller//注解@RequestMapping(&quot;&quot;)表示访问的时候无需额外的地址@RequestMapping(&quot;&quot;)public class CategoryController &#123; //注解@Autowired把CategoryServiceImpl自动装配进了CategoryService 接口 @Autowired CategoryService categoryService; //注解@RequestMapping(&quot;admin_category_list&quot;) 映射admin_category_list路径的访问 @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model，Page page)&#123; //为方法list增加参数Page用于获取浏览器传递过来的分页信息 List&lt;Category&gt; cs = categoryService.list(page); //获取当前页的分类集合 int total = categoryService.total(); //获取分类总数 page.setTotal(total); //为分页对象设置总数 model.addAttribute(&quot;cs&quot;,cs);//把分类集合放在&quot;cs&quot;中 model.addAttribute(&quot;page&quot;,page); //把分页对象放在 &quot;page“ 中 return &quot;admin/listCategory&quot;; //跳转到listCategory.jsp页面 &#125;&#125; 07 listCategory.jspwebapp/WEB-INF/jsp/admin/listCategory.jsp JSTL JSP Standard Tag Library 标准标签库 JSTL允许开人员可以像使用HTML标签那样在JSP中开发Java功能。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;!--prefix=&quot;c&quot; 表示后续的标签使用都会以&lt;c: 开头 --&gt;&lt;!--taglib 标签的作用：声明用户使用*自定义*的标签，将标签库描述符文件导入到jsp页面。属性：uri属性:定位标签库描述符的位置。唯一标识和前缀相关的标签库描述符，可以使用绝对或相对URL。prefix属性：标签的前缀，区分多个自定义标签。不可以使用保留前缀和空前缀，遵循XML命名空间的命名约定。--&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;&lt;script&gt; $(function()&#123; $(&quot;#addForm&quot;).submit(function()&#123; if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;)) return false; if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;)) return false; return true; &#125;); &#125;);&lt;/script&gt;&lt;title&gt;分类管理&lt;/title&gt;&lt;div class=&quot;workingArea&quot;&gt; &lt;h1 class=&quot;label label-info&quot; &gt;分类管理&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;图片&lt;/th&gt; &lt;th&gt;分类名称&lt;/th&gt; &lt;th&gt;属性管理&lt;/th&gt; &lt;th&gt;产品管理&lt;/th&gt; &lt;th&gt;编辑&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;!-- 使用JSTL中的c:forEach 循环来遍历集合cs --&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot;&gt; &lt;!-- var=&quot;c&quot; 表示把每一个集合中的元素放在c上--&gt; &lt;tr&gt; &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt; &lt;td&gt;&lt;img height=&quot;40px&quot; src=&quot;img/category/$&#123;c.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_property_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_category_edit?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;% @include file=&quot;../include/admin/adminPage.jsp&quot; %&gt; &lt;/div&gt; &lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;分类名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;分类圖片&lt;/td&gt; &lt;td&gt; &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 08 adminPage.jspBootStrap 是Twitter的工程师开发的前端框架，可以非常方便的设计出好看的页面效果。 以开头 接着导入js和cssBootstrap需要JQuery才能正常工作，所以需要导入jquery.min.js接着是 Bootstrap的css，里面定义了各种样式最后是 Bootstrap的js，用于产生交互效果，比如关闭警告框 123&lt;script src=&quot;https://how2j.cn/study/js/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;link href=&quot;https://how2j.cn/study/css/bootstrap/3.3.6/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;script src=&quot;https://how2j.cn/study/js/bootstrap/3.3.6/bootstrap.min.js&quot;&gt;&lt;/script&gt; 标签定义导航链接的部分 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot;%&gt; &lt;script&gt;$(function()&#123; $(&quot;ul.pagination li.disabled a&quot;).click(function()&#123; return false; &#125;);&#125;); &lt;/script&gt; &lt;nav&gt; &lt;ul class=&quot;pagination&quot;&gt; &lt;!--首页超链：--&gt; &lt;li &lt;c:if test=&quot;$&#123;!page.hasPreviouse&#125;&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt; &lt;a href=&quot;?start=0$&#123;page.param&#125;&quot; aria-label=&quot;Previous&quot; &gt; &lt;span aria-hidden=&quot;true&quot;&gt;«&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;!--上一页超链：--&gt; &lt;li &lt;c:if test=&quot;$&#123;!page.hasPreviouse&#125;&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt; &lt;a href=&quot;?start=$&#123;page.start-page.count&#125;$&#123;page.param&#125;&quot; aria-label=&quot;Previous&quot; &gt; &lt;span aria-hidden=&quot;true&quot;&gt;‹&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;!--中间页--&gt; &lt;c:forEach begin=&quot;0&quot; end=&quot;$&#123;page.totalPage-1&#125;&quot; varStatus=&quot;status&quot;&gt; &lt;li &lt;c:if test=&quot;$&#123;status.index*page.count==page.start&#125;&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt; &lt;a href=&quot;?start=$&#123;status.index*page.count&#125;$&#123;page.param&#125;&quot; &lt;c:if test=&quot;$&#123;status.index*page.count==page.start&#125;&quot;&gt;class=&quot;current&quot;&lt;/c:if&gt; &gt;$&#123;status.count&#125;&lt;/a&gt; &lt;/li&gt; &lt;/c:forEach&gt; &lt;!--下一页超链：--&gt; &lt;li &lt;c:if test=&quot;$&#123;!page.hasNext&#125;&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt; &lt;a href=&quot;?start=$&#123;page.start+page.count&#125;$&#123;page.param&#125;&quot; aria-label=&quot;Next&quot;&gt; &lt;span aria-hidden=&quot;true&quot;&gt;›&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;!--最后一页--&gt; &lt;li &lt;c:if test=&quot;$&#123;!page.hasNext&#125;&quot;&gt;class=&quot;disabled&quot;&lt;/c:if&gt;&gt; &lt;a href=&quot;?start=$&#123;page.last&#125;$&#123;page.param&#125;&quot; aria-label=&quot;Next&quot;&gt; &lt;span aria-hidden=&quot;true&quot;&gt;»&lt;/span&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ul&gt;&lt;/nav&gt; 4.3.10 增加01 listCategory.jsp1 新增分类增加分类的代码是整合在listCategory.jsp中的 method=”post” 用于保证中文的正确提交 必须有enctype=”multipart/form-data”，表示提交的数据是二进制文件，这样才能上传文件 accept=”image/*” 这样把上传的文件类型限制在了图片 1234567891011121314151617181920212223&lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;分类名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;分类图片&lt;/td&gt; &lt;td&gt; &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; 2 图片为空判断对分类名称和分类图片做了为空判断，当为空的时候，不能提交 12345678910111213&lt;script&gt;$(function()&#123; $(&quot;#addForm&quot;).submit(function()&#123; if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;)) return false; if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;)) return false; return true; &#125;);&#125;); &lt;/script&gt; 其中用到的函数checkEmpty，在adminHeader.jsp中定义 123456789function checkEmpty(id, name)&#123; var value = $(&quot;#&quot;+id).val(); if(value.length==0)&#123; alert(name+ &quot;不能为空&quot;); $(&quot;#&quot;+id)[0].focus(); return false; &#125; return true;&#125; listCategory.jsp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt;&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;!--prefix=&quot;c&quot; 表示后续的标签使用都会以&lt;c: 开头 --&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt;&lt;script&gt; $(function()&#123; $(&quot;#addForm&quot;).submit(function()&#123; if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;)) return false; if(!checkEmpty(&quot;categoryPic&quot;,&quot;分类图片&quot;)) return false; return true; &#125;); &#125;);&lt;/script&gt;&lt;title&gt;分类管理&lt;/title&gt;&lt;div class=&quot;workingArea&quot;&gt; &lt;h1 class=&quot;label label-info&quot; &gt;分类管理&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&quot;listDataTableDiv&quot;&gt; &lt;table class=&quot;table table-striped table-bordered table-hover table-condensed&quot;&gt; &lt;thead&gt; &lt;tr class=&quot;success&quot;&gt; &lt;th&gt;ID&lt;/th&gt; &lt;th&gt;图片&lt;/th&gt; &lt;th&gt;分类名称&lt;/th&gt; &lt;th&gt;属性管理&lt;/th&gt; &lt;th&gt;产品管理&lt;/th&gt; &lt;th&gt;编辑&lt;/th&gt; &lt;th&gt;删除&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;!-- 使用JSTL中的c:forEach 循环来遍历集合cs --&gt; &lt;c:forEach items=&quot;$&#123;cs&#125;&quot; var=&quot;c&quot;&gt; &lt;!-- var=&quot;c&quot; 表示把每一个集合中的元素放在c上--&gt; &lt;tr&gt; &lt;td&gt;$&#123;c.id&#125;&lt;/td&gt; &lt;td&gt;&lt;img height=&quot;40px&quot; src=&quot;img/category/$&#123;c.id&#125;.jpg&quot;&gt;&lt;/td&gt; &lt;td&gt;$&#123;c.name&#125;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_property_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-th-list&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_product_list?cid=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-shopping-cart&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a href=&quot;admin_category_edit?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;td&gt;&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class=&quot;pageDiv&quot;&gt; &lt;% @include file=&quot;../include/admin/adminPage.jsp&quot; %&gt; &lt;/div&gt; &lt;div class=&quot;panel panel-warning addDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;新增分类&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;addForm&quot; action=&quot;admin_category_add&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;addTable&quot;&gt; &lt;tr&gt; &lt;td&gt;分类名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;分类圖片&lt;/td&gt; &lt;td&gt; &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;%@include file=&quot;../include/admin/adminFooter.jsp&quot;%&gt; 02 CategoryMapper.xml在CategoryMapper.xml中新增加 插入分类的SQL语句 123&lt;insert id=&quot;add&quot; keyProperty=&quot;id&quot; useGeneratedKeys=&quot;true&quot; parameterType=&quot;Category&quot; &gt; insert into category ( name ) values (#&#123;name&#125;) &lt;/insert&gt; 需要加上2个属性：keyProperty=”id” useGeneratedKeys=”true” 以确保Category对象通过mybatis增加到数据库之后得到的id增长值会被设置在Category对象上。 因为在保存分类图片的时候需要用到这个id值，所以这一步是必须的。 1234567891011121314151617181920&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt; select * from category order by id desc &lt;if test=&quot;start!=null and count!=null&quot;&gt; limit #&#123;start&#125;,#&#123;count&#125; &lt;/if&gt; &lt;/select&gt; &lt;select id=&quot;total&quot; resultType=&quot;int&quot;&gt; select count(*) from category &lt;/select&gt; &lt;insert id=&quot;add&quot; keyProperty=&quot;id&quot; useGeneratedKeys=&quot;true&quot; parameterType=&quot;Category&quot; &gt; insert into category ( name ) values (#&#123;name&#125;) &lt;/insert&gt;&lt;/mapper&gt; 03 CategoryMapper新增add方法 1234567891011121314package com.how2java.tmall.mapper; import com.how2java.tmall.util.Page;import com.how2java.tmall.pojo.Category; import java.util.List; public interface CategoryMapper &#123; List&lt;Category&gt; list(Page page); int total(); void add(Category category);&#125; 04 CategoryService新增add方法 12345678910111213package com.how2java.tmall.service; import com.how2java.tmall.pojo.Category; import com.how2java.tmall.util.Page; import java.util.List; public interface CategoryService&#123; int total(); List&lt;Category&gt; list(Page page); void add(Category category); &#125; 05 CategoryServiceImpl新增add方法的实现 123456789101112131415161718192021222324252627package com.how2java.tmall.service.impl;import com.how2java.tmall.util.Page;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.List;@Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list(Page page) &#123; return categoryMapper.list(page); &#125; @Override public int total() &#123; return categoryMapper.total(); &#125; @Override public void add(Category category) &#123; categoryMapper.add(category); &#125;&#125; 06 UploadedImageFile在util包中新增UploadedImageFile.java ，其中有一个MultipartFile 类型的属性，用于接受上传文件的注入 1&lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; 这里的属性名称image必须和页面中的增加分类部分中的type=”file”的name值保持一致。 12345678910111213141516package com.how2java.tmall.util; import org.springframework.web.multipart.MultipartFile; public class UploadedImageFile &#123; MultipartFile image; public MultipartFile getImage() &#123; return image; &#125; public void setImage(MultipartFile image) &#123; this.image = image; &#125; &#125; 07 ImageUtil工具类ImageUtil 工具类提供3个方法 change2jpg确保图片文件的二进制格式是jpg。仅仅通过ImageIO.write(img, “jpg”, file);不足以保证转换出来的jpg文件显示正常。 这段转换代码，可以确保转换后jpg的图片显示正常，而不会出现暗红色( 有一定几率出现)。 后两种resizeImage用于改变图片大小，在上传产品图片的时候会用到。 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.how2java.tmall.util; import java.awt.Image;import java.awt.Toolkit;import java.awt.image.BufferedImage;import java.awt.image.ColorModel;import java.awt.image.DataBuffer;import java.awt.image.DataBufferInt;import java.awt.image.DirectColorModel;import java.awt.image.PixelGrabber;import java.awt.image.Raster;import java.awt.image.RenderedImage;import java.awt.image.WritableRaster;import java.io.File;import java.io.IOException; import javax.imageio.ImageIO; public class ImageUtil &#123; public static BufferedImage change2jpg(File f) &#123; try &#123; Image i = Toolkit.getDefaultToolkit().createImage(f.getAbsolutePath()); PixelGrabber pg = new PixelGrabber(i, 0, 0, -1, -1, true); pg.grabPixels(); int width = pg.getWidth(), height = pg.getHeight(); final int[] RGB_MASKS = &#123; 0xFF0000, 0xFF00, 0xFF &#125;; final ColorModel RGB_OPAQUE = new DirectColorModel(32, RGB_MASKS[0], RGB_MASKS[1], RGB_MASKS[2]); DataBuffer buffer = new DataBufferInt((int[]) pg.getPixels(), pg.getWidth() * pg.getHeight()); WritableRaster raster = Raster.createPackedRaster(buffer, width, height, width, RGB_MASKS, null); BufferedImage img = new BufferedImage(RGB_OPAQUE, raster, false, null); return img; &#125; catch (InterruptedException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); return null; &#125; &#125; public static void resizeImage(File srcFile, int width,int height, File destFile) &#123; try &#123; if(!destFile.getParentFile().exists()) destFile.getParentFile().mkdirs(); Image i = ImageIO.read(srcFile); i = resizeImage(i, width, height); ImageIO.write((RenderedImage) i, &quot;jpg&quot;, destFile); &#125; catch (IOException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; public static Image resizeImage(Image srcImage, int width, int height) &#123; try &#123; BufferedImage buffImg = null; buffImg = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB); buffImg.getGraphics().drawImage(srcImage.getScaledInstance(width, height, Image.SCALE_SMOOTH), 0, 0, null); return buffImg; &#125; catch (Exception e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; return null; &#125; &#125; 08 CategoryControllerCategoryController新增add方法 12345678910111213141516171819202122232425262728//add方法映射路径admin_category_add的访问@RequestMapping(&quot;admin_category_add&quot;)/*1 参数 Category c接受页面提交的分类名称2 参数 session 用于在后续获取当前应用的路径3 UploadedImageFile 用于接受上传的图片*/public String add(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; //通过categoryService保存c对象 categoryService.add(c); /* 通过session获取ServletContext,再通过getRealPath定位存放分类图片的路径。 该项目使用idea中的tomcat部署，那么图片存放在:C:\\Users\\hk199\\Desktop\\Java学习总结\\tmall-ssm\\img\\category 中 */ File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); //根据分类id创建文件名 File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); //如果/img/category目录不存在，则创建该目录，否则后续保存浏览器传过来图片，会提示无法保存 if(!file.getParentFile().exists()) file.getParentFile().mkdirs(); //通过UploadedImageFile 把浏览器传递过来的图片保存在上述指定的位置 uploadedImageFile.getImage().transferTo(file); //通过ImageUtil.change2jpg(file); 确保图片格式一定是jpg，而不仅仅是后缀名是jpg. BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); //客户端跳转到admin_category_list return &quot;redirect:/admin_category_list&quot;;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.util.ImageUtil;import com.how2java.tmall.util.Page;import com.how2java.tmall.util.UploadedImageFile;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping; import javax.imageio.ImageIO;import javax.servlet.http.HttpSession;import java.awt.image.BufferedImage;import java.io.File;import java.io.IOException;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class CategoryController &#123; @Autowired CategoryService categoryService; @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model,Page page)&#123; List&lt;Category&gt; cs= categoryService.list(page); int total = categoryService.total(); page.setTotal(total); model.addAttribute(&quot;cs&quot;, cs); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listCategory&quot;; &#125; @RequestMapping(&quot;admin_category_add&quot;) public String add(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; System.out.println(c.getId()); categoryService.add(c); System.out.println(c.getId()); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); if(!file.getParentFile().exists()) file.getParentFile().mkdirs(); System.out.println(uploadedImageFile); System.out.println(uploadedImageFile.getImage()); System.out.println(file); uploadedImageFile.getImage().transferTo(file); BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); return &quot;redirect:/admin_category_list&quot;; &#125; &#125; 09 中文问题中文问题，统一交由web.xml中定义的org.springframework.web.filter.CharacterEncodingFilter来进行处理 /*表示所有的访问都会过滤 *.jsp就表示只过滤jsp 12345678910111213&lt;!--中文过滤器--&gt; &lt;filter&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;utf-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; 在jsp中要加上下方代码，其中contentType=”text/html; charset=UTF-8”的作用是告诉浏览器提交数据的时候，使用UTF-8编码 在form里method=”post” 才能正确提交中文 12&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; 配置Tomcat,deployment 这里一定要选 tmall_ssm:war exploed 4.3.11 删除01 listCategory.jsp用于删除的超链 指向地址admin_category_delete,并且会传递当前分类对象的id过去。 1&lt;a deleteLink=&quot;true&quot; href=&quot;admin_category_delete?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot; glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt; 02 adminHeader.jsp删除前的确认操作 在adminHeader.jsp中对所有的删除连接都进行了监听 12345678910111213$(function()&#123; $(&quot;a&quot;).click(function()&#123; var deleteLink = $(this).attr(&quot;deleteLink&quot;); console.log(deleteLink); if(&quot;true&quot;==deleteLink)&#123; var confirmDelete = confirm(&quot;确认要删除&quot;); if(confirmDelete) return true; return false; &#125; &#125;);&#125;) 03 CategoryMapper.xml增加删除sql语句 123456789101112131415161718192021222324252627&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt; select * from category order by id desc &lt;if test=&quot;start!=null and count!=null&quot;&gt; limit #&#123;start&#125;,#&#123;count&#125; &lt;/if&gt; &lt;/select&gt; &lt;select id=&quot;total&quot; resultType=&quot;int&quot;&gt; select count(*) from category &lt;/select&gt; &lt;insert id=&quot;add&quot; keyProperty=&quot;id&quot; useGeneratedKeys=&quot;true&quot; parameterType=&quot;Category&quot; &gt; insert into category ( name ) values (#&#123;name&#125;) &lt;/insert&gt; &lt;delete id=&quot;delete&quot;&gt; delete from category where id= #&#123;id&#125; &lt;/delete&gt; &lt;/mapper&gt; 04 CategoryMapper增加删除方法 12345678910111213141516package com.how2java.tmall.mapper; import com.how2java.tmall.util.Page;import com.how2java.tmall.pojo.Category; import java.util.List; public interface CategoryMapper &#123; List&lt;Category&gt; list(Page page); int total(); void add(Category category); void delete(int id);&#125; 05 CategoryService增加删除方法 12345678910111213package com.how2java.tmall.service;import com.how2java.tmall.pojo.Categoryimport com.how2java.tmall.util.Page;import java.util.List; public interface CategoryService&#123; int total(); List&lt;Category&gt; list(Page page); void add(Category category); void delete(int id); 06 CategoryServiceImpl增加删除方法 123456789101112131415161718192021222324252627282930313233343536package com.how2java.tmall.service.impl; import com.how2java.tmall.util.Page;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list(Page page) &#123; return categoryMapper.list(page); &#125; @Override public int total() &#123; return categoryMapper.total(); &#125; @Override public void add(Category category) &#123; categoryMapper.add(category); &#125; @Override public void delete(int id) &#123; categoryMapper.delete(id); &#125;&#125; 07 CategoryController增加删除方法 123456789101112131415//映射路径admin_category_delete@RequestMapping(&quot;admin_category_delete&quot;)//提供参数接受id注入//提供session参数，用于后续定位文件位置 public String delete(int id,HttpSession session) throws IOException &#123; //通过categoryService删除数据 categoryService.delete(id); //通过session获取ControllerContext然后获取分类图片位置，接着删除分类图片 File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,id+&quot;.jpg&quot;); file.delete(); //客户端跳转到 admin_category_list return &quot;redirect:/admin_category_list&quot;;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.util.ImageUtil;import com.how2java.tmall.util.Page;import com.how2java.tmall.util.UploadedImageFile;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.servlet.ModelAndView; import javax.imageio.ImageIO;import javax.servlet.http.HttpSession;import java.awt.image.BufferedImage;import java.io.File;import java.io.IOException;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class CategoryController &#123; @Autowired CategoryService categoryService; @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model,Page page)&#123; List&lt;Category&gt; cs= categoryService.list(page); int total = categoryService.total(); page.setTotal(total); model.addAttribute(&quot;cs&quot;, cs); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listCategory&quot;; &#125; @RequestMapping(&quot;admin_category_add&quot;) public String add(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; categoryService.add(c); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); if(!file.getParentFile().exists()) file.getParentFile().mkdirs(); uploadedImageFile.getImage().transferTo(file); BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); return &quot;redirect:/admin_category_list&quot;; &#125; @RequestMapping(&quot;admin_category_delete&quot;) public String delete(int id,HttpSession session) throws IOException &#123; categoryService.delete(id); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,id+&quot;.jpg&quot;); file.delete(); return &quot;redirect:/admin_category_list&quot;; &#125; &#125; 4.3.12 编辑01 listCategory.jsp用于编辑的超链，指向地址admin_category_edit,并且会传递当前分类对象的id过去。 1&lt;a href=&quot;admin_category_edit?id=$&#123;c.id&#125;&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-edit&quot;&gt;&lt;/span&gt;&lt;/a&gt; 02 CategoryMapper.xml增加通过id获取Category对象的sql语句 123456789101112131415161718192021222324252627&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.how2java.tmall.mapper.CategoryMapper&quot;&gt; &lt;select id=&quot;list&quot; resultType=&quot;Category&quot;&gt; select * from category order by id desc &lt;if test=&quot;start!=null and count!=null&quot;&gt; limit #&#123;start&#125;,#&#123;count&#125; &lt;/if&gt; &lt;/select&gt; &lt;select id=&quot;total&quot; resultType=&quot;int&quot;&gt; select count(*) from category &lt;/select&gt; &lt;insert id=&quot;add&quot; keyProperty=&quot;id&quot; useGeneratedKeys=&quot;true&quot; parameterType=&quot;Category&quot; &gt; insert into category ( name ) values (#&#123;name&#125;) &lt;/insert&gt; &lt;delete id=&quot;delete&quot;&gt; delete from category where id= #&#123;id&#125; &lt;/delete&gt; &lt;select id=&quot;get&quot; resultType=&quot;Category&quot;&gt; select * from category where id= #&#123;id&#125; &lt;/select&gt;&lt;/mapper&gt; 03 CategoryMapper增加get方法 123456789101112131415161718package com.how2java.tmall.mapper; import com.how2java.tmall.util.Page;import com.how2java.tmall.pojo.Category; import java.util.List; public interface CategoryMapper &#123; List&lt;Category&gt; list(Page page); int total(); void add(Category category); void delete(int id); Category get(int id);&#125; 04 CategoryService增加get方法 1234567891011121314package com.how2java.tmall.service;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.util.Page;import java.util.List;public interface CategoryService&#123; int total(); List&lt;Category&gt; list(Page page); void add(Category category); void delete(int id); Category get(int id);&#125; 05 CategoryServiceImpl增加get方法 1234567891011121314151617181920212223242526272829303132333435363738394041package com.how2java.tmall.service.impl; import com.how2java.tmall.util.Page;import com.how2java.tmall.mapper.CategoryMapper;import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service; import java.util.List; @Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired CategoryMapper categoryMapper; @Override public List&lt;Category&gt; list(Page page) &#123; return categoryMapper.list(page); &#125; @Override public int total() &#123; return categoryMapper.total(); &#125; @Override public void add(Category category) &#123; categoryMapper.add(category); &#125; @Override public void delete(int id) &#123; categoryMapper.delete(id); &#125; @Override public Category get(int id) &#123; return categoryMapper.get(id); &#125;&#125; 06 CategoryController增加edit方法 1234567891011//映射admin_category_edit路径的访问@RequestMapping(&quot;admin_category_edit&quot;)//参数id用来接受注入public String edit(int id,Model model) throws IOException &#123; //通过categoryService.get获取Category对象 //把对象放在“c&quot;上 Category c= categoryService.get(id); model.addAttribute(&quot;c&quot;, c); //返回editCategory.jsp return &quot;admin/editCategory&quot;;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.how2java.tmall.controller; import com.how2java.tmall.pojo.Category;import com.how2java.tmall.service.CategoryService;import com.how2java.tmall.util.ImageUtil;import com.how2java.tmall.util.Page;import com.how2java.tmall.util.UploadedImageFile;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.servlet.ModelAndView; import javax.imageio.ImageIO;import javax.servlet.http.HttpSession;import java.awt.image.BufferedImage;import java.io.File;import java.io.IOException;import java.util.List; @Controller@RequestMapping(&quot;&quot;)public class CategoryController &#123; @Autowired CategoryService categoryService; @RequestMapping(&quot;admin_category_list&quot;) public String list(Model model,Page page)&#123; List&lt;Category&gt; cs= categoryService.list(page); int total = categoryService.total(); page.setTotal(total); model.addAttribute(&quot;cs&quot;, cs); model.addAttribute(&quot;page&quot;, page); return &quot;admin/listCategory&quot;; &#125; @RequestMapping(&quot;admin_category_add&quot;) public String add(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; categoryService.add(c); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); if(!file.getParentFile().exists()) file.getParentFile().mkdirs(); uploadedImageFile.getImage().transferTo(file); BufferedImage img = ImageUtil.change2jpg(file); ImageIO.write(img, &quot;jpg&quot;, file); return &quot;redirect:/admin_category_list&quot;; &#125; @RequestMapping(&quot;admin_category_delete&quot;) public String delete(int id,HttpSession session) throws IOException &#123; categoryService.delete(id); File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); File file = new File(imageFolder,id+&quot;.jpg&quot;); file.delete(); return &quot;redirect:/admin_category_list&quot;; &#125; @RequestMapping(&quot;admin_category_edit&quot;) public String edit(int id,Model model) throws IOException &#123; Category c= categoryService.get(id); model.addAttribute(&quot;c&quot;, c); return &quot;admin/editCategory&quot;; &#125; &#125; 07 editCategory.jsp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot; import=&quot;java.util.*&quot;%&gt; &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminHeader.jsp&quot;%&gt;&lt;%@include file=&quot;../include/admin/adminNavigator.jsp&quot;%&gt; &lt;title&gt;编辑分类&lt;/title&gt; &lt;script&gt; $(function()&#123; $(&quot;#editForm&quot;).submit(function()&#123; if(!checkEmpty(&quot;name&quot;,&quot;分类名称&quot;)) return false; return true; &#125;); &#125;); &lt;/script&gt; &lt;div class=&quot;workingArea&quot;&gt; &lt;ol class=&quot;breadcrumb&quot;&gt; &lt;li&gt;&lt;a href=&quot;admin_category_list&quot;&gt;所有分类&lt;/a&gt;&lt;/li&gt; &lt;li class=&quot;active&quot;&gt;编辑分类&lt;/li&gt; &lt;/ol&gt; &lt;div class=&quot;panel panel-warning editDiv&quot;&gt; &lt;div class=&quot;panel-heading&quot;&gt;编辑分类&lt;/div&gt; &lt;div class=&quot;panel-body&quot;&gt; &lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_category_update&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;table class=&quot;editTable&quot;&gt; &lt;tr&gt; &lt;td&gt;分类名称&lt;/td&gt; &lt;td&gt;&lt;input id=&quot;name&quot; name=&quot;name&quot; value=&quot;$&#123;c.name&#125;&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;分类图片&lt;/td&gt; &lt;td&gt; &lt;input id=&quot;categoryPic&quot; accept=&quot;image/*&quot; type=&quot;file&quot; name=&quot;image&quot; /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr class=&quot;submitTR&quot;&gt; &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;$&#123;c.id&#125;&quot;&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;提 交&lt;/button&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 点击编辑下的小图标，会跳转到下面的编辑分类 4.3.13 修改01 listCategory.jsp编辑页面提交数据到admin_category_update 1&lt;form method=&quot;post&quot; id=&quot;editForm&quot; action=&quot;admin_category_update&quot; enctype=&quot;multipart/form-data&quot;&gt; 02 CategoryMapper.xml增加修改的sql语句 123&lt;update id=&quot;update&quot; parameterType=&quot;Category&quot; &gt; update category set name=#&#123;name&#125; where id=#&#123;id&#125;&lt;/update&gt; 03 CategoryMapper增加update方法 1void update(Category category); 04 CategoryService增加update方法 1void update(Category category); 05 CategoryServiceImpl增加update方法 1234@Overridepublic void update(Category category) &#123; categoryMapper.update(category); &#125; 06 CategoryController新增update方法 1234567891011121314151617181920212223//update 方法映射路径admin_category_update的访问@RequestMapping(&quot;admin_category_update&quot;)//参数 Category c接受页面提交的分类名称//参数 session 用于在后续获取当前应用的路径//UploadedImageFile 用于接受上传的图片public String update(Category c, HttpSession session, UploadedImageFile uploadedImageFile) throws IOException &#123; //通过categoryService更新c对象 categoryService.update(c); //通过UploadedImageFile 把浏览器传递过来的图片保存在上述指定的位置 MultipartFile image = uploadedImageFile.getImage(); if(null!=image &amp;&amp;!image.isEmpty())&#123; // //首先判断是否有上传图片，如果有上传，那么通过session获取ControllerContext,再通过getRealPath定位存放分类图片的路径。 File imageFolder= new File(session.getServletContext().getRealPath(&quot;img/category&quot;)); //根据分类id创建文件名 File file = new File(imageFolder,c.getId()+&quot;.jpg&quot;); image.transferTo(file); //通过ImageUtil.change2jpg(file); 确保图片格式一定是jpg，而不仅仅是后缀名是jpg BufferedImage img = ImageUtil.change2jpg(file); //客户端跳转到admin_category_list ImageIO.write(img, &quot;jpg&quot;, file); &#125; return &quot;redirect:/admin_category_list&quot;; &#125;","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"}]},{"title":"SSM电商项目02","date":"2020-08-12T05:12:12.000Z","path":"2020/08/12/电商网站的SSM项目02/","text":"二 电商网站SSM项目开发流程笔记1.商业开发的流程 需求分析（前台和后台）：需要做哪些功能 前台又分为单纯要展示的那些功能-需求分析-展示，以及会提交数据到服务端的哪些功能-需求分析-交互。 表结构设计（围绕着功能需求） 表与表之间的关系，SQL语句，表和页面功能的一一对应 界面原型（与客户沟通） 低成本，高效率，需求的一致性，前台原型与后台原型 后台分类管理 查询，分页，增删改查 项目重构 ssm存在的一些问题，改进，提高效率 后台其他管理 前台首页 前台无需登录 前台需要登录 总结 2.需求分析2.1 前台展示在前端页面上显示数据库中的数据，如首页，产品页，购物车，分类页面等等。 前端页面如何组织显示，页面布局，css样式设置，Javascript交互等 2.2 前台交互通过POST,GET等http协议，与服务端进行同步或者异步数据交互。 比如购买，购物车，生成订单，登录等等功能。 2.3 后台对支撑整站需要用到的数据，进行管理维护。 比如分类管理，分类属性管理， 产品管理，产品图片管理，用户管理，订单管理等等。 3.表结构设计3.1 表与表的关系 表与表之间的关系，基本上是3种一对一一对多多对一 正确的分析表与表之间的关系的方法是这样：一个分类对应 多个 产品 一个产品对应 一个 分类 3.2 Mysql数据库1.数据库（Database）是存储和管理数据的仓库。2.SQL（结构化查询语言） 3.MySQL是一个DBMS，DBMS实际上就是一个数据库管理系统。一般的中小型网站都选择MySQL作为网站的数据库，因为它可以使用SQL语言进行操作，而且它的速度快，最重要的是它免费。 4.（Linux系统+xfe终端） 安装MySQL安装服务端sudo apt-get install mysql-server 安装客户端：sudo apt-get install mysql-client验证是否安装并启动成功：sudo netstat -tap | grep mysql5.打开MySQL启动MySQL服务：sudo service mysql start 登陆 mysql -u root 6.查看数据库show databases; 7.连接数据库use 数据库名 8.查看表show tables; 9.退出quit或exit 3.3建表SQL语句 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697DROP DATABASE IF EXISTS tmall_ssm;CREATE DATABASE tmall_ssm DEFAULT CHARACTER SET utf8;USE tmall_ssm;CREATE TABLE user ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(255) DEFAULT NULL, password varchar(255) DEFAULT NULL, PRIMARY KEY (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #用户表CREATE TABLE category ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(255) DEFAULT NULL, PRIMARY KEY (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #分类表CREATE TABLE property ( id int(11) NOT NULL AUTO_INCREMENT, cid int(11) DEFAULT NULL, #本表的外键cid，指向分类表的id字段 name varchar(255) DEFAULT NULL, PRIMARY KEY (id), CONSTRAINT fk_property_category FOREIGN KEY (cid) REFERENCES category (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #属性表，有外键约束CREATE TABLE product ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(255) DEFAULT NULL, #产品名称 subTitle varchar(255) DEFAULT NULL, #小标题 originalPrice float DEFAULT NULL, #原始价格 promotePrice float DEFAULT NULL, #优惠价格 stock int(11) DEFAULT NULL, #库存 cid int(11) DEFAULT NULL, #外键cid，指向分类表的id字段 createDate datetime DEFAULT NULL, #createDate: 创建日期 PRIMARY KEY (id), CONSTRAINT fk_product_category FOREIGN KEY (cid) REFERENCES category (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #产品表CREATE TABLE propertyvalue ( id int(11) NOT NULL AUTO_INCREMENT, pid int(11) DEFAULT NULL, #外键pid，指向产品表的id字段 ptid int(11) DEFAULT NULL, #外键ptid，指向属性表的id字段 value varchar(255) DEFAULT NULL, PRIMARY KEY (id), CONSTRAINT fk_propertyvalue_property FOREIGN KEY (ptid) REFERENCES property (id), CONSTRAINT fk_propertyvalue_product FOREIGN KEY (pid) REFERENCES product (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #属性值表CREATE TABLE productimage ( id int(11) NOT NULL AUTO_INCREMENT, pid int(11) DEFAULT NULL, #本表的外键pid，指向产品表的id字段 type varchar(255) DEFAULT NULL, #type表示类型，产品图片分单个图片和详情图片两种 PRIMARY KEY (id), CONSTRAINT fk_productimage_product FOREIGN KEY (pid) REFERENCES product (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #产品图片表CREATE TABLE review ( id int(11) NOT NULL AUTO_INCREMENT, content varchar(4000) DEFAULT NULL, uid int(11) DEFAULT NULL, #外键uid，指向用户表的id字段 pid int(11) DEFAULT NULL, #外键pid，指向产品表的id字段 createDate datetime DEFAULT NULL, PRIMARY KEY (id), CONSTRAINT fk_review_product FOREIGN KEY (pid) REFERENCES product (id), CONSTRAINT fk_review_user FOREIGN KEY (uid) REFERENCES user (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #评价表CREATE TABLE order_ ( id int(11) NOT NULL AUTO_INCREMENT, orderCode varchar(255) DEFAULT NULL, #订单号 address varchar(255) DEFAULT NULL, #收货地址 post varchar(255) DEFAULT NULL, #邮编 receiver varchar(255) DEFAULT NULL, #收货人信息 mobile varchar(255) DEFAULT NULL, #手机号码 userMessage varchar(255) DEFAULT NULL,#用户备注信息 createDate datetime DEFAULT NULL, #订单创建日期 payDate datetime DEFAULT NULL, #支付日期 deliveryDate datetime DEFAULT NULL, #发货日期 confirmDate datetime DEFAULT NULL, #确认收货日期 uid int(11) DEFAULT NULL, #外键uid，指向用户表id字段 status varchar(255) DEFAULT NULL, #订单状态 PRIMARY KEY (id), CONSTRAINT fk_order_user FOREIGN KEY (uid) REFERENCES user (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #订单表CREATE TABLE orderitem ( id int(11) NOT NULL AUTO_INCREMENT, pid int(11) DEFAULT NULL, #外键pid，指向产品表id字段 oid int(11) DEFAULT NULL, #外键oid，指向订单表id字段 uid int(11) DEFAULT NULL, #外键uid，指向用户表id字段 number int(11) DEFAULT NULL, #number字段表示购买数量 PRIMARY KEY (id), CONSTRAINT fk_orderitem_user FOREIGN KEY (uid) REFERENCES user (id), CONSTRAINT fk_orderitem_product FOREIGN KEY (pid) REFERENCES product (id), CONSTRAINT fk_orderitem_order FOREIGN KEY (oid) REFERENCES order_ (id)) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8; #订单项表 4.原型-后端CRUD维护管理页面 前端需要的数据，都要先通过后台的功能维护在数据库中，才可以拿到。 所以，先进行后台功能的开发，然后再是前台功能的开发。 首先使用SSM模式开发出第一个分类管理模块。然后分析弊端，对其进行项目重构，重构使得框架更加紧凑，后续开发更加便利和高效率。 4.1静态资源4.1.1在webapp/img/site目录存放静态图片4.1.2在webapp/css目录里有3个子目录 back这个目录里有一个style.css,这是后台界面用到的样式 bootstrap 存放的是bootstrap的css样式文 fore这个目录里也有一个style.css,这是前台界面用到的**样式 4.1.3在webapp/js目录里有2个子目录** bootstrap bootstrap用到的js文件 jquery jquery用到的js文件 4.1.4除了图片资源外，还用到了各种第三方的jar包4.2 JSP包含关系4.2.1 ServletServlet它是运行在服务器上的一个Java小程序，它可以接收客户端发送过来的请求并响应数据给客户端。 Tomcat是一个Web服务器 如何去实现一个servlet程序呢？ 1,编写一个类去实现servlet接口。 2,实现service方法，处理请求并响应数据。 3,到web.xml中去配置servlet程序的访问地址。 4.2.2 JSP在html中写或运行java代码，因为JSP被转译成了Servlet。 webapp/admin/各种Jsp 4.2.3 页面跳转开发web应用时，页面跳转会经常遇到。 比如登录成功或是失败后，分别会跳转到不同的页面。 跳转的方式有两种，服务端跳转和客户端跳转。 首先在web目录下准备两个页面 success.html,fail.html分别用于显示登录成功 或者登录失败 如果登录成功了，就服务端跳转到success.html 如果登录失败了，就客户端跳转到fail.html 01 在Servlet中进行服务端跳转的方式在service(HttpServletRequest request, HttpServletResponse response)方法中 1request.getRequestDispatcher(&quot;success.html&quot;).forward(request, response); 服务端跳转后，浏览器的地址依然是/login 路径，并不会变成success.html 02 在Servlet中进行客户端跳转的方式在service(HttpServletRequest request, HttpServletResponse response)方法中 1response.sendRedirect(&quot;fail.html&quot;); 跳转后浏览器地址发生了变化。 03 在jsp中进行服务端跳转的方式1request.getRequestDispatcher(&quot;hello.jsp&quot;).forward(request, response); 简化： 1&lt;jsp:forward page=&quot;hello.jsp&quot;/&gt; 04 在jsp中进行客户端跳转的方式1response.sendRedirect(&quot;hello.jsp&quot;);","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"},{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://example.com/tags/SpringMVC/"},{"name":"Mybatis","slug":"Mybatis","permalink":"http://example.com/tags/Mybatis/"}]},{"title":"SSM电商项目01","date":"2020-08-05T18:09:55.000Z","path":"2020/08/06/电商网站的SSM项目01/","text":"整站分为前端和后端两部分。 知识点：Java的基础知识，前端（HTML+CSS+Javascript,JQuery,Ajax,bootstrap),J2EE(tomcat,servlet,Jsp,Filter) 框架（spring springmvc mybatis ssm) 数据库 mysql IDE:IntelliJ 或eclipse 确保学习的项目可以在本地演示并可以导入IDEA，并启动tomcat 有个大致的概念，然后哪里有问题再去查询学习 没有前后端分离，主要是jsp 一 Javaweb以及SSM框架用到的一些原理SSM是sping+springMVC+mybatis集成的框架。 MVC即model view controller。 01 Spring“spring”的中文意思是“春天”。Spring makes Java simple，这是spring官网首页的大标题，意思就是说Spring让Java开发更简单。 实质上它是一个Java的轻量级框架，由Rod Johnson创建，目的是为了解决企业级应用开发的业务逻辑层和其他各层的耦合问题。 轻量级：就是它很小，在电脑中的文件夹只有几M大小。 耦合：模块间是相互关联的 最重要的是它开源免费！ “没有对象就new一个”这句话是不是很耳熟。 1GirlFriend g1 = new GirlFriend(); 这句话是程序员自己主动敲出来的，但在spring中就不需要了，Spring会帮我们new一个对象。 就好比中午饿了，本来需要自己动手烧菜做饭，但现在可以点外卖，让商家帮我们做。 实际的应用程序由很多组件组成，每个组件负责一部分功能，需要和其他的组件进行协调，共同完成任务。 就好比一家公司，有技术部，市场部，行政部，人力部等等各个部门组成，每个部门有自己的任务，但有需要相互协作，共同完成任务。 1-1 Ioc(DI)控制反转 （Inversion of Control） 依赖注入（Dependency Injection）就是由IOC容器在运行期间，动态地将某种依赖关系注入到对象之中 依赖注入（DI）和控制反转（IOC）是从不同的角度的描述的同一件事情，指就是通过引入IOC容器，利用依赖关系注入的方式，实现对象之间的解耦 1-2 AOP面向切面编程 02 SpringMVC原理 1234567891011121314151617181920212223SpringMVC流程1、 用户发送请求至前端控制器DispatcherServlet。2、 DispatcherServlet收到请求调用HandlerMapping处理器映射器。3、 处理器映射器找到具体的处理器(可以根据xml配置、注解进行查找)，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。4、 DispatcherServlet调用HandlerAdapter处理器适配器。5、 HandlerAdapter经过适配调用具体的处理器(Controller，也叫后端控制器)。6、 Controller执行完成返回ModelAndView。7、 HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet。8、 DispatcherServlet将ModelAndView传给ViewReslover视图解析器。9、 ViewReslover解析后返回具体View。10、DispatcherServlet根据View进行渲染视图（即将模型数据填充至视图中）。11、 DispatcherServlet响应用户。 03 Mybatis原理及流程 应用程序找Mybatis要数据 mybatis从数据库中找来数据2.1 通过mybatis-config.xml 定位哪个数据库2.2 通过Category.xml执行对应的select语句2.3 基于Category.xml把返回的数据库记录封装在Category对象中2.4 把多个Category对象装在一个Category集合中 返回一个Category集合 1234567891.通过SqlSessionFactoryBuilder 解析mybatis-config.xml 文件中的 Configuration 创建一个 sqlSessionFactory2.通过sqlSessionFactory 创建一个SqlSession3.SqlSession调用一个 quary(查询)Executor执行器，是为了执行sql语句4. 创建一个新的StatementHandler (参数执行器)5. 调用ResultSetHandler （结果器返回结果），执行SQl语句,不同的SQl语句返回不同的结果","link":"","tags":[{"name":"SSM","slug":"SSM","permalink":"http://example.com/tags/SSM/"},{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://example.com/tags/SpringMVC/"},{"name":"Mybatis","slug":"Mybatis","permalink":"http://example.com/tags/Mybatis/"}]},{"title":"Django2.1.2 入门","date":"2020-06-04T05:09:55.000Z","path":"2020/06/04/Django2/","text":"Ubuntu + Django2.1.2 +Python31.1、简单博客系统1.1 .1 Django 入门django -网站的开发框架 1.1.2 安装Django(Python3)打开终端 $ pip3 install Django == 2.1.2 1.1.3 创建项目（project)“项目”，可以理解为一个网站 首先，创建一个目录mysite（文件夹），将项目创建在这个mysite里 打开终端 $ sudo install python-django-common $ sudo apt-get install python - django 然后在这个mysite目录下（空白），右键，选择Open in Terminal ~/mysite$ django-admin startproject mysite —创建一个django项目，多了一个mysite子目录，mysite是这个项目名称，这时已经有了一个网站的基本框架了。 创建项目时用到的 django-admin.py，它是Django 的任务管理命令行工具 在有manage.py这个文件的目录下打开终端$ python manage.py runserver 若一切正常，可以看到提示信息： Starting development server at http://127.0.0.1:8000/ ——启动服务 Quit the server with CONTROL-C. ——control+c 结束当前服务 打开浏览器，输入http://12.0.1:8000或者http://localhost:8000 ,会看到Django网页 1.1.4 创建应用(application)网站的具体功能 进入到刚才创建的项目目录中，即manage.py文件所在的目录 ~/mysite$ python manage.py startapp blog ——在项目mysite中新建了一个blog应用。 对项目结构各个部分简介 1. manage.py在创建一个Django项目后，manage.py 被自动生成在项目的根目录中，它是对django-admin.py的简单封装，同样能够实现命令行操作，不要修改和删除它。 2. mysite所建项目的管理功能目录，它里面的文件常用于整个项目进行参数配置 settings.py : 包含项目的初始化设置，可以针对整个项目进行有关参数配置，比如配置数据库、添加应用等。 urls.py: URL配置表文件，主要将URL映射到应用程序上。当用户请求某个URL时，Django项目会根据这个文件中的映射关系指向某个目标对象（某个应用的urls.py文件或某个具体的视图函数）。这个文件也被称为URLconf. wsgi.py : （Web Server Gateway Interface),是Python所选择的服务器和应用标准。 __pychache__: 执行python manage.py runserver命令后出现，时一个编译后的文件夹，里面文件都是以.pyc结尾的文件。 3. blog项目中创建的应用之一，每创建一个新的应用，Django就会在项目根目录中( ./)中创建一个子目录，目录中会有一些默认的文件。 admin.py : 可以自定义Django管理工具。 apps.py : 包含对应用的配置 migrations: 这是一个目录，用于存储应用的数据库表结构的指令，通过这些指令可以修改和创建数据库，从而在models.py模型类和数据库表之间的迁移。 models.py : 应用的数据模型，每个Django应用都应当有一个models.py文件，可以为空。 tests.py：在这个文件中编写测试文档来测试所建立的应用。 views.py: 用户保存响应各种请求的函数和类。 如果编写的是函数，则称之为基于函数的视图；如果编写的是类，则称之为基于类的视图。保存函数或者类的视图文件。 4. db.sqlite3默认的数据库SQLite 1.1.5 网站的配置将应用注册到项目中 在Django项目中，主管信息注册（对本项目进行各种信息声明）的文件时./mysite/settings.py。 DEBUG： True or False, 开发过程中，设置成True,在测试功能时，Django能够显示详细的报错信息——“开发模式”。如果将项目部署到真正要对外发布的服务器上——“生产环境”，必须将其值修改为False,从而避免暴露项目的内部信息。 ALLOWED_HOSTS: 在DEBUG设置为True时，其值可以为空。当部署到生产环境中时，要把主域名填写到这里，才能通过域名访问到本网站。 INSTALLED_APPS： 所有的应用写到这里才能生效。 INSTALLED_APPS = [ ‘django.contrib.admin’, # 针对项目后台管理的应用。 ‘django.contrib.auth’, ‘django.contrib.contenttypes’, ‘django.contrib.sessions’, ‘django.contrib.messages’,​ ‘django.contrib.staticfiles’, ​ ‘blog’, #新增加的，所建立项目的名称，其他项Django默认具有的应用。 ] DATABASES: 配置数据库，默认配置SQLite,小巧灵活，Python标准库所支持。 LANGUAGE_CODE:设置项目的语言，汉语，设置为 LANGUAGE_CODE = ‘zh-hans’ TIME_ZONE: 设置时区，东八区， TIME_ZONE = ‘Asia/Shanghai’ 1.1.6 知识点1. 开发模式是相对于“生产模式”而言的，即系统尚处于开发阶段，还没正式对外部客户提供服务，在Django开发模式中，不需要配置Apache或者Nginx等服务器，也能够运行网站，这是因为Django本身就提供了简单的Web服务器功能，但是这仅限于开发过程，当网站被正式部署后，即转换为“生产模式”时，就需要对部分配置进行修改。 在开发模式中，Django会自动检测到修改代码并重新加载，不需要每次修改代码后重新启动Web服务器。只有在新增加文件后，才需要重启Django服务。 运行Django服务的指令是： python manage.py runserver 2. 项目和应用Django安装好之后，就有了django-admin这个默认命令，可以用django-admin starproject projectname命令创建一个Django项目。 项目是由若干个“应用”(app)组成的，实现具体的功能。创建应用可以用 python manage.py startapp appname命令。也可以使用 django-admin startapp appname命令。 创建项目和应用后，会生成一些默认的文件，要么是一些默认的配置，要么是一些空文件为了占据位置。 每个应用都要在项目的settings.py文件的INSTALLED_APPS中进行声明，告诉Django这个应用是本项目的一部分。 1.2 编写博客的数据模型类设计数据库和表结构是做网站的基础。在Django中，不需要通过SQL语句直接跟数据库打交道，而是完全用 python的方式创建数据库，之后交给Django完成数据库的操作。 1.2.1 数据模型类利用Django开发网站系统，一般情况下，要先编写数据模型，就是在./blog/models.py中写一个类，这个类与数据库中的数据表具有对应关系。 在./blog/models.py中编写博客的数据模型类 Blog, 它本质上是一个继承了django.db.models.Models的类。 12345678910111213141516171819from django.db import modelsfrom django.utils import timezonefrom django.contrib.auth.models import Userclass BlogArticles(models.Model): title &#x3D; models.CharField(max_length&#x3D;300) #1 author &#x3D; models.ForeignKey(User,related_name&#x3D;&quot;blog_posts&quot;,on_delete&#x3D;models.CASCADE,) #2 body &#x3D; models.TextField() publish &#x3D; models.DateTimeField(default&#x3D;timezone.now) class Meta: #3 ordering &#x3D; (&quot;-publish&quot;,) def __str__(self): return self.title 这个BlogArticles类中定义了一些属性，每个属性对应着将来数据库表中的一个字段。，以后将属性称之为字段。 #1 字段title的属性为CharFiled()类型，参数说字 段的最大数量. #2 通过字段author规定了博客和用户之间的关系——一个用户对应多篇文章。ForeignKey() 就反映了这种“一对多”关系。类User就是BlogArticles的对应对象，related_name=”blog_posts”的作用是允许通过类User反向查询到BlogArticles. #3 通过 ordering = (“-publish”,)，规定了BlogArticles实例对象的显示顺序，即按照publish字段值的倒序显示。 BlogArticles 类的数据模型编写好了，将来数据库表的基本结构就是按照上述各字段及其属性而定的。 接下来根据数据模型建立数据库表： 在/mysite/manage.py 位置执行 ~/mysite$ python manage.py makemigrations,会有Migrations for blog : …的提示信息，意思就是在blog/migrations目录中创建了一个BlogArticles模型，打开这个001_initial.py文件看一下。 12345678910111213141516171819202122232425262728293031# Generated by Django 2.1.2 on 2018-10-13 12:21from django.conf import settingsfrom django.db import migrations, modelsimport django.db.models.deletionimport django.utils.timezoneclass Migration(migrations.Migration): initial &#x3D; True dependencies &#x3D; [ migrations.swappable_dependency(settings.AUTH_USER_MODEL), ] operations &#x3D; [ migrations.CreateModel( name&#x3D;&#39;BlogArticles&#39;, fields&#x3D;[ (&#39;id&#39;, models.AutoField(auto_created&#x3D;True, primary_key&#x3D;True, serialize&#x3D;False, verbose_name&#x3D;&#39;ID&#39;)), (&#39;title&#39;, models.CharField(max_length&#x3D;300)), (&#39;body&#39;, models.TextField()), (&#39;publish&#39;, models.DateTimeField(default&#x3D;django.utils.timezone.now)), (&#39;author&#39;, models.ForeignKey(on_delete&#x3D;django.db.models.deletion.CASCADE, related_name&#x3D;&#39;blog_posts&#39;, to&#x3D;settings.AUTH_USER_MODEL)), ], options&#x3D;&#123; &#39;ordering&#39;: (&#39;-publish&#39;,), &#125;, ), ] 这个文件是执行python manage.py makemigrations命令后，django自动生成的。这个文件的功能是创建一个名称为BlogArticles的数据库表。这个表的名称由两部分组成，第一部分是blog本应用的名称，第二部分是blogaricles(都小写)是在models.py中创建的数据模型类的名称，中间用单下划线连接。 创建了一个能够建立数据库表的文件，就可以真正创建数据库了。 1~&#x2F;mysite$ python manage.py migrate 本项目使用SQLite数据库，并且在settings.py中规定了数据库文件存放在项目根目录中 123456DATABASES &#x3D; &#123; &#39;default&#39;: &#123; &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;, &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;), &#125;&#125; 对于db.sqlite3这个文件，可以在FireFox浏览器中安装SQLite Manager 插件来查看。 由于我的火狐浏览器插件不兼容，两种办法：1、直接在Ubuntu Software 搜索 sqlite ,安装DB Browser for SQLite； 2是通过打开终端输入命令： 123sudo apt-get install sqlite3sqlite -versionsudo apt-get install sqlitebrowser 综上，博客的数据库就建立好了。 1.2.2 发布博客文章先用最简单的方式实现博客文章的发布,使用Django默认的管理功能就可以发布文章。要使用此功能，必须先创建超级管理员。要牢记所使用的用户名和密码。密码设置要有一定的复杂度，我的是英文字母加数字，至少8位。 123456mysite$ python manage.py createsuperuserUsername(leave blank to use &#39;qiwsir&#39;): kunEmail address: hk19930914@163.comPassword:*********Password(again):*********Superuser created successfull 运行服务器 mysite$ python manage.py runserver 浏览器地址栏输入 http://127.0.0.1:8000/admin/或者http://localhost:8000/admin/, 然后输入刚才创建超级管理员的用户名和密码，就可以进入Django administration页面。 用户(Users)和组(Groups)是Django在用户管理应用中默认的，单击User会看到当前项目仅有的一个用户kun，当然也可以增加用户。 打开./blog/admin.py文件，用编辑工具打开，输入以下代码： 1234from django.contrib import adminfrom .models import BlogArticles #1 将BlogArticles类引入当前环境admin.site.register(BlogArticles) #2 将该类注册到admin中 刷新浏览器页面，看到新注册的BLOG。 单击Blog articless 右侧的Add按钮就可以添加博客文章。内容填写之后，点击保存，该博客文章被保存到数据库中，可以使用DB Browser for SQLite查看数据库。 在./blog/models.py中使用了django.utils.timezone,所以要安装一个pytz模块，用它来提供时区。 1$ sudo pip3 install pytz 安装完毕，重启服务。 在文章列表页，可以看到所有已经发布的文章标题。由于显示的列表信息太单一，为了使列表页的信息更加丰富，继续用编辑./blog/admin.py 文件。 1234567891011121314from django.contrib import adminfrom .models import BlogArticlesclass BlogArticlesAdmin(admin.ModelAdmin): list_display &#x3D; (&quot;title&quot;, &quot;author&quot;, &quot;publish&quot;) list_filter &#x3D; (&quot;publish&quot;, &quot;author&quot;) search_fields &#x3D; (&#39;title&#39;, &quot;body&quot;) raw_id_fields &#x3D; (&quot;author&quot;,) date_hierarchy &#x3D; &quot;publish&quot; ordering &#x3D; [&#39;publish&#39;, &#39;author&#39;]admin.site.register(BlogArticles, BlogArticlesAdmin) 保存，刷新浏览器页面，即可看到效果。 1.2.3 知识点1. HTTPHyper Text Transfer Protocol( 超文本传输协议 )，是客户端( 浏览器、网页爬虫程序 )和服务器端( 网站 )请求和应答的标准(TCP)，封装了Web服务的整个过程，默认端口80。 请求 (request): 客户端到服务器端 响应 (response): 服务器端到客户端。状态信息（HTTP/1.1 200) 和内容信息。 HTTP/1.1 协议共定义了8种请求方式：OPTIONS、HEAD、GET、POST、 PUT、DELETE、TRACE 和 CONNECT. 本项目中主要使用GET和POST请求 GET：向指定服务器发出请求，主要用于读取信息并显示 POST： 向指定服务器提交数据，请求服务器进行处理（例如提交表单或者上传文件） HTTPS — Hyper Text Transfer Protocol Secure,默认端口443，安全性更高，HTTP以明文方式封装信息，HTTPS以加密方式传送信息。 2. URLUniform/Universal Resource Locator 统一资源定位符，俗称网址。 URL标准格式：协议类型://服务器地址(必要时需加上端口号)/路径/文件名 协议类型：HTTP/HTTPSu 服务器地址： 通常是域名，比如baidu.com,也可以是IP地址，如果默认是80端口，可以不写，否则需要写上端口。 路径：以”/“区别目录，对于GET请求方式，可以用“？”发起参数，每个参数以“&amp;”隔开，再以“=”分开参数名称和值。 文件名：有必要可写 3. 模型： ORM动态网站，大多数是通过数据库实现对数据的保存和读取，所以数据库是网站最基本最底层的组成部分。 Django不需要开发者使用SQL语句实现程序和数据库的交互，而是通过ORM，即Object-Relational Mapping（对象关系映射）。 ORM的作用是在关系型数据库和业务实体对象之间进行映射，，只需简单地操作对象的属性和方法。 Django的数据模型层大量使用ORM,表现方式就是编写数据模型类，这些类可以写到任何文件中，通常写在每个应用的models.py文件中，每个数据模型类都是django.db.models.Model的子类。应用的名称（小写字母）和数据模型类的名称（小写字母）共同组成一个数据库表的名称（”appname”_”modelname”,例如blog_blogarticles). 当数据模型类写好之后，通过执行Django的数据迁移操作（python manage.py makemigrations, python manage.py migrate)就能够创建相应的数据库表，用来保存网站项目的数据。以后要更改数据库表的结构，只需要更改数据模型类，迁移数据就能实现数据库结构的调整。 若想改为MySQL数据库,只需要在settings.py文件中做好新数据库的配置，然后进行迁移数据的操作即可完成数据库的迁移，不需要对ORM进行任何修改。","link":"","tags":[{"name":"Django","slug":"Django","permalink":"http://example.com/tags/Django/"}]},{"title":"Java核心技术卷I笔记01","date":"2020-03-02T02:19:32.000Z","path":"2020/03/02/《Java核心卷I》笔记/","text":"Java是一门编程语言。 Java开发工具包（JDK）：Java Development Kit （比如 jdk1.8.0_version） Java运行时环境（JRE）： 下载好之后要设置系统环境变量，cmd可以检查是否安装成功。 安装好Jdk就可以编写Java. 1.第一个Java程序Java源代码（HelloWorld.java)：是由我们通过记事本或者sublimeText来写的 而IntelliJ idea 和 eclipse是java编程语言开发的集成环境，工作中辅助开发，但不是必需品。 我们可以用记事本来编写HelloWorld.java如下： 12345678910111213141516/***这是初学者的第一个学习的print helloworld 的Java程序*@author kun*/public class HelloWorld&#123; //源代码的文件名必须与公共类的名字相同，并用.java作为扩展名 public static void main(String [] args)&#123; /*每个Java应用程序都必须有一个main方法，而且必须是静态的。 void表示该方法没有返回值 关键字public称为**访问修饰符**（access modifier） 修饰符用于控制程序的其他部分对这段代码的访问级别。 */ System.out.println(&quot;HelloWorld ！&quot;); //点号（·）用于调用方法 &#125;&#125; Java区分大小写。（例如，将main拼写成Main），程序将无法运行。 *很多初学者将main拼成了mian。 {花括号里面的成为块}。 Java代码需要经过编译和运行两个过程。 编译产生字节码：HelloWorld.java(源代码) ————-&gt;HelloWorld.class 然后字节码被Java虚拟机解释执行，生成0和1组成的机器码（机器只懂01，高低电平，通电或断电） cmd -&gt;源代码所在的路径。 javac HelloWorld.java java HelloWorld 然后可以在命令窗口和控制台输出（打印出）HelloWorld ！ 每行的注释前面标记//，也可以使用/*和*/将一段比较长的注释。 第3种注释可以用来自动地生成文档。这种注释以/**开始，以*/结束 注释是给程序员看的，不会编译和运行。 源代码（.java)经过编译器javac编译成字节码文件（.class),然后通过Java虚拟机解释成机器码。 2.Java基础知识整合2.1 基本类型Java是一种强类型语言。 必须为每一个变量声明一种类型。 在Java中，一共有8种基本类型（primitive type）， 有4种整型（byte short int long）(1字节=8位，8bit，8个0，1组成的位) 2种浮点类型(float double) 1种用于表示Unicode编码的字符单元的字符类型char 1种用于表示真值的boolean类型,用来判定逻辑条件。 123456789int a = 10; //int 4个字节 ，32位long b = 4000000000L; //长整型（8个字节）数值有一个后缀L或lfloat c = 3.14F; //float类型（4字节）的数值有一个后缀F或f（3.14F） double d = 3.14D; //double类型（8字节)char e = &#x27;E&#x27; ; //字符类型charboolean f = false; //boolean类型boolean g = true;//type 变量名 = 表达式 ; 声明和初始化均放在同一行中 //type 变量名; 仅仅声明 数值类型可以相互转换。 小到大，无信息丢失的转换；（byte-&gt;short-&gt;int-&gt;long, char-&gt;int, int-&gt;double) 大到小，可能有精度损失的转换。(int–&gt;float , long–&gt;float, long–&gt;double) 12345//强制类型转换强制类型转换（cast）double x = 9.9999; //会截断小数部分将浮点值转换为整型，丢失精度int y = (int) x; //y的值为9//最接近的整数，需要使用Math.round方法，round方法返回的结果为long类型int z = (int) Math.round() //z的值为10 2.2 变量在Java中，每个变量都有一个类型（type） 在Java中可以将声明放在代码中的任何地方 在声明变量时，变量的类型位于变量名之前 变量名必须是一个以字母开头并由字母或数字构成的序列 不能使用Java保留字作为变量名 要想对一个已经声明过的变量进行赋值，就需要将变量名放在等号（=）左侧，相应取值的Java表达式放在等号的右侧 null可以表示这个变量没有设置任何值 2.3 常量关键字final指示常量，关键字final表示这个变量只能被赋值一次。 一旦被赋值之后，就不能够再更改了。 常量名使用全大写。 使用关键字static final可以设置一个类常量。类常量可以在一个类中的多个方法中使用，类常量的定义位于main方法的外部。 public static final double PI = 3.1415926; 如果一个常量被声明为public，那么其他类的方法也可以使用这个常量。 2.4 运算符算术运算符+、-、*、/表示加、减、乘、除运算。 当参与/运算的两个操作数都是整数时，表示整数除法；否则，表示浮点除法。 整数的求余操作（有时称为取模）用**%**表示 在默认情况下，虚拟机设计者允许对中间计算结果采用扩展的精度。 对于使用strictfp关键字标记的方法必须使用严格的浮点计算来生成可再生的结果。 算一个数值的平方根，可以使用sqrt方法 12345double x = 4;//Math类中的sqrt方法处理的不是对象，这样的方法被称为静态方法。double y = Math.sqrt(x);System.out.println(y); //打印结果为2.0//println方法处理System.out对象。 1234//在Java中，没有幂运算，因此需要借助于Math类的pow方法//将y的值设置为x的a次幂double y = Math.pow(x,a); //pow方法有两个double类型的参数，其返回结果也为double类型。 1234567891011121314151617181920212223242526//赋值运算符=x += 4;//等价于x = x + 4;int x = 2;x += 3.5;//x是整数会强制转换x = int (x+3.5);//自增自减运算符++，--int n = 6;int m = 6;int z = 2 * ++n; //前缀”形式：++n, z结果为14， n为7int y = 2 * n++; ////后缀”形式：n++, z结果为12， n为7//关系运算符//使用两个等号==检测相等性2 == 2; //true2 == 3; //false//使用！=检测不相等2 != 5 //ture 逻辑运算符 &amp;&amp;**表示逻辑“与**”运算符， 使用**||表示逻辑“或**”运算符。 感叹号！就是逻辑非运算符。 &amp;&amp;和||运算符是按照“短路”方式来求值。 Java支持三元操作符 123// condition ? expression1 : experssion2return x &gt; = z ? x : z ;//如果x &gt; = z 成立（true），返回x,否则返回z,即返回较大的数 此外还有位运算符 &amp; (“and”) | (“or”) ^ (“xor”) ~ (“not”) 3.5 字符串Java字符串就是Unicode字符序列。 在标准Java类库中提供了一个预定义类String。 12345678910111213141516//每个用双引号括起来的字符串都是String类的一个实例String e =&quot;&quot;;//空字符串String greeting1 = &quot;Hi&quot;;//String类的substring方法可以从一个较大的字符串提取出一个子串String greeting2 = &quot;Hello&quot;;String s = greeting2.substring(0,3); //下标从0算起，在substring中从0开始计数，直到3为止，但不包含3,左闭右开。/*创建了一个由字符“Hel”组成的字符串s。substring的工作方式有一个优点：容易计算子串的长度。字符串s.substring（a，b）的长度为b-a。例如，子串“Hel”的长度为3-0=3。*///+号连接（拼接）","link":"","tags":[{"name":"Java基础","slug":"Java基础","permalink":"http://example.com/tags/Java%E5%9F%BA%E7%A1%80/"}]}]